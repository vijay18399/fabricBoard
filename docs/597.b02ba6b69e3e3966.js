(self.webpackChunkwhiteBoard=self.webpackChunkwhiteBoard||[]).push([[597],{5597:(Yn,yt,vt)=>{"use strict";vt.r(yt),vt.d(yt,{WhiteboardModule:()=>ce});var _=vt(6895),C=vt(4650);let Zt;try{Zt=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Zt=!1}let u,s,i,r,At=(()=>{class d{constructor(t){this._platformId=t,this.isBrowser=this._platformId?(0,_.NF)(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Zt)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(C.Lbi))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();function n(d){return function h(){if(null==u&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>u=!0}))}finally{u=u||!1}return u}()?d:!!d.capture}function o(){if(null==i){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return i=!1,i;if("scrollBehavior"in document.documentElement.style)i=!0;else{const d=Element.prototype.scrollTo;i=!!d&&!/\{\s*\[native code\]\s*\}/.test(d.toString())}}return i}function c(){if("object"!=typeof document||!document)return 0;if(null==s){const d=document.createElement("div"),e=d.style;d.dir="rtl",e.width="1px",e.overflow="auto",e.visibility="hidden",e.pointerEvents="none",e.position="absolute";const t=document.createElement("div"),l=t.style;l.width="2px",l.height="1px",d.appendChild(t),document.body.appendChild(d),s=0,0===d.scrollLeft&&(d.scrollLeft=1,s=0===d.scrollLeft?1:2),d.remove()}return s}function y(d){return d.composedPath?d.composedPath()[0]:d.target}function x(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var w=vt(1135),O=vt(7579),P=vt(9646),Ue=vt(9300);function bi(d){return(0,Ue.h)((e,t)=>d<=t)}var qn=vt(4671),Oe=vt(4482),he=vt(5403);function Zn(d,e){return d===e}var Ye=vt(8421),$n=vt(5032);function Rt(d){return(0,Oe.e)((e,t)=>{(0,Ye.Xf)(d).subscribe((0,he.x)(t,()=>t.complete(),$n.Z)),!t.closed&&e.subscribe(t)})}function ue(d){return null!=d&&"false"!=`${d}`}function Vt(d,e=0){return function Jn(d){return!isNaN(parseFloat(d))&&!isNaN(Number(d))}(d)?Number(d):e}function Ee(d){return Array.isArray(d)?d:[d]}function kt(d){return null==d?"":"string"==typeof d?d:`${d}px`}function Jt(d){return d instanceof C.SBq?d.nativeElement:d}let Qn=(()=>{class d{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}}return d.\u0275fac=function(t){return new(t||d)},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),tr=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({providers:[Qn]}),d})();var er=vt(9841),ir=vt(7272),Qt=vt(9751),ze=vt(5698),de=vt(727);class nr extends de.w0{constructor(e,t){super()}schedule(e,t=0){return this}}const ke={setInterval(d,e,...t){const{delegate:l}=ke;return l?.setInterval?l.setInterval(d,e,...t):setInterval(d,e,...t)},clearInterval(d){const{delegate:e}=ke;return(e?.clearInterval||clearInterval)(d)},delegate:void 0};var rr=vt(8737);class We extends nr{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var l;if(this.closed)return this;this.state=e;const g=this.id,b=this.scheduler;return null!=g&&(this.id=this.recycleAsyncId(b,g,t)),this.pending=!0,this.delay=t,this.id=null!==(l=this.id)&&void 0!==l?l:this.requestAsyncId(b,this.id,t),this}requestAsyncId(e,t,l=0){return ke.setInterval(e.flush.bind(e,this),l)}recycleAsyncId(e,t,l=0){if(null!=l&&this.delay===l&&!1===this.pending)return t;null!=t&&ke.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const l=this._execute(e,t);if(l)return l;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let g,l=!1;try{this.work(e)}catch(b){l=!0,g=b||new Error("Scheduled action threw falsy error")}if(l)return this.unsubscribe(),g}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:l}=t;this.work=this.state=this.scheduler=null,this.pending=!1,(0,rr.P)(l,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const Ci={now:()=>(Ci.delegate||Date).now(),delegate:void 0};class fe{constructor(e,t=fe.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,l){return new this.schedulerActionCtor(this,e).schedule(l,t)}}fe.now=Ci.now;class Ge extends fe{constructor(e,t=fe.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let l;this._active=!0;do{if(l=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,l){for(;e=t.shift();)e.unsubscribe();throw l}}}const qe=new Ge(We),sr=qe;var Lt=vt(4004),xi=vt(8675);const wi=new Set;let te,ar=(()=>{class d{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):cr}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function lr(d){if(!wi.has(d))try{te||(te=document.createElement("style"),te.setAttribute("type","text/css"),document.head.appendChild(te)),te.sheet&&(te.sheet.insertRule(`@media ${d} {body{ }}`,0),wi.add(d))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(At))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();function cr(d){return{matches:"all"===d||""===d,media:d,addListener:()=>{},removeListener:()=>{}}}let hr=(()=>{class d{constructor(t,l){this._mediaMatcher=t,this._zone=l,this._queries=new Map,this._destroySubject=new O.x}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return Si(Ee(t)).some(g=>this._registerQuery(g).mql.matches)}observe(t){const g=Si(Ee(t)).map(M=>this._registerQuery(M).observable);let b=(0,er.a)(g);return b=(0,ir.z)(b.pipe((0,ze.q)(1)),b.pipe(bi(1),function or(d,e=qe){return(0,Oe.e)((t,l)=>{let g=null,b=null,M=null;const B=()=>{if(g){g.unsubscribe(),g=null;const Q=b;b=null,l.next(Q)}};function U(){const Q=M+d,ct=e.now();if(ct<Q)return g=this.schedule(void 0,Q-ct),void l.add(g);B()}t.subscribe((0,he.x)(l,Q=>{b=Q,M=e.now(),g||(g=e.schedule(U,d),l.add(g))},()=>{B(),l.complete()},void 0,()=>{b=g=null}))})}(0))),b.pipe((0,Lt.U)(M=>{const B={matches:!1,breakpoints:{}};return M.forEach(({matches:U,query:Q})=>{B.matches=B.matches||U,B.breakpoints[Q]=U}),B}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const l=this._mediaMatcher.matchMedia(t),b={observable:new Qt.y(M=>{const B=U=>this._zone.run(()=>M.next(U));return l.addListener(B),()=>{l.removeListener(B)}}).pipe((0,xi.O)(l),(0,Lt.U)(({matches:M})=>({query:t,matches:M})),Rt(this._destroySubject)),mql:l};return this._queries.set(t,b),b}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(ar),C.LFG(C.R0b))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();function Si(d){return d.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}function Ie(d,e){return(d.getAttribute(e)||"").match(/\S+/g)||[]}const Mi="cdk-describedby-message",De="cdk-describedby-host";let Ke=0,fr=(()=>{class d{constructor(t,l){this._platform=l,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+Ke++,this._document=t,this._id=(0,C.f3M)(C.AFp)+"-"+Ke++}describe(t,l,g){if(!this._canBeDescribed(t,l))return;const b=Ze(l,g);"string"!=typeof l?(Oi(l,this._id),this._messageRegistry.set(b,{messageElement:l,referenceCount:0})):this._messageRegistry.has(b)||this._createMessageElement(l,g),this._isElementDescribedByMessage(t,b)||this._addMessageReference(t,b)}removeDescription(t,l,g){if(!l||!this._isElementNode(t))return;const b=Ze(l,g);if(this._isElementDescribedByMessage(t,b)&&this._removeMessageReference(t,b),"string"==typeof l){const M=this._messageRegistry.get(b);M&&0===M.referenceCount&&this._deleteMessageElement(b)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${De}="${this._id}"]`);for(let l=0;l<t.length;l++)this._removeCdkDescribedByReferenceIds(t[l]),t[l].removeAttribute(De);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,l){const g=this._document.createElement("div");Oi(g,this._id),g.textContent=t,l&&g.setAttribute("role",l),this._createMessagesContainer(),this._messagesContainer.appendChild(g),this._messageRegistry.set(Ze(t,l),{messageElement:g,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",l=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let b=0;b<l.length;b++)l[b].remove();const g=this._document.createElement("div");g.style.visibility="hidden",g.classList.add(t),g.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&g.setAttribute("platform","server"),this._document.body.appendChild(g),this._messagesContainer=g}_removeCdkDescribedByReferenceIds(t){const l=Ie(t,"aria-describedby").filter(g=>0!=g.indexOf(Mi));t.setAttribute("aria-describedby",l.join(" "))}_addMessageReference(t,l){const g=this._messageRegistry.get(l);(function ur(d,e,t){const l=Ie(d,e);l.some(g=>g.trim()==t.trim())||(l.push(t.trim()),d.setAttribute(e,l.join(" ")))})(t,"aria-describedby",g.messageElement.id),t.setAttribute(De,this._id),g.referenceCount++}_removeMessageReference(t,l){const g=this._messageRegistry.get(l);g.referenceCount--,function dr(d,e,t){const g=Ie(d,e).filter(b=>b!=t.trim());g.length?d.setAttribute(e,g.join(" ")):d.removeAttribute(e)}(t,"aria-describedby",g.messageElement.id),t.removeAttribute(De)}_isElementDescribedByMessage(t,l){const g=Ie(t,"aria-describedby"),b=this._messageRegistry.get(l),M=b&&b.messageElement.id;return!!M&&-1!=g.indexOf(M)}_canBeDescribed(t,l){if(!this._isElementNode(t))return!1;if(l&&"object"==typeof l)return!0;const g=null==l?"":`${l}`.trim(),b=t.getAttribute("aria-label");return!(!g||b&&b.trim()===g)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(_.K0),C.LFG(At))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();function Ze(d,e){return"string"==typeof d?`${e||""}/${d}`:d}function Oi(d,e){d.id||(d.id=`${Mi}-${e}-${Ke++}`)}function ki(d){return 0===d.buttons||0===d.offsetX&&0===d.offsetY}function Ii(d){const e=d.touches&&d.touches[0]||d.changedTouches&&d.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}const yr=new C.OlP("cdk-input-modality-detector-options"),br={ignoreKeys:[18,17,224,91,16]},ee=n({passive:!0,capture:!0});let Cr=(()=>{class d{constructor(t,l,g,b){this._platform=t,this._mostRecentTarget=null,this._modality=new w.X(null),this._lastTouchMs=0,this._onKeydown=M=>{this._options?.ignoreKeys?.some(B=>B===M.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=y(M))},this._onMousedown=M=>{Date.now()-this._lastTouchMs<650||(this._modality.next(ki(M)?"keyboard":"mouse"),this._mostRecentTarget=y(M))},this._onTouchstart=M=>{Ii(M)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=y(M))},this._options={...br,...b},this.modalityDetected=this._modality.pipe(bi(1)),this.modalityChanged=this.modalityDetected.pipe(function Kn(d,e=qn.y){return d=d??Zn,(0,Oe.e)((t,l)=>{let g,b=!0;t.subscribe((0,he.x)(l,M=>{const B=e(M);(b||!d(g,B))&&(b=!1,g=B,l.next(M))}))})}()),t.isBrowser&&l.runOutsideAngular(()=>{g.addEventListener("keydown",this._onKeydown,ee),g.addEventListener("mousedown",this._onMousedown,ee),g.addEventListener("touchstart",this._onTouchstart,ee)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,ee),document.removeEventListener("mousedown",this._onMousedown,ee),document.removeEventListener("touchstart",this._onTouchstart,ee))}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(At),C.LFG(C.R0b),C.LFG(_.K0),C.LFG(yr,8))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();const wr=new C.OlP("cdk-focus-monitor-default-options"),Pe=n({passive:!0,capture:!0});let Sr=(()=>{class d{constructor(t,l,g,b,M){this._ngZone=t,this._platform=l,this._inputModalityDetector=g,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new O.x,this._rootNodeFocusAndBlurListener=B=>{for(let Q=y(B);Q;Q=Q.parentElement)"focus"===B.type?this._onFocus(B,Q):this._onBlur(B,Q)},this._document=b,this._detectionMode=M?.detectionMode||0}monitor(t,l=!1){const g=Jt(t);if(!this._platform.isBrowser||1!==g.nodeType)return(0,P.of)(null);const b=function m(d){if(function f(){if(null==r){const d=typeof document<"u"?document.head:null;r=!(!d||!d.createShadowRoot&&!d.attachShadow)}return r}()){const e=d.getRootNode?d.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}(g)||this._getDocument(),M=this._elementInfo.get(g);if(M)return l&&(M.checkChildren=!0),M.subject;const B={checkChildren:l,subject:new O.x,rootNode:b};return this._elementInfo.set(g,B),this._registerGlobalListeners(B),B.subject}stopMonitoring(t){const l=Jt(t),g=this._elementInfo.get(l);g&&(g.subject.complete(),this._setClasses(l),this._elementInfo.delete(l),this._removeGlobalListeners(g))}focusVia(t,l,g){const b=Jt(t);b===this._getDocument().activeElement?this._getClosestElementsInfo(b).forEach(([B,U])=>this._originChanged(B,l,U)):(this._setOrigin(l),"function"==typeof b.focus&&b.focus(g))}ngOnDestroy(){this._elementInfo.forEach((t,l)=>this.stopMonitoring(l))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,l){t.classList.toggle("cdk-focused",!!l),t.classList.toggle("cdk-touch-focused","touch"===l),t.classList.toggle("cdk-keyboard-focused","keyboard"===l),t.classList.toggle("cdk-mouse-focused","mouse"===l),t.classList.toggle("cdk-program-focused","program"===l)}_setOrigin(t,l=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&l,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,l){const g=this._elementInfo.get(l),b=y(t);!g||!g.checkChildren&&l!==b||this._originChanged(l,this._getFocusOrigin(b),g)}_onBlur(t,l){const g=this._elementInfo.get(l);!g||g.checkChildren&&t.relatedTarget instanceof Node&&l.contains(t.relatedTarget)||(this._setClasses(l),this._emitOrigin(g,null))}_emitOrigin(t,l){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(l))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const l=t.rootNode,g=this._rootNodeFocusListenerCount.get(l)||0;g||this._ngZone.runOutsideAngular(()=>{l.addEventListener("focus",this._rootNodeFocusAndBlurListener,Pe),l.addEventListener("blur",this._rootNodeFocusAndBlurListener,Pe)}),this._rootNodeFocusListenerCount.set(l,g+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Rt(this._stopInputModalityDetector)).subscribe(b=>{this._setOrigin(b,!0)}))}_removeGlobalListeners(t){const l=t.rootNode;if(this._rootNodeFocusListenerCount.has(l)){const g=this._rootNodeFocusListenerCount.get(l);g>1?this._rootNodeFocusListenerCount.set(l,g-1):(l.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Pe),l.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Pe),this._rootNodeFocusListenerCount.delete(l))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,l,g){this._setClasses(t,l),this._emitOrigin(g,l),this._lastFocusOrigin=l}_getClosestElementsInfo(t){const l=[];return this._elementInfo.forEach((g,b)=>{(b===t||g.checkChildren&&b.contains(t))&&l.push([b,g])}),l}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:l,mostRecentModality:g}=this._inputModalityDetector;if("mouse"!==g||!l||l===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const b=t.labels;if(b)for(let M=0;M<b.length;M++)if(b[M].contains(l))return!0;return!1}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(C.R0b),C.LFG(At),C.LFG(Cr),C.LFG(_.K0,8),C.LFG(wr,8))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();const Pi="cdk-high-contrast-black-on-white",Ai="cdk-high-contrast-white-on-black",$e="cdk-high-contrast-active";let Ri=(()=>{class d{constructor(t,l){this._platform=t,this._document=l,this._breakpointSubscription=(0,C.f3M)(hr).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const l=this._document.defaultView||window,g=l&&l.getComputedStyle?l.getComputedStyle(t):null,b=(g&&g.backgroundColor||"").replace(/ /g,"");switch(t.remove(),b){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove($e,Pi,Ai),this._hasCheckedHighContrastMode=!0;const l=this.getHighContrastMode();1===l?t.add($e,Pi):2===l&&t.add($e,Ai)}}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(At),C.LFG(_.K0))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),Tr=(()=>{class d{constructor(t){t._applyBodyHighContrastModeCssClasses()}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(Ri))},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[tr]}),d})();const Mr=new C.OlP("cdk-dir-doc",{providedIn:"root",factory:function Or(){return(0,C.f3M)(_.K0)}}),Er=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let pe=(()=>{class d{constructor(t){if(this.value="ltr",this.change=new C.vpe,t){const g=t.documentElement?t.documentElement.dir:null;this.value=function kr(d){const e=d?.toLowerCase()||"";return"auto"===e&&typeof navigator<"u"&&navigator?.language?Er.test(navigator.language)?"rtl":"ltr":"rtl"===e?"rtl":"ltr"}((t.body?t.body.dir:null)||g||"ltr")}}ngOnDestroy(){this.change.complete()}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(Mr,8))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),me=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({}),d})();const Dr=new C.OlP("mat-sanity-checks",{providedIn:"root",factory:function Ir(){return!0}});let Bt=(()=>{class d{constructor(t,l,g){this._sanityChecks=l,this._document=g,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!x()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(Ri),C.LFG(Dr,8),C.LFG(_.K0))},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[me,me]}),d})();class Ar{constructor(e,t,l,g=!1){this._renderer=e,this.element=t,this.config=l,this._animationForciblyDisabledThroughCss=g,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const Bi=n({passive:!0,capture:!0});class Rr{constructor(){this._events=new Map,this._delegateEventHandler=e=>{const t=y(e);t&&this._events.get(e.type)?.forEach((l,g)=>{(g===t||g.contains(t))&&l.forEach(b=>b.handleEvent(e))})}}addHandler(e,t,l,g){const b=this._events.get(t);if(b){const M=b.get(l);M?M.add(g):b.set(l,new Set([g]))}else this._events.set(t,new Map([[l,new Set([g])]])),e.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,Bi)})}removeHandler(e,t,l){const g=this._events.get(e);if(!g)return;const b=g.get(t);!b||(b.delete(l),0===b.size&&g.delete(t),0===g.size&&(this._events.delete(e),document.removeEventListener(e,this._delegateEventHandler,Bi)))}}const ji={enterDuration:225,exitDuration:150},Ni=n({passive:!0,capture:!0}),Vi=["mousedown","touchstart"],Hi=["mouseup","mouseleave","touchend","touchcancel"];class Ae{constructor(e,t,l,g){this._target=e,this._ngZone=t,this._platform=g,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,g.isBrowser&&(this._containerElement=Jt(l))}fadeInRipple(e,t,l={}){const g=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),b={...ji,...l.animation};l.centered&&(e=g.left+g.width/2,t=g.top+g.height/2);const M=l.radius||function Lr(d,e,t){const l=Math.max(Math.abs(d-t.left),Math.abs(d-t.right)),g=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(l*l+g*g)}(e,t,g),B=e-g.left,U=t-g.top,Q=b.enterDuration,ct=document.createElement("div");ct.classList.add("mat-ripple-element"),ct.style.left=B-M+"px",ct.style.top=U-M+"px",ct.style.height=2*M+"px",ct.style.width=2*M+"px",null!=l.color&&(ct.style.backgroundColor=l.color),ct.style.transitionDuration=`${Q}ms`,this._containerElement.appendChild(ct);const lt=window.getComputedStyle(ct),it=lt.transitionDuration,_t="none"===lt.transitionProperty||"0s"===it||"0s, 0s"===it||0===g.width&&0===g.height,dt=new Ar(this,ct,l,_t);ct.style.transform="scale3d(1, 1, 1)",dt.state=0,l.persistent||(this._mostRecentTransientRipple=dt);let xt=null;return!_t&&(Q||b.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const It=()=>this._finishRippleTransition(dt),jt=()=>this._destroyRipple(dt);ct.addEventListener("transitionend",It),ct.addEventListener("transitioncancel",jt),xt={onTransitionEnd:It,onTransitionCancel:jt}}),this._activeRipples.set(dt,xt),(_t||!Q)&&this._finishRippleTransition(dt),dt}fadeOutRipple(e){if(2===e.state||3===e.state)return;const t=e.element,l={...ji,...e.config.animation};t.style.transitionDuration=`${l.exitDuration}ms`,t.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!l.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=Jt(e);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,Vi.forEach(l=>{Ae._eventManager.addHandler(this._ngZone,l,t,this)}))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Hi.forEach(t=>{this._triggerElement.addEventListener(t,this,Ni)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){0===e.state?this._startFadeOutTransition(e):2===e.state&&this._destroyRipple(e)}_startFadeOutTransition(e){const t=e===this._mostRecentTransientRipple,{persistent:l}=e.config;e.state=1,!l&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){const t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,null!==t&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){const t=ki(e),l=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!l&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!Ii(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let l=0;l<t.length;l++)this.fadeInRipple(t[l].clientX,t[l].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const e=this._triggerElement;e&&(Vi.forEach(t=>Ae._eventManager.removeHandler(t,e,this)),this._pointerUpEventsRegistered&&Hi.forEach(t=>e.removeEventListener(t,this,Ni)))}}Ae._eventManager=new Rr;let Xi=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[Bt,Bt]}),d})(),Ui=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[Bt,_.ez,Bt]}),d})();var _e=vt(4006);let Wi=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[Bt,_.ez,Xi]}),d})();vt(2843),vt(4128),vt(8505),vt(262),vt(8746),vt(3099),vt(4351),vt(1481);let un=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[Bt,Bt]}),d})();vt(7340);var Xs=vt(5577),Us=vt(1144),Wt=vt(576),Ys=vt(3268);const zs=["addListener","removeListener"],Ws=["addEventListener","removeEventListener"],Gs=["on","off"];function je(d,e,t,l){if((0,Wt.m)(t)&&(l=t,t=void 0),l)return je(d,e,t).pipe((0,Ys.Z)(l));const[g,b]=function Zs(d){return(0,Wt.m)(d.addEventListener)&&(0,Wt.m)(d.removeEventListener)}(d)?Ws.map(M=>B=>d[M](e,B,t)):function qs(d){return(0,Wt.m)(d.addListener)&&(0,Wt.m)(d.removeListener)}(d)?zs.map(dn(d,e)):function Ks(d){return(0,Wt.m)(d.on)&&(0,Wt.m)(d.off)}(d)?Gs.map(dn(d,e)):[];if(!g&&(0,Us.z)(d))return(0,Xs.z)(M=>je(M,e,t))((0,Ye.Xf)(d));if(!g)throw new TypeError("Invalid event target");return new Qt.y(M=>{const B=(...U)=>M.next(1<U.length?U:U[0]);return g(B),()=>b(B)})}function dn(d,e){return t=>l=>d[t](e,l)}const be={schedule(d){let e=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:l}=be;l&&(e=l.requestAnimationFrame,t=l.cancelAnimationFrame);const g=e(b=>{t=void 0,d(b)});return new de.w0(()=>t?.(g))},requestAnimationFrame(...d){const{delegate:e}=be;return(e?.requestAnimationFrame||requestAnimationFrame)(...d)},cancelAnimationFrame(...d){const{delegate:e}=be;return(e?.cancelAnimationFrame||cancelAnimationFrame)(...d)},delegate:void 0},Qs=new class Js extends Ge{flush(e){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:l}=this;let g;e=e||l.shift();do{if(g=e.execute(e.state,e.delay))break}while((e=l[0])&&e.id===t&&l.shift());if(this._active=!1,g){for(;(e=l[0])&&e.id===t&&l.shift();)e.unsubscribe();throw g}}}(class $s extends We{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,l=0){return null!==l&&l>0?super.requestAsyncId(e,t,l):(e.actions.push(this),e._scheduled||(e._scheduled=be.requestAnimationFrame(()=>e.flush(void 0))))}recycleAsyncId(e,t,l=0){var g;if(null!=l?l>0:this.delay>0)return super.recycleAsyncId(e,t,l);const{actions:b}=e;null!=t&&(null===(g=b[b.length-1])||void 0===g?void 0:g.id)!==t&&(be.cancelAnimationFrame(t),e._scheduled=void 0)}});let si,to=1;const Ne={};function fn(d){return d in Ne&&(delete Ne[d],!0)}const eo={setImmediate(d){const e=to++;return Ne[e]=!0,si||(si=Promise.resolve()),si.then(()=>fn(e)&&d()),e},clearImmediate(d){fn(d)}},{setImmediate:io,clearImmediate:no}=eo,Ve={setImmediate(...d){const{delegate:e}=Ve;return(e?.setImmediate||io)(...d)},clearImmediate(d){const{delegate:e}=Ve;return(e?.clearImmediate||no)(d)},delegate:void 0},oo=new class so extends Ge{flush(e){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:l}=this;let g;e=e||l.shift();do{if(g=e.execute(e.state,e.delay))break}while((e=l[0])&&e.id===t&&l.shift());if(this._active=!1,g){for(;(e=l[0])&&e.id===t&&l.shift();)e.unsubscribe();throw g}}}(class ro extends We{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,l=0){return null!==l&&l>0?super.requestAsyncId(e,t,l):(e.actions.push(this),e._scheduled||(e._scheduled=Ve.setImmediate(e.flush.bind(e,void 0))))}recycleAsyncId(e,t,l=0){var g;if(null!=l?l>0:this.delay>0)return super.recycleAsyncId(e,t,l);const{actions:b}=e;null!=t&&(null===(g=b[b.length-1])||void 0===g?void 0:g.id)!==t&&(Ve.clearImmediate(t),e._scheduled=void 0)}});var lo=vt(3532);function oi(d,e=qe){return function ao(d){return(0,Oe.e)((e,t)=>{let l=!1,g=null,b=null,M=!1;const B=()=>{if(b?.unsubscribe(),b=null,l){l=!1;const Q=g;g=null,t.next(Q)}M&&t.complete()},U=()=>{b=null,M&&t.complete()};e.subscribe((0,he.x)(t,Q=>{l=!0,g=Q,b||(0,Ye.Xf)(d(Q)).subscribe(b=(0,he.x)(t,B,U))},()=>{M=!0,(!l||!b||b.closed)&&t.complete()}))})}(()=>function ho(d=0,e,t=sr){let l=-1;return null!=e&&((0,lo.K)(e)?t=e:l=e),new Qt.y(g=>{let b=function co(d){return d instanceof Date&&!isNaN(d)}(d)?+d-t.now():d;b<0&&(b=0);let M=0;return t.schedule(function(){g.closed||(g.next(M++),0<=l?this.schedule(void 0,l):g.complete())},b)})}(d,e))}const uo=["contentWrapper"],fo=["*"],po=new C.OlP("VIRTUAL_SCROLL_STRATEGY");let Ce=(()=>{class d{constructor(t,l,g){this._ngZone=t,this._platform=l,this._scrolled=new O.x,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=g}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const l=this.scrollContainers.get(t);l&&(l.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new Qt.y(l=>{this._globalSubscription||this._addGlobalListener();const g=t>0?this._scrolled.pipe(oi(t)).subscribe(l):this._scrolled.subscribe(l);return this._scrolledCount++,()=>{g.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,P.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,l)=>this.deregister(l)),this._scrolled.complete()}ancestorScrolled(t,l){const g=this.getAncestorScrollContainers(t);return this.scrolled(l).pipe((0,Ue.h)(b=>!b||g.indexOf(b)>-1))}getAncestorScrollContainers(t){const l=[];return this.scrollContainers.forEach((g,b)=>{this._scrollableContainsElement(b,t)&&l.push(b)}),l}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,l){let g=Jt(l),b=t.getElementRef().nativeElement;do{if(g==b)return!0}while(g=g.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>je(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(C.R0b),C.LFG(At),C.LFG(_.K0,8))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),pn=(()=>{class d{constructor(t,l,g,b){this.elementRef=t,this.scrollDispatcher=l,this.ngZone=g,this.dir=b,this._destroyed=new O.x,this._elementScrolled=new Qt.y(M=>this.ngZone.runOutsideAngular(()=>je(this.elementRef.nativeElement,"scroll").pipe(Rt(this._destroyed)).subscribe(M)))}ngOnInit(){this.scrollDispatcher.register(this)}ngOnDestroy(){this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(t){const l=this.elementRef.nativeElement,g=this.dir&&"rtl"==this.dir.value;null==t.left&&(t.left=g?t.end:t.start),null==t.right&&(t.right=g?t.start:t.end),null!=t.bottom&&(t.top=l.scrollHeight-l.clientHeight-t.bottom),g&&0!=c()?(null!=t.left&&(t.right=l.scrollWidth-l.clientWidth-t.left),2==c()?t.left=t.right:1==c()&&(t.left=t.right?-t.right:t.right)):null!=t.right&&(t.left=l.scrollWidth-l.clientWidth-t.right),this._applyScrollToOptions(t)}_applyScrollToOptions(t){const l=this.elementRef.nativeElement;o()?l.scrollTo(t):(null!=t.top&&(l.scrollTop=t.top),null!=t.left&&(l.scrollLeft=t.left))}measureScrollOffset(t){const l="left",g="right",b=this.elementRef.nativeElement;if("top"==t)return b.scrollTop;if("bottom"==t)return b.scrollHeight-b.clientHeight-b.scrollTop;const M=this.dir&&"rtl"==this.dir.value;return"start"==t?t=M?g:l:"end"==t&&(t=M?l:g),M&&2==c()?t==l?b.scrollWidth-b.clientWidth-b.scrollLeft:b.scrollLeft:M&&1==c()?t==l?b.scrollLeft+b.scrollWidth-b.clientWidth:-b.scrollLeft:t==l?b.scrollLeft:b.scrollWidth-b.clientWidth-b.scrollLeft}}return d.\u0275fac=function(t){return new(t||d)(C.Y36(C.SBq),C.Y36(Ce),C.Y36(C.R0b),C.Y36(pe,8))},d.\u0275dir=C.lG2({type:d,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]],standalone:!0}),d})(),ai=(()=>{class d{constructor(t,l,g){this._platform=t,this._change=new O.x,this._changeListener=b=>{this._change.next(b)},this._document=g,l.runOutsideAngular(()=>{if(t.isBrowser){const b=this._getWindow();b.addEventListener("resize",this._changeListener),b.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:l,height:g}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+g,right:t.left+l,height:g,width:l}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,l=this._getWindow(),g=t.documentElement,b=g.getBoundingClientRect();return{top:-b.top||t.body.scrollTop||l.scrollY||g.scrollTop||0,left:-b.left||t.body.scrollLeft||l.scrollX||g.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(oi(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(At),C.LFG(C.R0b),C.LFG(_.K0,8))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();const mn=new C.OlP("VIRTUAL_SCROLLABLE");let _o=(()=>{class d extends pn{constructor(t,l,g,b){super(t,l,g,b)}measureViewportSize(t){const l=this.elementRef.nativeElement;return"horizontal"===t?l.clientWidth:l.clientHeight}}return d.\u0275fac=function(t){return new(t||d)(C.Y36(C.SBq),C.Y36(Ce),C.Y36(C.R0b),C.Y36(pe,8))},d.\u0275dir=C.lG2({type:d,features:[C.qOj]}),d})();const yo=typeof requestAnimationFrame<"u"?Qs:oo;let bo=(()=>{class d extends _o{constructor(t,l,g,b,M,B,U,Q){super(t,B,g,M),this.elementRef=t,this._changeDetectorRef=l,this._scrollStrategy=b,this.scrollable=Q,this._platform=(0,C.f3M)(At),this._detachedSubject=new O.x,this._renderedRangeSubject=new O.x,this._orientation="vertical",this._appendOnly=!1,this.scrolledIndexChange=new Qt.y(ct=>this._scrollStrategy.scrolledIndexChange.subscribe(lt=>Promise.resolve().then(()=>this.ngZone.run(()=>ct.next(lt))))),this.renderedRangeStream=this._renderedRangeSubject,this._totalContentSize=0,this._totalContentWidth="",this._totalContentHeight="",this._renderedRange={start:0,end:0},this._dataLength=0,this._viewportSize=0,this._renderedContentOffset=0,this._renderedContentOffsetNeedsRewrite=!1,this._isChangeDetectionPending=!1,this._runAfterChangeDetection=[],this._viewportChanges=de.w0.EMPTY,this._viewportChanges=U.change().subscribe(()=>{this.checkViewportSize()}),this.scrollable||(this.elementRef.nativeElement.classList.add("cdk-virtual-scrollable"),this.scrollable=this)}get orientation(){return this._orientation}set orientation(t){this._orientation!==t&&(this._orientation=t,this._calculateSpacerSize())}get appendOnly(){return this._appendOnly}set appendOnly(t){this._appendOnly=ue(t)}ngOnInit(){!this._platform.isBrowser||(this.scrollable===this&&super.ngOnInit(),this.ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>{this._measureViewportSize(),this._scrollStrategy.attach(this),this.scrollable.elementScrolled().pipe((0,xi.O)(null),oi(0,yo)).subscribe(()=>this._scrollStrategy.onContentScrolled()),this._markChangeDetectionNeeded()})))}ngOnDestroy(){this.detach(),this._scrollStrategy.detach(),this._renderedRangeSubject.complete(),this._detachedSubject.complete(),this._viewportChanges.unsubscribe(),super.ngOnDestroy()}attach(t){this.ngZone.runOutsideAngular(()=>{this._forOf=t,this._forOf.dataStream.pipe(Rt(this._detachedSubject)).subscribe(l=>{const g=l.length;g!==this._dataLength&&(this._dataLength=g,this._scrollStrategy.onDataLengthChanged()),this._doChangeDetection()})})}detach(){this._forOf=null,this._detachedSubject.next()}getDataLength(){return this._dataLength}getViewportSize(){return this._viewportSize}getRenderedRange(){return this._renderedRange}measureBoundingClientRectWithScrollOffset(t){return this.getElementRef().nativeElement.getBoundingClientRect()[t]}setTotalContentSize(t){this._totalContentSize!==t&&(this._totalContentSize=t,this._calculateSpacerSize(),this._markChangeDetectionNeeded())}setRenderedRange(t){(function vo(d,e){return d.start==e.start&&d.end==e.end})(this._renderedRange,t)||(this.appendOnly&&(t={start:0,end:Math.max(this._renderedRange.end,t.end)}),this._renderedRangeSubject.next(this._renderedRange=t),this._markChangeDetectionNeeded(()=>this._scrollStrategy.onContentRendered()))}getOffsetToRenderedContentStart(){return this._renderedContentOffsetNeedsRewrite?null:this._renderedContentOffset}setRenderedContentOffset(t,l="to-start"){t=this.appendOnly&&"to-start"===l?0:t;const b="horizontal"==this.orientation,M=b?"X":"Y";let U=`translate${M}(${Number((b&&this.dir&&"rtl"==this.dir.value?-1:1)*t)}px)`;this._renderedContentOffset=t,"to-end"===l&&(U+=` translate${M}(-100%)`,this._renderedContentOffsetNeedsRewrite=!0),this._renderedContentTransform!=U&&(this._renderedContentTransform=U,this._markChangeDetectionNeeded(()=>{this._renderedContentOffsetNeedsRewrite?(this._renderedContentOffset-=this.measureRenderedContentSize(),this._renderedContentOffsetNeedsRewrite=!1,this.setRenderedContentOffset(this._renderedContentOffset)):this._scrollStrategy.onRenderedOffsetChanged()}))}scrollToOffset(t,l="auto"){const g={behavior:l};"horizontal"===this.orientation?g.start=t:g.top=t,this.scrollable.scrollTo(g)}scrollToIndex(t,l="auto"){this._scrollStrategy.scrollToIndex(t,l)}measureScrollOffset(t){let l;return l=this.scrollable==this?g=>super.measureScrollOffset(g):g=>this.scrollable.measureScrollOffset(g),Math.max(0,l(t??("horizontal"===this.orientation?"start":"top"))-this.measureViewportOffset())}measureViewportOffset(t){let l;const g="left",b="right",M="rtl"==this.dir?.value;l="start"==t?M?b:g:"end"==t?M?g:b:t||("horizontal"===this.orientation?"left":"top");const B=this.scrollable.measureBoundingClientRectWithScrollOffset(l);return this.elementRef.nativeElement.getBoundingClientRect()[l]-B}measureRenderedContentSize(){const t=this._contentWrapper.nativeElement;return"horizontal"===this.orientation?t.offsetWidth:t.offsetHeight}measureRangeSize(t){return this._forOf?this._forOf.measureRangeSize(t,this.orientation):0}checkViewportSize(){this._measureViewportSize(),this._scrollStrategy.onDataLengthChanged()}_measureViewportSize(){this._viewportSize=this.scrollable.measureViewportSize(this.orientation)}_markChangeDetectionNeeded(t){t&&this._runAfterChangeDetection.push(t),this._isChangeDetectionPending||(this._isChangeDetectionPending=!0,this.ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>{this._doChangeDetection()})))}_doChangeDetection(){this._isChangeDetectionPending=!1,this._contentWrapper.nativeElement.style.transform=this._renderedContentTransform,this.ngZone.run(()=>this._changeDetectorRef.markForCheck());const t=this._runAfterChangeDetection;this._runAfterChangeDetection=[];for(const l of t)l()}_calculateSpacerSize(){this._totalContentHeight="horizontal"===this.orientation?"":`${this._totalContentSize}px`,this._totalContentWidth="horizontal"===this.orientation?`${this._totalContentSize}px`:""}}return d.\u0275fac=function(t){return new(t||d)(C.Y36(C.SBq),C.Y36(C.sBO),C.Y36(C.R0b),C.Y36(po,8),C.Y36(pe,8),C.Y36(Ce),C.Y36(ai),C.Y36(mn,8))},d.\u0275cmp=C.Xpm({type:d,selectors:[["cdk-virtual-scroll-viewport"]],viewQuery:function(t,l){if(1&t&&C.Gf(uo,7),2&t){let g;C.iGM(g=C.CRH())&&(l._contentWrapper=g.first)}},hostAttrs:[1,"cdk-virtual-scroll-viewport"],hostVars:4,hostBindings:function(t,l){2&t&&C.ekj("cdk-virtual-scroll-orientation-horizontal","horizontal"===l.orientation)("cdk-virtual-scroll-orientation-vertical","horizontal"!==l.orientation)},inputs:{orientation:"orientation",appendOnly:"appendOnly"},outputs:{scrolledIndexChange:"scrolledIndexChange"},standalone:!0,features:[C._Bn([{provide:pn,useFactory:(e,t)=>e||t,deps:[[new C.FiY,new C.tBr(mn)],d]}]),C.qOj,C.jDz],ngContentSelectors:fo,decls:4,vars:4,consts:[[1,"cdk-virtual-scroll-content-wrapper"],["contentWrapper",""],[1,"cdk-virtual-scroll-spacer"]],template:function(t,l){1&t&&(C.F$t(),C.TgZ(0,"div",0,1),C.Hsn(2),C.qZA(),C._UZ(3,"div",2)),2&t&&(C.xp6(3),C.Udp("width",l._totalContentWidth)("height",l._totalContentHeight))},styles:["cdk-virtual-scroll-viewport{display:block;position:relative;transform:translateZ(0)}.cdk-virtual-scrollable{overflow:auto;will-change:scroll-position;contain:strict;-webkit-overflow-scrolling:touch}.cdk-virtual-scroll-content-wrapper{position:absolute;top:0;left:0;contain:content}[dir=rtl] .cdk-virtual-scroll-content-wrapper{right:0;left:auto}.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper{min-height:100%}.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>dl:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>ol:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>table:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-horizontal .cdk-virtual-scroll-content-wrapper>ul:not([cdkVirtualFor]){padding-left:0;padding-right:0;margin-left:0;margin-right:0;border-left-width:0;border-right-width:0;outline:none}.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper{min-width:100%}.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>dl:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>ol:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>table:not([cdkVirtualFor]),.cdk-virtual-scroll-orientation-vertical .cdk-virtual-scroll-content-wrapper>ul:not([cdkVirtualFor]){padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;border-top-width:0;border-bottom-width:0;outline:none}.cdk-virtual-scroll-spacer{height:1px;transform-origin:0 0;flex:0 0 auto}[dir=rtl] .cdk-virtual-scroll-spacer{transform-origin:100% 0}"],encapsulation:2,changeDetection:0}),d})(),He=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({}),d})(),gn=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[me,He,bo,me,He]}),d})();class li{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class _n extends li{constructor(e,t,l,g,b){super(),this.component=e,this.viewContainerRef=t,this.injector=l,this.componentFactoryResolver=g,this.projectableNodes=b}}class Co extends li{constructor(e,t,l,g){super(),this.templateRef=e,this.viewContainerRef=t,this.context=l,this.injector=g}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class xo extends li{constructor(e){super(),this.element=e instanceof C.SBq?e.nativeElement:e}}class wo{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof _n?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof Co?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof xo?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class So extends wo{constructor(e,t,l,g,b){super(),this.outletElement=e,this._componentFactoryResolver=t,this._appRef=l,this._defaultInjector=g,this.attachDomPortal=M=>{const B=M.element,U=this._document.createComment("dom-portal");B.parentNode.insertBefore(U,B),this.outletElement.appendChild(B),this._attachedPortal=M,super.setDisposeFn(()=>{U.parentNode&&U.parentNode.replaceChild(B,U)})},this._document=b}attachComponentPortal(e){const l=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let g;return e.viewContainerRef?(g=e.viewContainerRef.createComponent(l,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector,e.projectableNodes||void 0),this.setDisposeFn(()=>g.destroy())):(g=l.create(e.injector||this._defaultInjector||C.zs3.NULL),this._appRef.attachView(g.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(g.hostView),g.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(g)),this._attachedPortal=e,g}attachTemplatePortal(e){let t=e.viewContainerRef,l=t.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return l.rootNodes.forEach(g=>this.outletElement.appendChild(g)),l.detectChanges(),this.setDisposeFn(()=>{let g=t.indexOf(l);-1!==g&&t.remove(g)}),this._attachedPortal=e,l}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let To=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({}),d})();var Mo=vt(6451);const vn=o();class Oo{constructor(e,t){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=kt(-this._previousScrollPosition.left),e.style.top=kt(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,l=e.style,g=this._document.body.style,b=l.scrollBehavior||"",M=g.scrollBehavior||"";this._isEnabled=!1,l.left=this._previousHTMLStyles.left,l.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),vn&&(l.scrollBehavior=g.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),vn&&(l.scrollBehavior=b,g.scrollBehavior=M)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,l=this._viewportRuler.getViewportSize();return t.scrollHeight>l.height||t.scrollWidth>l.width}}class Eo{constructor(e,t,l,g){this._scrollDispatcher=e,this._ngZone=t,this._viewportRuler=l,this._config=g,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class yn{enable(){}disable(){}attach(){}}function ci(d,e){return e.some(t=>d.bottom<t.top||d.top>t.bottom||d.right<t.left||d.left>t.right)}function bn(d,e){return e.some(t=>d.top<t.top||d.bottom>t.bottom||d.left<t.left||d.right>t.right)}class ko{constructor(e,t,l,g){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=l,this._config=g,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:l,height:g}=this._viewportRuler.getViewportSize();ci(t,[{width:l,height:g,bottom:g,right:l,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let Io=(()=>{class d{constructor(t,l,g,b){this._scrollDispatcher=t,this._viewportRuler=l,this._ngZone=g,this.noop=()=>new yn,this.close=M=>new Eo(this._scrollDispatcher,this._ngZone,this._viewportRuler,M),this.block=()=>new Oo(this._viewportRuler,this._document),this.reposition=M=>new ko(this._scrollDispatcher,this._viewportRuler,this._ngZone,M),this._document=b}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(Ce),C.LFG(ai),C.LFG(C.R0b),C.LFG(_.K0))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();class Do{constructor(e){if(this.scrollStrategy=new yn,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const t=Object.keys(e);for(const l of t)void 0!==e[l]&&(this[l]=e[l])}}}class Po{constructor(e,t){this.connectionPair=e,this.scrollableViewProperties=t}}let Cn=(()=>{class d{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const l=this._attachedOverlays.indexOf(t);l>-1&&this._attachedOverlays.splice(l,1),0===this._attachedOverlays.length&&this.detach()}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(_.K0))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),Ao=(()=>{class d extends Cn{constructor(t,l){super(t),this._ngZone=l,this._keydownListener=g=>{const b=this._attachedOverlays;for(let M=b.length-1;M>-1;M--)if(b[M]._keydownEvents.observers.length>0){const B=b[M]._keydownEvents;this._ngZone?this._ngZone.run(()=>B.next(g)):B.next(g);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(_.K0),C.LFG(C.R0b,8))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),Ro=(()=>{class d extends Cn{constructor(t,l,g){super(t),this._platform=l,this._ngZone=g,this._cursorStyleIsSet=!1,this._pointerDownListener=b=>{this._pointerDownEventTarget=y(b)},this._clickListener=b=>{const M=y(b),B="click"===b.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:M;this._pointerDownEventTarget=null;const U=this._attachedOverlays.slice();for(let Q=U.length-1;Q>-1;Q--){const ct=U[Q];if(ct._outsidePointerEvents.observers.length<1||!ct.hasAttached())continue;if(ct.overlayElement.contains(M)||ct.overlayElement.contains(B))break;const lt=ct._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>lt.next(b)):lt.next(b)}}}add(t){if(super.add(t),!this._isAttached){const l=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(l)):this._addEventListeners(l),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=l.style.cursor,l.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(_.K0),C.LFG(At),C.LFG(C.R0b,8))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),xn=(()=>{class d{constructor(t,l){this._platform=l,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||x()){const g=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let b=0;b<g.length;b++)g[b].remove()}const l=this._document.createElement("div");l.classList.add(t),x()?l.setAttribute("platform","test"):this._platform.isBrowser||l.setAttribute("platform","server"),this._document.body.appendChild(l),this._containerElement=l}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(_.K0),C.LFG(At))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();class Fo{constructor(e,t,l,g,b,M,B,U,Q,ct=!1){this._portalOutlet=e,this._host=t,this._pane=l,this._config=g,this._ngZone=b,this._keyboardDispatcher=M,this._document=B,this._location=U,this._outsideClickDispatcher=Q,this._animationsDisabled=ct,this._backdropElement=null,this._backdropClick=new O.x,this._attachments=new O.x,this._detachments=new O.x,this._locationChanges=de.w0.EMPTY,this._backdropClickHandler=lt=>this._backdropClick.next(lt),this._backdropTransitionendHandler=lt=>{this._disposeBackdrop(lt.target)},this._keydownEvents=new O.x,this._outsidePointerEvents=new O.x,g.scrollStrategy&&(this._scrollStrategy=g.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=g.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,ze.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config={...this._config,...e},this._updateElementSize()}setDirection(e){this._config={...this._config,direction:e},this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=kt(this._config.width),e.height=kt(this._config.height),e.minWidth=kt(this._config.minWidth),e.minHeight=kt(this._config.minHeight),e.maxWidth=kt(this._config.maxWidth),e.maxHeight=kt(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const e=this._backdropElement;if(e){if(this._animationsDisabled)return void this._disposeBackdrop(e);e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",this._backdropTransitionendHandler)}),e.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(e)},500))}}_toggleClasses(e,t,l){const g=Ee(t||[]).filter(b=>!!b);g.length&&(l?e.classList.add(...g):e.classList.remove(...g))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe(Rt((0,Mo.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",this._backdropTransitionendHandler),e.remove(),this._backdropElement===e&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const wn="cdk-overlay-connected-position-bounding-box",Lo=/([A-Za-z%]+)$/;class Bo{constructor(e,t,l,g,b){this._viewportRuler=t,this._document=l,this._platform=g,this._overlayContainer=b,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new O.x,this._resizeSubscription=de.w0.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}get positions(){return this._preferredPositions}attach(e){this._validatePositions(),e.hostElement.classList.add(wn),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._originRect,t=this._overlayRect,l=this._viewportRect,g=this._containerRect,b=[];let M;for(let B of this._preferredPositions){let U=this._getOriginPoint(e,g,B),Q=this._getOverlayPoint(U,t,B),ct=this._getOverlayFit(Q,t,l,B);if(ct.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(B,U);this._canFitWithFlexibleDimensions(ct,Q,l)?b.push({position:B,origin:U,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(U,B)}):(!M||M.overlayFit.visibleArea<ct.visibleArea)&&(M={overlayFit:ct,overlayPoint:Q,originPoint:U,position:B,overlayRect:t})}if(b.length){let B=null,U=-1;for(const Q of b){const ct=Q.boundingBoxRect.width*Q.boundingBoxRect.height*(Q.position.weight||1);ct>U&&(U=ct,B=Q)}return this._isPushed=!1,void this._applyPosition(B.position,B.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(M.position,M.originPoint);this._applyPosition(M.position,M.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Gt(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(wn),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const e=this._lastPosition;if(e){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,e);this._applyPosition(e,t)}else this.apply()}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,t,l){let g,b;if("center"==l.originX)g=e.left+e.width/2;else{const M=this._isRtl()?e.right:e.left,B=this._isRtl()?e.left:e.right;g="start"==l.originX?M:B}return t.left<0&&(g-=t.left),b="center"==l.originY?e.top+e.height/2:"top"==l.originY?e.top:e.bottom,t.top<0&&(b-=t.top),{x:g,y:b}}_getOverlayPoint(e,t,l){let g,b;return g="center"==l.overlayX?-t.width/2:"start"===l.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,b="center"==l.overlayY?-t.height/2:"top"==l.overlayY?0:-t.height,{x:e.x+g,y:e.y+b}}_getOverlayFit(e,t,l,g){const b=Tn(t);let{x:M,y:B}=e,U=this._getOffset(g,"x"),Q=this._getOffset(g,"y");U&&(M+=U),Q&&(B+=Q);let nt=0-B,it=B+b.height-l.height,_t=this._subtractOverflows(b.width,0-M,M+b.width-l.width),dt=this._subtractOverflows(b.height,nt,it),xt=_t*dt;return{visibleArea:xt,isCompletelyWithinViewport:b.width*b.height===xt,fitsInViewportVertically:dt===b.height,fitsInViewportHorizontally:_t==b.width}}_canFitWithFlexibleDimensions(e,t,l){if(this._hasFlexibleDimensions){const g=l.bottom-t.y,b=l.right-t.x,M=Sn(this._overlayRef.getConfig().minHeight),B=Sn(this._overlayRef.getConfig().minWidth),Q=e.fitsInViewportHorizontally||null!=B&&B<=b;return(e.fitsInViewportVertically||null!=M&&M<=g)&&Q}return!1}_pushOverlayOnScreen(e,t,l){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const g=Tn(t),b=this._viewportRect,M=Math.max(e.x+g.width-b.width,0),B=Math.max(e.y+g.height-b.height,0),U=Math.max(b.top-l.top-e.y,0),Q=Math.max(b.left-l.left-e.x,0);let ct=0,lt=0;return ct=g.width<=b.width?Q||-M:e.x<this._viewportMargin?b.left-l.left-e.x:0,lt=g.height<=b.height?U||-B:e.y<this._viewportMargin?b.top-l.top-e.y:0,this._previousPushAmount={x:ct,y:lt},{x:e.x+ct,y:e.y+lt}}_applyPosition(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const l=this._getScrollVisibility(),g=new Po(e,l);this._positionChanges.next(g)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let l,g=e.overlayY;l="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let b=0;b<t.length;b++)t[b].style.transformOrigin=`${l} ${g}`}_calculateBoundingBoxRect(e,t){const l=this._viewportRect,g=this._isRtl();let b,M,B,ct,lt,nt;if("top"===t.overlayY)M=e.y,b=l.height-M+this._viewportMargin;else if("bottom"===t.overlayY)B=l.height-e.y+2*this._viewportMargin,b=l.height-B+this._viewportMargin;else{const it=Math.min(l.bottom-e.y+l.top,e.y),_t=this._lastBoundingBoxSize.height;b=2*it,M=e.y-it,b>_t&&!this._isInitialRender&&!this._growAfterOpen&&(M=e.y-_t/2)}if("end"===t.overlayX&&!g||"start"===t.overlayX&&g)nt=l.width-e.x+this._viewportMargin,ct=e.x-this._viewportMargin;else if("start"===t.overlayX&&!g||"end"===t.overlayX&&g)lt=e.x,ct=l.right-e.x;else{const it=Math.min(l.right-e.x+l.left,e.x),_t=this._lastBoundingBoxSize.width;ct=2*it,lt=e.x-it,ct>_t&&!this._isInitialRender&&!this._growAfterOpen&&(lt=e.x-_t/2)}return{top:M,left:lt,bottom:B,right:nt,width:ct,height:b}}_setBoundingBoxStyles(e,t){const l=this._calculateBoundingBoxRect(e,t);!this._isInitialRender&&!this._growAfterOpen&&(l.height=Math.min(l.height,this._lastBoundingBoxSize.height),l.width=Math.min(l.width,this._lastBoundingBoxSize.width));const g={};if(this._hasExactPosition())g.top=g.left="0",g.bottom=g.right=g.maxHeight=g.maxWidth="",g.width=g.height="100%";else{const b=this._overlayRef.getConfig().maxHeight,M=this._overlayRef.getConfig().maxWidth;g.height=kt(l.height),g.top=kt(l.top),g.bottom=kt(l.bottom),g.width=kt(l.width),g.left=kt(l.left),g.right=kt(l.right),g.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",g.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",b&&(g.maxHeight=kt(b)),M&&(g.maxWidth=kt(M))}this._lastBoundingBoxSize=l,Gt(this._boundingBox.style,g)}_resetBoundingBoxStyles(){Gt(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Gt(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,t){const l={},g=this._hasExactPosition(),b=this._hasFlexibleDimensions,M=this._overlayRef.getConfig();if(g){const ct=this._viewportRuler.getViewportScrollPosition();Gt(l,this._getExactOverlayY(t,e,ct)),Gt(l,this._getExactOverlayX(t,e,ct))}else l.position="static";let B="",U=this._getOffset(t,"x"),Q=this._getOffset(t,"y");U&&(B+=`translateX(${U}px) `),Q&&(B+=`translateY(${Q}px)`),l.transform=B.trim(),M.maxHeight&&(g?l.maxHeight=kt(M.maxHeight):b&&(l.maxHeight="")),M.maxWidth&&(g?l.maxWidth=kt(M.maxWidth):b&&(l.maxWidth="")),Gt(this._pane.style,l)}_getExactOverlayY(e,t,l){let g={top:"",bottom:""},b=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(b=this._pushOverlayOnScreen(b,this._overlayRect,l)),"bottom"===e.overlayY?g.bottom=this._document.documentElement.clientHeight-(b.y+this._overlayRect.height)+"px":g.top=kt(b.y),g}_getExactOverlayX(e,t,l){let M,g={left:"",right:""},b=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(b=this._pushOverlayOnScreen(b,this._overlayRect,l)),M=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===M?g.right=this._document.documentElement.clientWidth-(b.x+this._overlayRect.width)+"px":g.left=kt(b.x),g}_getScrollVisibility(){const e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),l=this._scrollables.map(g=>g.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:bn(e,l),isOriginOutsideView:ci(e,l),isOverlayClipped:bn(t,l),isOverlayOutsideView:ci(t,l)}}_subtractOverflows(e,...t){return t.reduce((l,g)=>l-Math.max(g,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,l=this._viewportRuler.getViewportScrollPosition();return{top:l.top+this._viewportMargin,left:l.left+this._viewportMargin,right:l.left+e-this._viewportMargin,bottom:l.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,t){return"x"===t?null==e.offsetX?this._offsetX:e.offsetX:null==e.offsetY?this._offsetY:e.offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&Ee(e).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof C.SBq)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const t=e.width||0,l=e.height||0;return{top:e.y,bottom:e.y+l,left:e.x,right:e.x+t,height:l,width:t}}}function Gt(d,e){for(let t in e)e.hasOwnProperty(t)&&(d[t]=e[t]);return d}function Sn(d){if("number"!=typeof d&&null!=d){const[e,t]=d.split(Lo);return t&&"px"!==t?null:parseFloat(e)}return d||null}function Tn(d){return{top:Math.floor(d.top),right:Math.floor(d.right),bottom:Math.floor(d.bottom),left:Math.floor(d.left),width:Math.floor(d.width),height:Math.floor(d.height)}}const Mn="cdk-global-overlay-wrapper";class jo{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(e){const t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(Mn),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._xOffset=e,this._xPosition="left",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._xOffset=e,this._xPosition="right",this}start(e=""){return this._xOffset=e,this._xPosition="start",this}end(e=""){return this._xOffset=e,this._xPosition="end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._xPosition="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,l=this._overlayRef.getConfig(),{width:g,height:b,maxWidth:M,maxHeight:B}=l,U=!("100%"!==g&&"100vw"!==g||M&&"100%"!==M&&"100vw"!==M),Q=!("100%"!==b&&"100vh"!==b||B&&"100%"!==B&&"100vh"!==B),ct=this._xPosition,lt=this._xOffset,nt="rtl"===this._overlayRef.getConfig().direction;let it="",_t="",dt="";U?dt="flex-start":"center"===ct?(dt="center",nt?_t=lt:it=lt):nt?"left"===ct||"end"===ct?(dt="flex-end",it=lt):("right"===ct||"start"===ct)&&(dt="flex-start",_t=lt):"left"===ct||"start"===ct?(dt="flex-start",it=lt):("right"===ct||"end"===ct)&&(dt="flex-end",_t=lt),e.position=this._cssPosition,e.marginLeft=U?"0":it,e.marginTop=Q?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=U?"0":_t,t.justifyContent=dt,t.alignItems=Q?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,l=t.style;t.classList.remove(Mn),l.justifyContent=l.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let No=(()=>{class d{constructor(t,l,g,b){this._viewportRuler=t,this._document=l,this._platform=g,this._overlayContainer=b}global(){return new jo}flexibleConnectedTo(t){return new Bo(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(ai),C.LFG(_.K0),C.LFG(At),C.LFG(xn))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),Vo=0,xe=(()=>{class d{constructor(t,l,g,b,M,B,U,Q,ct,lt,nt,it){this.scrollStrategies=t,this._overlayContainer=l,this._componentFactoryResolver=g,this._positionBuilder=b,this._keyboardDispatcher=M,this._injector=B,this._ngZone=U,this._document=Q,this._directionality=ct,this._location=lt,this._outsideClickDispatcher=nt,this._animationsModuleType=it}create(t){const l=this._createHostElement(),g=this._createPaneElement(l),b=this._createPortalOutlet(g),M=new Do(t);return M.direction=M.direction||this._directionality.value,new Fo(b,l,g,M,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const l=this._document.createElement("div");return l.id="cdk-overlay-"+Vo++,l.classList.add("cdk-overlay-pane"),t.appendChild(l),l}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(C.z2F)),new So(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return d.\u0275fac=function(t){return new(t||d)(C.LFG(Io),C.LFG(xn),C.LFG(C._Vd),C.LFG(No),C.LFG(Ao),C.LFG(C.zs3),C.LFG(C.R0b),C.LFG(_.K0),C.LFG(pe),C.LFG(_.Ye),C.LFG(Ro),C.LFG(C.QbO,8))},d.\u0275prov=C.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();const Uo={provide:new C.OlP("cdk-connected-overlay-scroll-strategy"),deps:[xe],useFactory:function Xo(d){return()=>d.scrollStrategies.reposition()}};let On=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({providers:[xe,Uo],imports:[me,To,gn,gn]}),d})();const Go={provide:new C.OlP("mat-menu-scroll-strategy"),deps:[xe],useFactory:function Wo(d){return()=>d.scrollStrategies.reposition()}};let kn=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({providers:[Go],imports:[_.ez,Xi,Bt,On,He,Bt]}),d})();const qo=["tooltip"],In=new C.OlP("mat-tooltip-scroll-strategy"),$o={provide:In,deps:[xe],useFactory:function Zo(d){return()=>d.scrollStrategies.reposition({scrollThrottle:20})}},Qo=new C.OlP("mat-tooltip-default-options",{providedIn:"root",factory:function Jo(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),Dn="tooltip-panel",Pn=n({passive:!0});let sa=(()=>{class d{constructor(t,l,g,b,M,B,U,Q,ct,lt,nt,it){this._overlay=t,this._elementRef=l,this._scrollDispatcher=g,this._viewContainerRef=b,this._ngZone=M,this._platform=B,this._ariaDescriber=U,this._focusMonitor=Q,this._dir=lt,this._defaultOptions=nt,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new O.x,this._scrollStrategy=ct,this._document=it,nt&&(nt.position&&(this.position=nt.position),nt.positionAtOrigin&&(this.positionAtOrigin=nt.positionAtOrigin),nt.touchGestures&&(this.touchGestures=nt.touchGestures)),lt.change.pipe(Rt(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(t){this._positionAtOrigin=ue(t),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(t){this._disabled=ue(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=Vt(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=Vt(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Rt(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([l,g])=>{t.removeEventListener(l,g,Pn)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay,l){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const g=this._createOverlay(l);this._detach(),this._portal=this._portal||new _n(this._tooltipComponent,this._viewContainerRef);const b=this._tooltipInstance=g.attach(this._portal).instance;b._triggerElement=this._elementRef.nativeElement,b._mouseLeaveHideDelay=this._hideDelay,b.afterHidden().pipe(Rt(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),b.show(t)}hide(t=this.hideDelay){const l=this._tooltipInstance;l&&(l.isVisible()?l.hide(t):(l._cancelPendingAnimations(),this._detach()))}toggle(t){this._isTooltipVisible()?this.hide():this.show(void 0,t)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(t){if(this._overlayRef){const b=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!t)&&b._origin instanceof C.SBq)return this._overlayRef;this._detach()}const l=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),g=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&t||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(l);return g.positionChanges.pipe(Rt(this._destroyed)).subscribe(b=>{this._updateCurrentPositionClass(b.connectionPair),this._tooltipInstance&&b.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:g,panelClass:`${this._cssClassPrefix}-${Dn}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(Rt(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(Rt(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(Rt(this._destroyed)).subscribe(b=>{this._isTooltipVisible()&&27===b.keyCode&&!function Gn(d,...e){return e.length?e.some(t=>d[t]):d.altKey||d.shiftKey||d.ctrlKey||d.metaKey}(b)&&(b.preventDefault(),b.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const l=t.getConfig().positionStrategy,g=this._getOrigin(),b=this._getOverlayPosition();l.withPositions([this._addOffset({...g.main,...b.main}),this._addOffset({...g.fallback,...b.fallback})])}_addOffset(t){return t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,l=this.position;let g;"above"==l||"below"==l?g={originX:"center",originY:"above"==l?"top":"bottom"}:"before"==l||"left"==l&&t||"right"==l&&!t?g={originX:"start",originY:"center"}:("after"==l||"right"==l&&t||"left"==l&&!t)&&(g={originX:"end",originY:"center"});const{x:b,y:M}=this._invertPosition(g.originX,g.originY);return{main:g,fallback:{originX:b,originY:M}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,l=this.position;let g;"above"==l?g={overlayX:"center",overlayY:"bottom"}:"below"==l?g={overlayX:"center",overlayY:"top"}:"before"==l||"left"==l&&t||"right"==l&&!t?g={overlayX:"end",overlayY:"center"}:("after"==l||"right"==l&&t||"left"==l&&!t)&&(g={overlayX:"start",overlayY:"center"});const{x:b,y:M}=this._invertPosition(g.overlayX,g.overlayY);return{main:g,fallback:{overlayX:b,overlayY:M}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe((0,ze.q)(1),Rt(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,l){return"above"===this.position||"below"===this.position?"top"===l?l="bottom":"bottom"===l&&(l="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:l}}_updateCurrentPositionClass(t){const{overlayY:l,originX:g,originY:b}=t;let M;if(M="center"===l?this._dir&&"rtl"===this._dir.value?"end"===g?"left":"right":"start"===g?"left":"right":"bottom"===l&&"top"===b?"above":"below",M!==this._currentPosition){const B=this._overlayRef;if(B){const U=`${this._cssClassPrefix}-${Dn}-`;B.removePanelClass(U+this._currentPosition),B.addPanelClass(U+M)}this._currentPosition=M}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",t=>{let l;this._setupPointerExitEventsIfNeeded(),void 0!==t.x&&void 0!==t.y&&(l=t),this.show(void 0,l)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",t=>{const l=t.targetTouches?.[0],g=l?{x:l.clientX,y:l.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,g),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",l=>{const g=l.relatedTarget;(!g||!this._overlayRef?.overlayElement.contains(g))&&this.hide()}],["wheel",l=>this._wheelListener(l)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const l=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",l],["touchcancel",l])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([l,g])=>{this._elementRef.nativeElement.addEventListener(l,g,Pn)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const l=this._document.elementFromPoint(t.clientX,t.clientY),g=this._elementRef.nativeElement;l!==g&&!g.contains(l)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const l=this._elementRef.nativeElement,g=l.style;("on"===t||"INPUT"!==l.nodeName&&"TEXTAREA"!==l.nodeName)&&(g.userSelect=g.msUserSelect=g.webkitUserSelect=g.MozUserSelect="none"),("on"===t||!l.draggable)&&(g.webkitUserDrag="none"),g.touchAction="none",g.webkitTapHighlightColor="transparent"}}}return d.\u0275fac=function(t){C.$Z()},d.\u0275dir=C.lG2({type:d,inputs:{position:["matTooltipPosition","position"],positionAtOrigin:["matTooltipPositionAtOrigin","positionAtOrigin"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}}),d})(),oa=(()=>{class d extends sa{constructor(t,l,g,b,M,B,U,Q,ct,lt,nt,it){super(t,l,g,b,M,B,U,Q,ct,lt,nt,it),this._tooltipComponent=la,this._cssClassPrefix="mat-mdc",this._viewportMargin=8}_addOffset(t){const g=!this._dir||"ltr"==this._dir.value;return"top"===t.originY?t.offsetY=-8:"bottom"===t.originY?t.offsetY=8:"start"===t.originX?t.offsetX=g?-8:8:"end"===t.originX&&(t.offsetX=g?8:-8),t}}return d.\u0275fac=function(t){return new(t||d)(C.Y36(xe),C.Y36(C.SBq),C.Y36(Ce),C.Y36(C.s_b),C.Y36(C.R0b),C.Y36(At),C.Y36(fr),C.Y36(Sr),C.Y36(In),C.Y36(pe,8),C.Y36(Qo,8),C.Y36(_.K0))},d.\u0275dir=C.lG2({type:d,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],exportAs:["matTooltip"],features:[C.qOj]}),d})(),aa=(()=>{class d{constructor(t,l){this._changeDetectorRef=t,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new O.x,this._animationsDisabled="NoopAnimations"===l}show(t){clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const l=this._tooltip.nativeElement,g=this._showAnimation,b=this._hideAnimation;if(l.classList.remove(t?b:g),l.classList.add(t?g:b),this._isVisible=t,t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const M=getComputedStyle(l);("0s"===M.getPropertyValue("animation-duration")||"none"===M.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(l.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}}return d.\u0275fac=function(t){return new(t||d)(C.Y36(C.sBO),C.Y36(C.QbO,8))},d.\u0275dir=C.lG2({type:d}),d})(),la=(()=>{class d extends aa{constructor(t,l,g){super(t,g),this._elementRef=l,this._isMultiline=!1,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide"}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const t=this._elementRef.nativeElement.getBoundingClientRect();return t.height>24&&t.width>=200}}return d.\u0275fac=function(t){return new(t||d)(C.Y36(C.sBO),C.Y36(C.SBq),C.Y36(C.QbO,8))},d.\u0275cmp=C.Xpm({type:d,selectors:[["mat-tooltip-component"]],viewQuery:function(t,l){if(1&t&&C.Gf(qo,7),2&t){let g;C.iGM(g=C.CRH())&&(l._tooltip=g.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(t,l){1&t&&C.NdJ("mouseleave",function(b){return l._handleMouseLeave(b)}),2&t&&C.Udp("zoom",l.isVisible()?1:null)},features:[C.qOj],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(t,l){1&t&&(C.TgZ(0,"div",0,1),C.NdJ("animationend",function(b){return l._handleAnimationEnd(b)}),C.TgZ(2,"div",2),C._uU(3),C.qZA()()),2&t&&(C.ekj("mdc-tooltip--multiline",l._isMultiline),C.Q6J("ngClass",l.tooltipClass),C.xp6(3),C.Oqu(l.message))},dependencies:[_.mk],styles:['.mdc-tooltip__surface{word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - (2 * 8px));margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - (2 * 8px));align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color, #fff)}.mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape, var(--mdc-shape-small, 4px))}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape, var(--mdc-shape-small, 4px))}.mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color, #000)}.mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font, inherit);font-size:var(--mdc-plain-tooltip-supporting-text-size, inherit);font-weight:var(--mdc-plain-tooltip-supporting-text-weight, inherit);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking, inherit)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:-8px;right:-8px;bottom:-8px;left:-8px;z-index:-1;position:absolute}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0}),d})(),An=(()=>{class d{}return d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({providers:[$o],imports:[Tr,_.ez,On,Bt,Bt,He]}),d})();class re{}re.\u0275fac=function(e){return new(e||re)},re.\u0275mod=C.oAB({type:re}),re.\u0275inj=C.cJS({imports:[_.ez,Ui,Wi,un,kn,An,Ui,Wi,un,kn,An]});var Rn=vt(3321),Tt=vt(8621);function Fn(d,e){Tt.fabric.Object.prototype.set({transparentCorners:!1,cornerColor:d,cornerStrokeColor:d,borderColor:d,cornerSize:12,padding:10,cornerStyle:"rect",borderDashArray:[3,3]}),e.selectionBorderColor=d}const ca=[{type:"brush",handler:"tool",tools:[{name:"Pencil",toolCode:"pencil",icon:"fa-solid fa-pencil",display:!0},{name:"Spray Brush",toolCode:"spraybrush",icon:"fa-solid fa-paintbrush",display:!0},{name:"Circle Brush",toolCode:"circlebrush",icon:"fa-solid fa-circle",display:!0}],icon:"fa-solid fa-pencil",lastUsed:null},{type:"selector",handler:"tool",tools:[{name:"Laser",toolCode:"laser",icon:"fa-solid  fa-wand-magic-sparkles",display:!0},{name:"Selector",toolCode:"selector",icon:"fa-solid  fa-arrow-pointer",display:!0},{name:"Pointer",toolCode:"pointer",icon:"fa-solid fa-hand-point-up",display:!0}],icon:"fa-solid  fa-arrow-pointer",lastUsed:null},{type:"Shape",handler:"tool",tools:[{name:"Circle",toolCode:"circle",icon:"fa-regular fa-circle",display:!0},{name:"Square",toolCode:"square",icon:"fa-regular fa-square-full",display:!0},{name:"Line",toolCode:"line",icon:"fa-solid fa-slash",display:!0}],icon:"fa-solid  fa-shapes",lastUsed:null}],hi=typeof Tt.fabric>"u"?vt(8621).fabric:Tt.fabric,Ln=hi.util.createClass(hi.BaseBrush,{initialize:function(d){this.canvas=d,console.log("kkk")},onMouseDown:function(d,e){var t=this.canvas.findTarget(d,!0);t&&(console.log(t,t.type),this.canvas.remove(t))},onMouseMove:function(d,e){},onMouseUp:function(d){}});hi.ClickEraser=Ln;const ha=Ln,ui=typeof Tt.fabric>"u"?vt(8621).fabric:Tt.fabric,Bn=ui.util.createClass(ui.BaseBrush,{initialize:function(d){this.canvas=d,this._points=[],this.ctx=this.canvas.contextTop,this.interval=null,this.canRemove=!0},drawSegment(d,e,t){const l=e.midPointFrom(t);return d.quadraticCurveTo(e.x,e.y,l.x,l.y),l},onMouseDown:function(d,e){this._points.push(d),this._render(this.ctx),this.interval=setInterval(()=>{this._points.shift(),this._render(this.ctx)},35)},onMouseMove:function(d,e){this._points.push(d),this._render(this.ctx),this._points.length>100&&!this.rateIncrease&&(clearInterval(this.interval),this.interval=setInterval(()=>{this._points.shift(),this._render(this.ctx)},30),this.rateIncrease=!0,console.log("here")),this._points.length<100&&this.rateIncrease&&(clearInterval(this.interval),this.interval=setInterval(()=>{this._points.shift(),this._render(this.ctx)},60),this.rateIncrease=!1,console.log("here 2"))},onMouseUp:function(d){this.canvas.clearContext(this.canvas.contextTop),this._points=[],clearInterval(this.interval)},_render(d){this.canvas.clearContext(this.canvas.contextTop);let e=this._points[0],t=this._points[1];if(this._saveAndTransform(d),d.beginPath(),d.strokeStyle=this.color,d.fillStyle=this.color,d.shadowColor=this.color,d.shadowBlur=2,d.shadowOffsetX=2,d.shadowOffsetY=2,2===this._points.length&&e.x===t.x&&e.y===t.y){const l=this.width/1e3;e.x-=l,t.x+=l}e&&d.moveTo(e.x,e.y);for(let l=1;l<this._points.length;l++){d.lineWidth=l/this._points.length*3,this.drawSegment(d,e,t),d.stroke(),d.beginPath();let g=e.midPointFrom(t);d.moveTo(g.x,g.y),e=this._points[l],t=this._points[l+1]}e&&d.lineTo(e.x,e.y),d.stroke(),d.restore()}});ui.Laser=Bn;const ua=Bn;var qt=function(d){var e={};function t(l){if(e[l])return e[l].exports;var g=e[l]={i:l,l:!1,exports:{}};return d[l].call(g.exports,g,g.exports,t),g.l=!0,g.exports}return t.m=d,t.c=e,t.d=function(l,g,b){t.o(l,g)||Object.defineProperty(l,g,{enumerable:!0,get:b})},t.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},t.t=function(l,g){if(1&g&&(l=t(l)),8&g||4&g&&"object"==typeof l&&l&&l.__esModule)return l;var b=Object.create(null);if(t.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:l}),2&g&&"string"!=typeof l)for(var M in l)t.d(b,M,function(B){return l[B]}.bind(null,M));return b},t.n=function(l){var g=l&&l.__esModule?function(){return l.default}:function(){return l};return t.d(g,"a",g),g},t.o=function(l,g){return Object.prototype.hasOwnProperty.call(l,g)},t.p="",t(t.s=0)}([function(d,e,t){function l(lt,nt,it){var dt=lt.data,xt=4*(it*lt.width+nt);if(void 0===dt[xt+3])throw new Error("Invalid pixel coordinates: x="+nt+"; y="+it);return{r:dt[xt],g:dt[xt+1],b:dt[xt+2],a:dt[xt+3]}}function g(lt,nt,it,_t){var xt=lt.data,It=4*(_t*lt.width+it);if(void 0===xt[It+3])throw new Error("Invalid pixel coordinates. Cannot set color at: x="+it+"; y="+_t);xt[It+0]=255&nt.r,xt[It+1]=255&nt.g,xt[It+2]=255&nt.b,xt[It+3]=255&nt.a}function b(lt,nt,it){return void 0===it&&(it=0),!(Math.abs(lt.r-nt.r)>it||Math.abs(lt.g-nt.g)>it||Math.abs(lt.b-nt.b)>it||Math.abs(lt.a-nt.a)>it)}function M(lt,nt){void 0===nt&&(nt=255);var it=lt;if(0===lt.indexOf("#")&&(it=lt.slice(1)),3===it.length&&(it=it[0]+it[0]+it[1]+it[1]+it[2]+it[2]),6!==it.length)throw new Error("Invalid HEX color "+it+".");return{r:parseInt(it.slice(0,2),16),g:parseInt(it.slice(2,4),16),b:parseInt(it.slice(4,6),16),a:nt}}function B(lt){if(-1!==lt.indexOf("rgba")){var nt=/rgba\(.*?([0-9]{1,3}).*?([0-9]{1,3}).*?([0-9]{1,3}).*?([0-9\.]{1,})/g.exec(lt),_t=nt[1],dt=nt[2],xt=nt[3],It=nt[4];return{r:parseInt(_t),g:parseInt(dt),b:parseInt(xt),a:Math.ceil(255*parseFloat(It))}}if(-1!==lt.indexOf("rgb")){var jt=/rgb\(.*?([0-9]{1,3}).*?([0-9]{1,3}).*?([0-9]{1,3})/g.exec(lt);return _t=jt[1],dt=jt[2],xt=jt[3],{r:parseInt(_t),g:parseInt(dt),b:parseInt(xt),a:255}}if(-1!==lt.indexOf("#"))return M(lt);throw new Error("Unsupported color format. Please use CSS rgba, rgb, or HEX!")}t.r(e),t.d(e,"isSameColor",function(){return b}),t.d(e,"setColorAtPixel",function(){return g}),t.d(e,"getColorAtPixel",function(){return l}),t.d(e,"colorToRGBA",function(){return B}),t.d(e,"hex2RGBA",function(){return M});var U=function(){function lt(nt){this.collectModifiedPixels=!1,this.modifiedPixelsCount=0,this.modifiedPixels=new Set,this._tolerance=0,this._queue=[],this.imageData=nt,this.isSameColor=b,this.setColorAtPixel=g,this.getColorAtPixel=l,this.colorToRGBA=B}return lt.prototype.fill=function(nt,it,_t,dt){this._newColor=this.colorToRGBA(nt),this._replacedColor=this.getColorAtPixel(this.imageData,it,_t),this._tolerance=dt,!this.isSameColor(this._replacedColor,this._newColor,this._tolerance)&&(this.addToQueue([it,it,_t,-1]),this.fillQueue())},lt.prototype.addToQueue=function(nt){this._queue.push(nt)},lt.prototype.popFromQueue=function(){return this._queue.length?this._queue.pop():null},lt.prototype.isValidTarget=function(nt){if(null!==nt){var it=this.getColorAtPixel(this.imageData,nt.x,nt.y);return this.isSameColor(this._replacedColor,it,this._tolerance)}},lt.prototype.fillLineAt=function(nt,it){if(!this.isValidTarget({x:nt,y:it}))return[-1,-1];this.setPixelColor(this._newColor,{x:nt,y:it});for(var _t=nt,dt=nt,xt=this.getPixelNeighbour("left",_t,it);xt&&this.isValidTarget(xt);)this.setPixelColor(this._newColor,xt),xt=this.getPixelNeighbour("left",_t=xt.x,it);for(xt=this.getPixelNeighbour("right",dt,it);xt&&this.isValidTarget(xt);)this.setPixelColor(this._newColor,xt),xt=this.getPixelNeighbour("right",dt=xt.x,it);return[_t,dt]},lt.prototype.fillQueue=function(){for(var nt=this.popFromQueue();nt;){for(var it=nt[0],_t=nt[1],dt=nt[2],xt=nt[3],It=it;-1!==It&&It<=_t;){var jt=this.fillLineAt(It,dt),Kt=jt[0],Yt=jt[1];-1!==Kt&&(Kt>=it&&Yt<=_t&&-1!==xt?(xt<dt&&dt+1<this.imageData.height&&this.addToQueue([Kt,Yt,dt+1,dt]),xt>dt&&dt>0&&this.addToQueue([Kt,Yt,dt-1,dt])):(dt>0&&this.addToQueue([Kt,Yt,dt-1,dt]),dt+1<this.imageData.height&&this.addToQueue([Kt,Yt,dt+1,dt]))),-1===Yt&&It<=_t?It+=1:It=Yt+1}nt=this.popFromQueue()}},lt.prototype.setPixelColor=function(nt,it){this.setColorAtPixel(this.imageData,nt,it.x,it.y),this.modifiedPixelsCount++,this.collectModifiedPixels&&this.modifiedPixels.add(it.x+"|"+it.y)},lt.prototype.getPixelNeighbour=function(nt,it,_t){var dt;switch(it|=0,_t|=0,nt){case"right":dt={x:it+1|0,y:_t};break;case"left":dt={x:it-1|0,y:_t}}return dt.x>=0&&dt.x<this.imageData.width?dt:null},lt}();e.default=U}]);void 0===qt&&console.error("esm-webpack-plugin: nothing exported!");const da=qt.default,di=typeof Tt.fabric>"u"?vt(8621).fabric:Tt.fabric,jn=di.util.createClass(di.BaseBrush,{initialize:function(d){this.canvas=d,console.log("kkk")},onMouseDown:function(d,e){this.floodFill(d)},floodFill:function(d){const e=this.canvas.getContext("2d"),t=e.getImageData(0,0,this.canvas.width,this.canvas.height),l=new da(t);l.fill("rgb(255, 0, 0)",Math.round(d.x),Math.round(d.y),0),e.putImageData(l.imageData,0,0)},onMouseMove:function(d,e){},onMouseUp:function(d){}});di.PaintBucket=jn;const fa=jn,fi=typeof Tt.fabric>"u"?vt(8621).fabric:Tt.fabric,Nn=fi.util.createClass(fi.BaseBrush,{initialize:function(d){this.canvas=d,this.panning=!1,this.zooming=!1,this.lastX=0,this.lastY=0,this.canvas.on("mouse:wheel",e=>{this.onMouseWheel(e)})},onMouseDown:function(d,e){e.e.touches&&(this.lastX=d.x,this.lastY=d.y,this.isTouch=!0),this.panning=!0,this.canvas.freeDrawingCursor="grabbing"},onMouseMove:function(d,e){!this.panning||(e.e.touches&&(e.e.movementX=d.x-this.lastX,e.e.movementY=d.y-this.lastY),d=new Tt.fabric.Point(e.e.movementX,e.e.movementY),this.canvas.relativePan(d),this.canvas.freeDrawingCursor="grabbing")},onMouseUp:function(d){this.panning=!1,this.canvas.freeDrawingCursor="grab"},onMouseWheel:function(d){let e=d.e.deltaY,t=this.canvas.getZoom();t*=.999**e,t>4&&(t=4),t<.01&&(t=.01),this.canvas.setZoom(t),d.e.preventDefault(),d.e.stopPropagation()}});fi.PanZoom=Nn;const pa=Nn,pi=typeof Tt.fabric>"u"?vt(8621).fabric:Tt.fabric,Vn=pi.util.createClass(pi.BaseBrush,{initialize:function(d){this.canvas=d,console.log("kkk")},onMouseDown:function(d,e){},onMouseMove:function(d,e){},onMouseUp:function(d){}});pi.Pointer=Vn;const ma=Vn,mi=typeof Tt.fabric>"u"?vt(8621).fabric:Tt.fabric,Hn=mi.util.createClass(mi.BaseBrush,{shape:null,initialize:function(d){this.canvas=d,this.object=null,this.oldEnd=null,this.isDown=!1},setShape:function(d){this.shape=d},onMouseDown:function(d,e){switch(console.log(this.shape,this.color,this.width,this.kk),this.isDown=!0,this.shape){case"circle":this.object=new Tt.fabric.Circle({radius:0,left:d.x,top:d.y,stroke:this.color,strokeWidth:this.width,fill:"transparent"});break;case"square":this.object=new Tt.fabric.Rect({left:d.x,top:d.y,width:0,height:0,stroke:this.color,strokeWidth:this.width,fill:"transparent"});break;case"ellipse":this.object=new Tt.fabric.Ellipse({left:d.x,top:d.y,stroke:this.color,originX:"left",originY:"top",strokeWidth:this.width,rx:0,ry:0,fill:"transparent"});break;case"line":this.object=new Tt.fabric.Line([d.x,d.y,d.x,d.y],{stroke:this.color,fill:"transparent",strokeWidth:this.width})}this.oldEnd=d,this.canvas.add(this.object)},onMouseMove:function(d,e){if(this.isDown){switch(this.shape){case"circle":this.object.set({radius:Math.abs(this.calculateDistance(d))/2});break;case"square":this.object.set({width:Math.abs(this.oldEnd.x-d.x),height:Math.abs(this.oldEnd.y-d.y)});break;case"ellipse":this.object.set({rx:Math.abs(this.oldEnd.x-d.x)/2,ry:Math.abs(this.oldEnd.y-d.y)/2});break;case"line":this.object.set({x2:d.x,y2:d.y})}this.object.setCoords(),this.canvas.renderAll()}},calculateDistance:function(d){return Math.sqrt(Math.pow(d.x-this.oldEnd.x,2)+Math.pow(d.y-this.oldEnd.y,2))},onMouseUp:function(d){this.isDown=!1}});mi.shapeCreator=Hn;const ga=Hn,gi=typeof Tt.fabric>"u"?vt(8621).fabric:Tt.fabric,Xn=gi.util.createClass(gi.BaseBrush,{initialize:function(d){this.canvas=d,this.isEditing=!1},setFontFamily(d){this.fontFamily=d},onMouseDown:function(d,e){if(this.isEditing){var t=this.canvas.findTarget(d,!0);if(t&&"i-text"==t.type)return this.canvas.setActiveObject(t),void t.enterEditing()}this.fabicText=new Tt.fabric.IText("",{left:d.x,top:d.y,fontFamily:this.fontFamily,fill:this.color,fontSize:10*this.width||25}),this.canvas.add(this.fabicText),this.canvas.setActiveObject(this.fabicText),this.fabicText.enterEditing(),this.isEditing=!0},onMouseMove:function(d,e){},onMouseUp:function(d){}});gi.TextCreator=Xn;const _a=Xn;class se{constructor(){this.selectedColor="rgb(0,0,0)",this.selectedWidth=5,this.currentTool="pencil"}initCanvas(e){this._canvas=e,this.tool=null}updateTool(e,t){switch(this._canvas.isDrawingMode=!0,this._canvas.off("mouse:wheeel"),e){case"pencil":this._canvas.freeDrawingCursor='url(" assets/cursors/pencil.cur "), auto',this.tool=new Tt.fabric.PencilBrush(this._canvas);break;case"spraybrush":this.tool=new Tt.fabric.SprayBrush(this._canvas);break;case"circlebrush":this.tool=new Tt.fabric.CircleBrush(this._canvas);break;case"selector":return void(this._canvas.isDrawingMode=!1);case"pointer":this._canvas.freeDrawingCursor='url(" https://ossrs.net/wiki/images/figma-cursor.png "), auto',this.tool=new ma(this._canvas);break;case"laser":this._canvas.freeDrawingCursor='url(" assets/cursors/circle.cur "), auto',this.tool=new ua(this._canvas);break;case"eraser":this._canvas.freeDrawingCursor='url(" https://ossrs.net/wiki/images/figma-cursor.png "), auto',this.tool=new ha(this._canvas);break;case"text":this._canvas.freeDrawingCursor='url(" https://ossrs.net/wiki/images/figma-cursor.png "), auto',this.tool=new _a(this._canvas),this.tool.setFontFamily(t||"Tahoma");break;case"paintbucket":this._canvas.freeDrawingCursor='url(" https://ossrs.net/wiki/images/figma-cursor.png "), auto',this.tool=new fa(this._canvas);break;case"panzoom":this._canvas.freeDrawingCursor="grab",this.tool=new pa(this._canvas);break;default:this.tool=new ga(this._canvas),this.tool.setShape(e)}this.tool.color=this.selectedColor,this.tool.width=this.selectedWidth,this._canvas.freeDrawingBrush=this.tool}changedColor(e){this.selectedColor=e,this._canvas.freeDrawingBrush.color=this.selectedColor}changedStroke(e){this.selectedWidth=e,this._canvas.freeDrawingBrush.width=this.selectedWidth}updateCanvasObject(){let e=this._canvas.getActiveObject(),t=this._canvas.getActiveObjects();console.log(e),t.length?(t.forEach(l=>{l.set({stroke:this.selectedColor,strokeWidth:this.selectedWidth})}),this._canvas.renderAll()):e&&(e.set({stroke:this.selectedColor,strokeWidth:this.selectedWidth}),this._canvas.renderAll())}}se.\u0275fac=function(e){return new(e||se)},se.\u0275prov=C.Yz7({token:se,factory:se.\u0275fac,providedIn:"root"});class oe{constructor(){this.undoStack=[],this.redoStack=[],this.historyIndex=0,this.disabledUndo=!0,this.disabledRedo=!0,this.isUndoActive=!1}initCanvas(e){this._canvas=e,this.registerEvents()}registerEvents(){this._canvas.on("object:added",e=>{this.objectAdded(e)}),this._canvas.on("object:modified",e=>{this.objectModified(e)}),this._canvas.on("object:removed",e=>{this.objectRemoved(e)})}objectAdded(e){("path"==e.target.type||"group"==e.target.type)&&(e.target.selectable=!1,e.target.hoverCursor="default"),!this.isUndoActive&&(console.log(this.undoStack),this.undoStack.push({action:"ADD",object:e.target}),this.redoStack=[],this.historyIndex++)}objectRemoved(e){this.isUndoActive||(this.undoStack.push({action:"REM",object:e.target}),this.redoStack=[],this.historyIndex++)}objectModified(e){this.isUndoActive||(this.undoStack.push({action:"MOD",object:e.target}),this.redoStack=[],this.historyIndex++)}handleSelection(e){const{left:t,top:l,width:g,height:b}=e.getBoundingRect();let M=document.getElementById("buttonContainer");M&&(M.style.left=t+g/4-M.clientWidth/4+"px",M.style.top=`${l+b+5}px`,M.style.display="block")}undo(){this.isUndoActive=!0;var e=this.undoStack.pop();e&&(this.redoStack.push(e),this.handleUndo(e)),0==this.undoStack.length&&(this.disabledUndo=!1),this.isUndoActive=!1}redo(){this.isUndoActive=!0;var e=this.redoStack.pop();e&&(this.undoStack.push(e),this.handleRedo(e)),0==this.redoStack.length&&(this.disabledRedo=!1),this.isUndoActive=!1}handleUndo(e){"ADD"==e.action?this._canvas.remove(e.object):"REM"==e.action?this._canvas.add(e.object):e.object.set({left:this.undoStack.at(-1)?.object.left,top:this.undoStack.at(-1)?.object.top})}handleRedo(e){"ADD"==e.action?this._canvas.add(e.object):"REM"==e.action?this._canvas.remove(e.object):e.object.set({left:this.redoStack.at(-1)?.object.left,top:this.redoStack.at(-1)?.object.top})}}oe.\u0275fac=function(e){return new(e||oe)},oe.\u0275prov=C.Yz7({token:oe,factory:oe.\u0275fac,providedIn:"root"});class ae{constructor(){}updateTextColor(e){this.activeObject.set({fill:e}),this.handleSelection(this.activeObject)}changeFontSize(e){this.activeObject.set({fontSize:this.activeObject.fontSize+e}),this.handleSelection(this.activeObject)}changeFont(e){this.activeObject.set({fontFamily:e}),this._canvas.renderAll()}initCanvas(e){this._canvas=e,this.activeObject=null,this.registerEvents()}registerEvents(){this._canvas.on("selection:created",e=>{this.activeObject=e.selected[0],"i-text"==this.activeObject.type&&this.handleSelection(e.selected[0])}),this._canvas.on("selection:updated",e=>{let t=document.getElementById("buttonContainer");t&&(t.style.display="none"),this.activeObject=e.selected[0],"i-text"==this.activeObject.type&&this.handleSelection(e.selected[0])}),this._canvas.on("object:modified",e=>{this.activeObject=e.target,"i-text"==this.activeObject.type&&this.handleSelection(e.target)}),this._canvas.on("object:moving",function(e){let t=document.getElementById("buttonContainer");t&&(t.style.display="none")}),this._canvas.on("object:scaling",function(e){let t=document.getElementById("buttonContainer");t&&(t.style.display="none")}),this._canvas.on("object:rotating",function(e){let t=document.getElementById("buttonContainer");t&&(t.style.display="none")}),this._canvas.on("selection:cleared",e=>{let t=document.getElementById("buttonContainer");t&&(t.style.display="none")})}handleSelection(e){this._canvas.renderAll();const{left:t,top:l,width:g,height:b}=e.getBoundingRect();let M=document.getElementById("buttonContainer");console.log(t,l,g,b),M&&(M.style.left=t+g/2-110+"px",M.style.top=`${l+b+11}px`,M.style.display="block")}}ae.\u0275fac=function(e){return new(e||ae)},ae.\u0275prov=C.Yz7({token:ae,factory:ae.\u0275fac,providedIn:"root"});class we{constructor(e){this.elementRef=e,this.icon="fa-solid  fa-rotate-left",this.activeTool=null,this.isOpen=!1}clickOut(e){this.elementRef.nativeElement.contains(e.target)||(this.isOpen=!1)}}we.\u0275fac=function(e){return new(e||we)(C.Y36(C.SBq))},we.\u0275cmp=C.Xpm({type:we,selectors:[["app-menu"]],hostBindings:function(e,t){1&e&&C.NdJ("click",function(g){return t.clickOut(g)},!1,C.evT)},inputs:{icon:"icon",activeTool:"activeTool"},ngContentSelectors:["*"],decls:5,vars:5,consts:[[1,"btn",3,"click"],[1,"icon",3,"ngClass"],[1,"menu"],["menu",""]],template:function(e,t){1&e&&(C.F$t(),C.TgZ(0,"button",0),C.NdJ("click",function(){return t.isOpen=!t.isOpen}),C._UZ(1,"i",1),C.qZA(),C.TgZ(2,"div",2,3),C.Hsn(4),C.qZA()),2&e&&(C.ekj("active",t.activeTool),C.xp6(1),C.Q6J("ngClass",t.icon),C.xp6(1),C.ekj("open",t.isOpen))},dependencies:[_.mk],styles:[".btn[_ngcontent-%COMP%]{background-color:#fafafa;margin:5px;width:40px;height:40px;border-radius:10px;color:#183153;display:flex;justify-content:center;align-items:center;border:0px}.active[_ngcontent-%COMP%]{background-color:#183153;color:#fafafa}.menu[_ngcontent-%COMP%]{display:none}.menu.open[_ngcontent-%COMP%]{display:block;position:absolute;top:5px;left:75px;padding:12px;background-color:#fff;box-shadow:0 0 5px #000000bf;border-radius:5px}"]});const ya=function(d){return{backgroundColor:d}};class Se{constructor(e){this.elementRef=e,this.activeColor="white",this.isOpen=!1}clickOut(e){this.elementRef.nativeElement.contains(e.target)||(this.isOpen=!1)}}function Ca(d,e){if(1&d){const t=C.EpF();C.TgZ(0,"div",31),C.NdJ("click",function(){const b=C.CHM(t).$implicit,M=C.oxw(2);return C.KtG(M.onToolChange(b.toolCode))}),C._UZ(1,"i",32),C.TgZ(2,"span"),C._uU(3),C.qZA()()}if(2&d){const t=e.$implicit,l=C.oxw(2);C.ekj("activeTool",l.currentTool==t.toolCode),C.xp6(1),C.Q6J("ngClass",t.icon),C.xp6(2),C.Oqu(t.name)}}function xa(d,e){if(1&d&&(C.TgZ(0,"app-menu",26)(1,"div",27)(2,"div",28),C._uU(3),C.qZA(),C.TgZ(4,"div",29),C.YNc(5,Ca,4,4,"div",30),C.qZA()()()),2&d){const t=e.$implicit,l=C.oxw();C.Q6J("icon",t.icon)("activeTool",l.activeTool(l.currentTool,t.tools)),C.xp6(3),C.hij("Select ",t.type,""),C.xp6(2),C.Q6J("ngForOf",t.tools)}}Se.\u0275fac=function(e){return new(e||Se)(C.Y36(C.SBq))},Se.\u0275cmp=C.Xpm({type:Se,selectors:[["color-menu"]],hostBindings:function(e,t){1&e&&C.NdJ("click",function(g){return t.clickOut(g)},!1,C.evT)},inputs:{activeColor:"activeColor"},ngContentSelectors:["*"],decls:4,vars:5,consts:[[1,"btn",3,"ngStyle","click"],[1,"menu"],["menu",""]],template:function(e,t){1&e&&(C.F$t(),C.TgZ(0,"button",0),C.NdJ("click",function(){return t.isOpen=!t.isOpen}),C.qZA(),C.TgZ(1,"div",1,2),C.Hsn(3),C.qZA()),2&e&&(C.Q6J("ngStyle",C.VKq(3,ya,t.activeColor)),C.xp6(1),C.ekj("open",t.isOpen))},dependencies:[_.PC],styles:[".btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:15px;border:8px white solid}.menu[_ngcontent-%COMP%]{display:none}.menu.open[_ngcontent-%COMP%]{display:block;position:absolute;top:55px;left:75px;padding:12px;background-color:#fff;box-shadow:0 0 5px #000000bf;border-radius:5px}"]});const Un=function(d){return{backgroundColor:d}};function wa(d,e){if(1&d){const t=C.EpF();C.TgZ(0,"button",33),C.NdJ("click",function(){const b=C.CHM(t).$implicit,M=C.oxw();return C.KtG(M.updateToolColor(b))}),C.qZA()}2&d&&C.Q6J("ngStyle",C.VKq(1,Un,e.$implicit))}function Sa(d,e){if(1&d){const t=C.EpF();C.TgZ(0,"button",33),C.NdJ("click",function(){const b=C.CHM(t).$implicit,M=C.oxw();return C.KtG(M.updateTextColor(b))}),C.qZA()}2&d&&C.Q6J("ngStyle",C.VKq(1,Un,e.$implicit))}function Ta(d,e){if(1&d&&(C.TgZ(0,"option"),C._uU(1),C.qZA()),2&d){const t=e.$implicit;C.xp6(1),C.Oqu(t)}}class Te{constructor(e,t,l){this.toolService=e,this.undoService=t,this.evntListner=l,this.colors=["#0E0E0E","#FE0000","#1878F3","#EFC733","#CB503E","#8C1092","#06CF9C","#33648D","#6A000C"],this.fontFamilies=["Tahoma","sans-serif","Times New Roman","Courier New","Arial","Helvetica","Lucida Console"],this.selectedColor="#0E0E0E",this.selectedStroke=5,this.currentTool="laser",this.activeObject=null,this.fontFamily="Tahoma",this.toolsList=ca}ngOnInit(){this._canvas=new Tt.fabric.Canvas("fabricCanavs",{width:window.innerWidth,height:window.innerHeight,isDrawingMode:!0}),this._canvas.add(new Tt.fabric.IText("Hello",{left:100,top:100,stroke:this.selectedColor})),this.toolService.initCanvas(this._canvas),this.undoService.initCanvas(this._canvas),this.toolService.updateTool("laser"),this.evntListner.initCanvas(this._canvas),Fn("#F57C00",this._canvas)}changeFontFamily(e){this.evntListner.changeFont(e)}fontSize(e){this.evntListner.changeFontSize(e)}updateTextColor(e){this.evntListner.updateTextColor(e)}onToolChange(e){this.currentTool=e,this.toolService.updateTool(e)}updateToolColor(e){this.selectedColor=e,this.toolService.changedColor(e)}setTheme(e){Fn(e,this._canvas),this._canvas.renderAll()}updateToolStroke(){this.toolService.changedStroke(this.selectedStroke)}onUndo(){this.undoService.undo()}onRedo(){this.undoService.redo()}activeTool(e,t){return t.find(l=>l.toolCode===e)}handleFileInput(e){const l=e.target.files.item(0),g=new FileReader;!l||(g.readAsDataURL(l),g.onload=()=>{let b=g.result;console.log(b),Tt.fabric.Image.fromURL(b,M=>{M.set({left:window.innerWidth/4,top:window.innerHeight/4,angle:0,padding:10,cornerSize:10,hasRotatingPoint:!0,scaleX:.25,scaleY:.25}),this._canvas.add(M),this._canvas.setActiveObject(M),this.toolService.updateTool("selector")})})}}Te.\u0275fac=function(e){return new(e||Te)(C.Y36(se),C.Y36(oe),C.Y36(ae))},Te.\u0275cmp=C.Xpm({type:Te,selectors:[["app-whiteboard"]],decls:32,vars:11,consts:[[1,"container"],["id","fabricCanavs"],[1,"undoredo"],["matTooltip","Undo",1,"fa-solid","fa-rotate-left",3,"click"],["matTooltip","Redo",1,"fa-solid","fa-rotate-right",3,"click"],[1,"toolBar"],["matTooltip","PanTool",1,"btn",3,"click"],[1,"fa-solid","fa-hand"],[3,"icon","activeTool",4,"ngFor","ngForOf"],["matTooltip","Eraser",1,"btn",3,"click"],[1,"fa-solid","fa-eraser"],["matTooltip","Text",1,"btn",3,"click"],[1,"fa-solid","fa-font"],["type","file","accept","image/*",1,"hidden",3,"change"],["imageInput",""],["matTooltip","Add Image",1,"btn",3,"click"],[1,"fa-solid","fa-image"],[3,"activeColor"],[1,"colors"],["class","colorBtn",3,"ngStyle","click",4,"ngFor","ngForOf"],["id","buttonContainer"],[1,"textProp"],[3,"value","change"],["fontFamily",""],[4,"ngFor","ngForOf"],[1,"fbtn",3,"click"],[3,"icon","activeTool"],[1,"toolType"],[1,"title"],[1,"tools"],["class","list",3,"activeTool","click",4,"ngFor","ngForOf"],[1,"list",3,"click"],[3,"ngClass"],[1,"colorBtn",3,"ngStyle","click"]],template:function(e,t){if(1&e){const l=C.EpF();C.TgZ(0,"div",0),C._UZ(1,"canvas",1),C.TgZ(2,"div",2)(3,"i",3),C.NdJ("click",function(){return t.onUndo()}),C.qZA(),C.TgZ(4,"i",4),C.NdJ("click",function(){return t.onRedo()}),C.qZA()(),C.TgZ(5,"div",5)(6,"button",6),C.NdJ("click",function(){return t.onToolChange("panzoom")}),C._UZ(7,"i",7),C.qZA(),C.YNc(8,xa,6,4,"app-menu",8),C.TgZ(9,"button",9),C.NdJ("click",function(){return t.onToolChange("eraser")}),C._UZ(10,"i",10),C.qZA(),C.TgZ(11,"button",11),C.NdJ("click",function(){return t.onToolChange("text")}),C._UZ(12,"i",12),C.qZA(),C.TgZ(13,"input",13,14),C.NdJ("change",function(b){return t.handleFileInput(b)}),C.qZA(),C.TgZ(15,"button",15),C.NdJ("click",function(){C.CHM(l);const b=C.MAs(14);return C.KtG(b.click())}),C._UZ(16,"i",16),C.qZA(),C.TgZ(17,"color-menu",17)(18,"div",18),C.YNc(19,wa,1,3,"button",19),C.qZA()()(),C.TgZ(20,"div",20)(21,"div",21)(22,"color-menu",17)(23,"div",18),C.YNc(24,Sa,1,3,"button",19),C.qZA()(),C.TgZ(25,"select",22,23),C.NdJ("change",function(){C.CHM(l);const b=C.MAs(26);return C.KtG(t.changeFontFamily(b.value))}),C.YNc(27,Ta,2,1,"option",24),C.qZA(),C.TgZ(28,"button",25),C.NdJ("click",function(){return t.fontSize(1)}),C._uU(29," A\u207a"),C.qZA(),C.TgZ(30,"button",25),C.NdJ("click",function(){return t.fontSize(-1)}),C._uU(31," A\u207b"),C.qZA()()()()}2&e&&(C.xp6(8),C.Q6J("ngForOf",t.toolsList),C.xp6(1),C.ekj("active","eraser"==t.currentTool),C.xp6(2),C.ekj("active","text"==t.currentTool),C.xp6(6),C.Q6J("activeColor",t.selectedColor),C.xp6(2),C.Q6J("ngForOf",t.colors),C.xp6(3),C.Q6J("activeColor",null==t.evntListner.activeObject?null:t.evntListner.activeObject.fill),C.xp6(2),C.Q6J("ngForOf",t.colors),C.xp6(1),C.Q6J("value",null==t.evntListner.activeObject?null:t.evntListner.activeObject.fontFamily),C.xp6(2),C.Q6J("ngForOf",t.fontFamilies))},dependencies:[_.mk,_.sg,_.PC,oa,_e.YN,_e.Kr,we,Se],styles:['#fabricCanavs[_ngcontent-%COMP%]{background-color:#fff;width:100%;height:100vh;overflow-y:hidden}.toolBar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;flex-direction:row;width:50px;background-color:#fff;display:flex;flex-direction:column;margin:10px;align-items:center;border-radius:10px;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}#buttonContainer[_ngcontent-%COMP%]{display:none;position:absolute;right:0;top:0;background-color:#fff;padding:12px;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f;border-radius:2px;width:270px}.textProp[_ngcontent-%COMP%]{display:flex;align-items:center}.toolType[_ngcontent-%COMP%]{width:110px;color:#183153}.toolType[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:14px}.toolType[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.toolType[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;background-color:#fafafa;color:#183153;padding:5px;border-radius:10px;margin:2px;font-size:12px;cursor:pointer}.toolType[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:5px}.toolType[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]:hover{background-color:#093451;color:#fafafa}.toolType[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .activeTool[_ngcontent-%COMP%]{background-color:#09304a;color:#fafafa}.colorBtn[_ngcontent-%COMP%]{width:30px;height:30px}.colors[_ngcontent-%COMP%]{width:120px;display:flex;flex-wrap:wrap}.colors[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin:4px;border:0px}.btn[_ngcontent-%COMP%]{background-color:#fafafa;margin:5px;width:40px;height:40px;border-radius:10px;color:#183153;display:flex;justify-content:center;align-items:center;border:0px}.fbtn[_ngcontent-%COMP%]{margin:4px;padding:4px;background-color:#183153;color:#f7f9f9;border:0px;border-radius:5px}.active[_ngcontent-%COMP%]{background-color:#183153;color:#fff}select[_ngcontent-%COMP%]{background-color:#fff;padding:8px 16px;border-radius:2px;border:none;box-shadow:0 2px 4px #0000001a;-webkit-appearance:none;appearance:none;font-size:16px;color:#333}select[_ngcontent-%COMP%]:after{content:"";width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid #333;position:absolute;right:10px;top:50%;margin-top:-2.5px;pointer-events:none}.hidden[_ngcontent-%COMP%]{display:none}']});const Ma=[{path:"",component:Te}];class le{}le.\u0275fac=function(e){return new(e||le)},le.\u0275mod=C.oAB({type:le}),le.\u0275inj=C.cJS({imports:[Rn.Bz.forChild(Ma),Rn.Bz]});class ce{}ce.\u0275fac=function(e){return new(e||ce)},ce.\u0275mod=C.oAB({type:ce}),ce.\u0275inj=C.cJS({imports:[_.ez,re,_e.u5,le]})},8621:(Yn,yt,vt)=>{var p,a,u,h,n,s,_=_||{version:"5.3.0"};if(yt.fabric=_,typeof document<"u"&&typeof window<"u")_.document=document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),_.window=window;else{var Zt=new(vt(4960).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;_.document=Zt.document,_.jsdomImplForWrapper=vt(6759).implForWrapper,_.nodeCanvas=vt(6272).Canvas,_.window=Zt,DOMParser=_.window.DOMParser}function Me(p,a){var u=p.canvas,h=a.targetCanvas,n=h.getContext("2d");n.translate(0,h.height),n.scale(1,-1),n.drawImage(u,0,u.height-h.height,h.width,h.height,0,0,h.width,h.height)}function Nt(p,a){var h=a.targetCanvas.getContext("2d"),n=a.destinationWidth,s=a.destinationHeight,i=n*s*4,o=new Uint8Array(this.imageBuffer,0,i),c=new Uint8ClampedArray(this.imageBuffer,0,i);p.readPixels(0,0,n,s,p.RGBA,p.UNSIGNED_BYTE,o);var r=new ImageData(c,n,s);h.putImageData(r,0,0)}_.isTouchSupported="ontouchstart"in _.window||"ontouchstart"in _.document||_.window&&_.window.navigator&&_.window.navigator.maxTouchPoints>0,_.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",_.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],_.DPI=96,_.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",_.commaWsp="(?:\\s+,?\\s*|,\\s*)",_.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,_.reNonWord=/[ \n\.,;!\?\-]/,_.fontPaths={},_.iMatrix=[1,0,0,1,0,0],_.svgNS="http://www.w3.org/2000/svg",_.perfLimitSizeTotal=2097152,_.maxCacheSideLimit=4096,_.minCacheSideLimit=256,_.charWidthsCache={},_.textureSize=2048,_.disableStyleCopyPaste=!1,_.enableGLFiltering=!0,_.devicePixelRatio=_.window.devicePixelRatio||_.window.webkitDevicePixelRatio||_.window.mozDevicePixelRatio||1,_.browserShadowBlurConstant=1,_.arcToSegmentsCache={},_.boundsOfCurveCache={},_.cachesBoundsOfCurve=!0,_.forceGLPutImageData=!1,_.initFilterBackend=function(){return _.enableGLFiltering&&_.isWebglSupported&&_.isWebglSupported(_.textureSize)?(console.log("max texture size: "+_.maxTextureSize),new _.WebglFilterBackend({tileSize:_.textureSize})):_.Canvas2dFilterBackend?new _.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=_),function(){function p(i,o){if(this.__eventListeners[i]){var c=this.__eventListeners[i];o?c[c.indexOf(o)]=!1:_.util.array.fill(c,!1)}}function u(i,o){var c=function(){o.apply(this,arguments),this.off(i,c)}.bind(this);this.on(i,c)}_.Observable={fire:function s(i,o){if(!this.__eventListeners)return this;var c=this.__eventListeners[i];if(!c)return this;for(var r=0,f=c.length;r<f;r++)c[r]&&c[r].call(this,o||{});return this.__eventListeners[i]=c.filter(function(m){return!1!==m}),this},on:function a(i,o){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var c in i)this.on(c,i[c]);else this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(o);return this},once:function h(i,o){if(1===arguments.length)for(var c in i)u.call(this,c,i[c]);else u.call(this,i,o);return this},off:function n(i,o){if(!this.__eventListeners)return this;if(0===arguments.length)for(i in this.__eventListeners)p.call(this,i);else if(1===arguments.length&&"object"==typeof arguments[0])for(var c in i)p.call(this,c,i[c]);else p.call(this,i,o);return this}}}(),_.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var p=0,a=arguments.length;p<a;p++)this._onObjectAdded(arguments[p]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(p,a,u){var h=this._objects;return u?h[a]=p:h.splice(a,0,p),this._onObjectAdded&&this._onObjectAdded(p),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var a,p=this._objects,u=!1,h=0,n=arguments.length;h<n;h++)-1!==(a=p.indexOf(arguments[h]))&&(u=!0,p.splice(a,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[h]));return this.renderOnAddRemove&&u&&this.requestRenderAll(),this},forEachObject:function(p,a){for(var u=this.getObjects(),h=0,n=u.length;h<n;h++)p.call(a,u[h],h,u);return this},getObjects:function(p){return typeof p>"u"?this._objects.concat():this._objects.filter(function(a){return a.type===p})},item:function(p){return this._objects[p]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(p,a){return this._objects.indexOf(p)>-1||!!a&&this._objects.some(function(u){return"function"==typeof u.contains&&u.contains(p,!0)})},complexity:function(){return this._objects.reduce(function(p,a){return p+(a.complexity?a.complexity():0)},0)}},_.CommonMethods={_setOptions:function(p){for(var a in p)this.set(a,p[a])},_initGradient:function(p,a){p&&p.colorStops&&!(p instanceof _.Gradient)&&this.set(a,new _.Gradient(p))},_initPattern:function(p,a,u){!p||!p.source||p instanceof _.Pattern?u&&u():this.set(a,new _.Pattern(p,u))},_setObject:function(p){for(var a in p)this._set(a,p[a])},set:function(p,a){return"object"==typeof p?this._setObject(p):this._set(p,a),this},_set:function(p,a){this[p]=a},toggle:function(p){var a=this.get(p);return"boolean"==typeof a&&this.set(p,!a),this},get:function(p){return this[p]}},p=yt,a=Math.sqrt,u=Math.atan2,h=Math.pow,n=Math.PI/180,s=Math.PI/2,_.util={cos:function(i){if(0===i)return 1;switch(i<0&&(i=-i),i/s){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},sin:function(i){if(0===i)return 0;var c=1;switch(i<0&&(c=-1),i/s){case 1:return c;case 2:return 0;case 3:return-c}return Math.sin(i)},removeFromArray:function(i,o){var c=i.indexOf(o);return-1!==c&&i.splice(c,1),i},getRandomInt:function(i,o){return Math.floor(Math.random()*(o-i+1))+i},degreesToRadians:function(i){return i*n},radiansToDegrees:function(i){return i/n},rotatePoint:function(i,o,c){var r=new _.Point(i.x-o.x,i.y-o.y),f=_.util.rotateVector(r,c);return new _.Point(f.x,f.y).addEquals(o)},rotateVector:function(i,o){var c=_.util.sin(o),r=_.util.cos(o);return{x:i.x*r-i.y*c,y:i.x*c+i.y*r}},createVector:function(i,o){return new _.Point(o.x-i.x,o.y-i.y)},calcAngleBetweenVectors:function(i,o){return Math.acos((i.x*o.x+i.y*o.y)/(Math.hypot(i.x,i.y)*Math.hypot(o.x,o.y)))},getHatVector:function(i){return new _.Point(i.x,i.y).multiply(1/Math.hypot(i.x,i.y))},getBisector:function(i,o,c){var r=_.util.createVector(i,o),f=_.util.createVector(i,c),m=_.util.calcAngleBetweenVectors(r,f),v=_.util.calcAngleBetweenVectors(_.util.rotateVector(r,m),f);return{vector:_.util.getHatVector(_.util.rotateVector(r,m*(0===v?1:-1)/2)),angle:m}},projectStrokeOnPoints:function(i,o,c){var r=[],f=o.strokeWidth/2,m=o.strokeUniform?new _.Point(1/o.scaleX,1/o.scaleY):new _.Point(1,1),v=function(y){var x=f/Math.hypot(y.x,y.y);return new _.Point(y.x*x*m.x,y.y*x*m.y)};return i.length<=1||i.forEach(function(y,x){var O,P,w=new _.Point(y.x,y.y);0===x?(P=i[x+1],O=c?v(_.util.createVector(P,w)).addEquals(w):i[i.length-1]):x===i.length-1?(O=i[x-1],P=c?v(_.util.createVector(O,w)).addEquals(w):i[0]):(O=i[x-1],P=i[x+1]);var at,ht,X=_.util.getBisector(w,O,P),$=X.vector;if("miter"===o.strokeLineJoin&&(at=-f/Math.sin(X.angle/2),ht=new _.Point($.x*at*m.x,$.y*at*m.y),Math.hypot(ht.x,ht.y)/f<=o.strokeMiterLimit))return r.push(w.add(ht)),void r.push(w.subtract(ht));at=-f*Math.SQRT2,ht=new _.Point($.x*at*m.x,$.y*at*m.y),r.push(w.add(ht)),r.push(w.subtract(ht))}),r},transformPoint:function(i,o,c){return c?new _.Point(o[0]*i.x+o[2]*i.y,o[1]*i.x+o[3]*i.y):new _.Point(o[0]*i.x+o[2]*i.y+o[4],o[1]*i.x+o[3]*i.y+o[5])},makeBoundingBoxFromPoints:function(i,o){if(o)for(var c=0;c<i.length;c++)i[c]=_.util.transformPoint(i[c],o);var r=[i[0].x,i[1].x,i[2].x,i[3].x],f=_.util.array.min(r),v=_.util.array.max(r)-f,y=[i[0].y,i[1].y,i[2].y,i[3].y],x=_.util.array.min(y);return{left:f,top:x,width:v,height:_.util.array.max(y)-x}},invertTransform:function(i){var o=1/(i[0]*i[3]-i[1]*i[2]),c=[o*i[3],-o*i[1],-o*i[2],o*i[0]],r=_.util.transformPoint({x:i[4],y:i[5]},c,!0);return c[4]=-r.x,c[5]=-r.y,c},toFixed:function(i,o){return parseFloat(Number(i).toFixed(o))},parseUnit:function(i,o){var c=/\D{0,2}$/.exec(i),r=parseFloat(i);switch(o||(o=_.Text.DEFAULT_SVG_FONT_SIZE),c[0]){case"mm":return r*_.DPI/25.4;case"cm":return r*_.DPI/2.54;case"in":return r*_.DPI;case"pt":return r*_.DPI/72;case"pc":return r*_.DPI/72*12;case"em":return r*o;default:return r}},falseFunction:function(){return!1},getKlass:function(i,o){return i=_.util.string.camelize(i.charAt(0).toUpperCase()+i.slice(1)),_.util.resolveNamespace(o)[i]},getSvgAttributes:function(i){var o=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":o=o.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":o=o.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":o=o.concat(["offset","stop-color","stop-opacity"])}return o},resolveNamespace:function(i){if(!i)return _;var r,o=i.split("."),c=o.length,f=p||_.window;for(r=0;r<c;++r)f=f[o[r]];return f},loadImage:function(i,o,c,r){if(i){var f=_.util.createImage(),m=function(){o&&o.call(c,f,!1),f=f.onload=f.onerror=null};f.onload=m,f.onerror=function(){_.log("Error loading "+f.src),o&&o.call(c,null,!0),f=f.onload=f.onerror=null},0!==i.indexOf("data")&&null!=r&&(f.crossOrigin=r),"data:image/svg"===i.substring(0,14)&&(f.onload=null,_.util.loadImageInDom(f,m)),f.src=i}else o&&o.call(c,i)},loadImageInDom:function(i,o){var c=_.document.createElement("div");c.style.width=c.style.height="1px",c.style.left=c.style.top="-100%",c.style.position="absolute",c.appendChild(i),_.document.querySelector("body").appendChild(c),i.onload=function(){o(),c.parentNode.removeChild(c),c=null}},enlivenObjects:function(i,o,c,r){var f=[],m=0,v=(i=i||[]).length;function y(){++m===v&&o&&o(f.filter(function(x){return x}))}v?i.forEach(function(x,w){x&&x.type?_.util.getKlass(x.type,c).fromObject(x,function(P,X){X||(f[w]=P),r&&r(x,P,X),y()}):y()}):o&&o(f)},enlivenObjectEnlivables:function(i,o,c){var r=_.Object.ENLIVEN_PROPS.filter(function(f){return!!i[f]});_.util.enlivenObjects(r.map(function(f){return i[f]}),function(f){var m={};r.forEach(function(v,y){m[v]=f[y],o&&(o[v]=f[y])}),c&&c(m)})},enlivenPatterns:function(i,o){function c(){++f===m&&o&&o(r)}var r=[],f=0,m=(i=i||[]).length;m?i.forEach(function(v,y){v&&v.source?new _.Pattern(v,function(x){r[y]=x,c()}):(r[y]=v,c())}):o&&o(r)},groupSVGElements:function(i,o,c){var r;return i&&1===i.length?(typeof c<"u"&&(i[0].sourcePath=c),i[0]):(o&&(o.width&&o.height?o.centerPoint={x:o.width/2,y:o.height/2}:(delete o.width,delete o.height)),r=new _.Group(i,o),typeof c<"u"&&(r.sourcePath=c),r)},populateWithProperties:function(i,o,c){if(c&&Array.isArray(c))for(var r=0,f=c.length;r<f;r++)c[r]in i&&(o[c[r]]=i[c[r]])},createCanvasElement:function(){return _.document.createElement("canvas")},copyCanvasElement:function(i){var o=_.util.createCanvasElement();return o.width=i.width,o.height=i.height,o.getContext("2d").drawImage(i,0,0),o},toDataURL:function(i,o,c){return i.toDataURL("image/"+o,c)},createImage:function(){return _.document.createElement("img")},multiplyTransformMatrices:function(i,o,c){return[i[0]*o[0]+i[2]*o[1],i[1]*o[0]+i[3]*o[1],i[0]*o[2]+i[2]*o[3],i[1]*o[2]+i[3]*o[3],c?0:i[0]*o[4]+i[2]*o[5]+i[4],c?0:i[1]*o[4]+i[3]*o[5]+i[5]]},qrDecompose:function(i){var o=u(i[1],i[0]),c=h(i[0],2)+h(i[1],2),r=a(c),f=(i[0]*i[3]-i[2]*i[1])/r,m=u(i[0]*i[2]+i[1]*i[3],c);return{angle:o/n,scaleX:r,scaleY:f,skewX:m/n,skewY:0,translateX:i[4],translateY:i[5]}},calcRotateMatrix:function(i){if(!i.angle)return _.iMatrix.concat();var o=_.util.degreesToRadians(i.angle),c=_.util.cos(o),r=_.util.sin(o);return[c,r,-r,c,0,0]},calcDimensionsMatrix:function(i){var o=typeof i.scaleX>"u"?1:i.scaleX,c=typeof i.scaleY>"u"?1:i.scaleY,r=[i.flipX?-o:o,0,0,i.flipY?-c:c,0,0],f=_.util.multiplyTransformMatrices,m=_.util.degreesToRadians;return i.skewX&&(r=f(r,[1,0,Math.tan(m(i.skewX)),1],!0)),i.skewY&&(r=f(r,[1,Math.tan(m(i.skewY)),0,1],!0)),r},composeMatrix:function(i){var o=[1,0,0,1,i.translateX||0,i.translateY||0],c=_.util.multiplyTransformMatrices;return i.angle&&(o=c(o,_.util.calcRotateMatrix(i))),(1!==i.scaleX||1!==i.scaleY||i.skewX||i.skewY||i.flipX||i.flipY)&&(o=c(o,_.util.calcDimensionsMatrix(i))),o},resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},saveObjectTransform:function(i){return{scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}},isTransparent:function(i,o,c,r){r>0&&(o>r?o-=r:o=0,c>r?c-=r:c=0);var m,f=!0,y=i.getImageData(o,c,2*r||1,2*r||1),x=y.data.length;for(m=3;m<x&&0!=(f=y.data[m]<=0);m+=4);return y=null,f},parsePreserveAspectRatioAttribute:function(i){var m,o="meet",f=i.split(" ");return f&&f.length&&("meet"!==(o=f.pop())&&"slice"!==o?(m=o,o="meet"):f.length&&(m=f.pop())),{meetOrSlice:o,alignX:"none"!==m?m.slice(1,4):"none",alignY:"none"!==m?m.slice(5,8):"none"}},clearFabricFontCache:function(i){(i=(i||"").toLowerCase())?_.charWidthsCache[i]&&delete _.charWidthsCache[i]:_.charWidthsCache={}},limitDimsByArea:function(i,o){var c=Math.sqrt(o*i),r=Math.floor(o/c);return{x:Math.floor(c),y:r}},capValue:function(i,o,c){return Math.max(i,Math.min(o,c))},findScaleToFit:function(i,o){return Math.min(o.width/i.width,o.height/i.height)},findScaleToCover:function(i,o){return Math.max(o.width/i.width,o.height/i.height)},matrixToSVG:function(i){return"matrix("+i.map(function(o){return _.util.toFixed(o,_.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,o){var c=_.util.invertTransform(o),r=_.util.multiplyTransformMatrices(c,i.calcOwnMatrix());_.util.applyTransformToObject(i,r)},addTransformToObject:function(i,o){_.util.applyTransformToObject(i,_.util.multiplyTransformMatrices(o,i.calcOwnMatrix()))},applyTransformToObject:function(i,o){var c=_.util.qrDecompose(o),r=new _.Point(c.translateX,c.translateY);i.flipX=!1,i.flipY=!1,i.set("scaleX",c.scaleX),i.set("scaleY",c.scaleY),i.skewX=c.skewX,i.skewY=c.skewY,i.angle=c.angle,i.setPositionByOrigin(r,"center","center")},sizeAfterTransform:function(i,o,c){var r=i/2,f=o/2,m=[{x:-r,y:-f},{x:r,y:-f},{x:-r,y:f},{x:r,y:f}],v=_.util.calcDimensionsMatrix(c),y=_.util.makeBoundingBoxFromPoints(m,v);return{x:y.width,y:y.height}},mergeClipPaths:function(i,o){var c=i,r=o;c.inverted&&!r.inverted&&(c=o,r=i),_.util.applyTransformToObject(r,_.util.multiplyTransformMatrices(_.util.invertTransform(c.calcTransformMatrix()),r.calcTransformMatrix()));var f=c.inverted&&r.inverted;return f&&(c.inverted=r.inverted=!1),new _.Group([c],{clipPath:r,inverted:f})},hasStyleChanged:function(i,o,c){return c=c||!1,i.fill!==o.fill||i.stroke!==o.stroke||i.strokeWidth!==o.strokeWidth||i.fontSize!==o.fontSize||i.fontFamily!==o.fontFamily||i.fontWeight!==o.fontWeight||i.fontStyle!==o.fontStyle||i.textBackgroundColor!==o.textBackgroundColor||i.deltaY!==o.deltaY||c&&(i.overline!==o.overline||i.underline!==o.underline||i.linethrough!==o.linethrough)},stylesToArray:function(c,o){c=_.util.object.clone(c,!0);for(var r=o.split("\n"),f=-1,m={},v=[],y=0;y<r.length;y++)if(c[y])for(var x=0;x<r[y].length;x++){f++;var w=c[y][x];w&&Object.keys(w).length>0&&(_.util.hasStyleChanged(m,w,!0)?v.push({start:f,end:f+1,style:w}):v[v.length-1].end++),m=w||{}}else f+=r[y].length;return v},stylesFromArray:function(i,o){if(!Array.isArray(i))return i;for(var c=o.split("\n"),r=-1,f=0,m={},v=0;v<c.length;v++)for(var y=0;y<c[v].length;y++)r++,i[f]&&i[f].start<=r&&r<i[f].end&&(m[v]=m[v]||{},m[v][y]=Object.assign({},i[f].style),r===i[f].end-1&&f++);return m}},function(){var p=Array.prototype.join,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},u={m:"l",M:"L"};function h(S,I,D,k,j,E,T,R,L,Y,N){var q=_.util.cos(S),J=_.util.sin(S),st=_.util.cos(I),V=_.util.sin(I),F=D*j*st-k*E*V+T,W=k*j*st+D*E*V+R;return["C",Y+L*(-D*j*J-k*E*q),N+L*(-k*j*J+D*E*q),F+L*(D*j*V+k*E*st),W+L*(k*j*V-D*E*st),F,W]}function s(S,I,D,k){var j=Math.atan2(I,S),E=Math.atan2(k,D);return E>=j?E-j:2*Math.PI-(j-E)}function o(S,I,D){for(var N=function n(S,I,D,k,j,E,T){var R=Math.PI,L=T*R/180,Y=_.util.sin(L),N=_.util.cos(L),q=0,J=0,st=-N*S*.5-Y*I*.5,V=-N*I*.5+Y*S*.5,F=(D=Math.abs(D))*D,W=(k=Math.abs(k))*k,G=V*V,H=st*st,K=F*W-F*G-W*H,ot=0;if(K<0){var bt=Math.sqrt(1-K/(F*W));D*=bt,k*=bt}else ot=(j===E?-1:1)*Math.sqrt(K/(F*G+W*H));var mt=ot*D*V/k,z=-ot*k*st/D,gt=N*mt-Y*z+.5*S,Ct=Y*mt+N*z+.5*I,wt=s(1,0,(st-mt)/D,(V-z)/k),Mt=s((st-mt)/D,(V-z)/k,(-st-mt)/D,(-V-z)/k);0===E&&Mt>0?Mt-=2*R:1===E&&Mt<0&&(Mt+=2*R);for(var St=Math.ceil(Math.abs(Mt/R*2)),Pt=[],Et=Mt/St,Ht=8/3*Math.sin(Et/4)*Math.sin(Et/4)/Math.sin(Et/2),$t=wt+Et,Ft=0;Ft<St;Ft++)Pt[Ft]=h(wt,$t,N,Y,D,k,gt,Ct,Ht,q,J),q=Pt[Ft][5],J=Pt[Ft][6],wt=$t,$t+=Et;return Pt}(D[6]-S,D[7]-I,D[1],D[2],D[4],D[5],D[3]),q=0,J=N.length;q<J;q++)N[q][1]+=S,N[q][2]+=I,N[q][3]+=S,N[q][4]+=I,N[q][5]+=S,N[q][6]+=I;return N}function r(S,I,D,k){return Math.sqrt((D-S)*(D-S)+(k-I)*(k-I))}function x(S,I,D,k,j,E,T,R){return function(L){var Y=function f(S){return S*S*S}(L),N=function m(S){return 3*S*S*(1-S)}(L),q=function v(S){return 3*S*(1-S)*(1-S)}(L),J=function y(S){return(1-S)*(1-S)*(1-S)}(L);return{x:T*Y+j*N+D*q+S*J,y:R*Y+E*N+k*q+I*J}}}function w(S,I,D,k,j,E,T,R){return function(L){var Y=1-L;return Math.atan2(3*Y*Y*(k-I)+6*Y*L*(E-k)+3*L*L*(R-E),3*Y*Y*(D-S)+6*Y*L*(j-D)+3*L*L*(T-j))}}function $(S,I,D,k,j,E){return function(T){var R=function O(S){return S*S}(T),L=function P(S){return 2*S*(1-S)}(T),Y=function X(S){return(1-S)*(1-S)}(T);return{x:j*R+D*L+S*Y,y:E*R+k*L+I*Y}}}function tt(S,I,D,k,j,E){return function(T){var R=1-T;return Math.atan2(2*R*(k-I)+2*T*(E-k),2*R*(D-S)+2*T*(j-D))}}function at(S,I,D){var j,T,k={x:I,y:D},E=0;for(T=1;T<=100;T+=1)j=S(T/100),E+=r(k.x,k.y,j.x,j.y),k=j;return E}function et(S){for(var k,Y,N,q,I=0,D=S.length,j=0,E=0,T=0,R=0,L=[],J=0;J<D;J++){switch(N={x:j,y:E,command:(k=S[J])[0]},k[0]){case"M":N.length=0,T=j=k[1],R=E=k[2];break;case"L":N.length=r(j,E,k[1],k[2]),j=k[1],E=k[2];break;case"C":Y=x(j,E,k[1],k[2],k[3],k[4],k[5],k[6]),q=w(j,E,k[1],k[2],k[3],k[4],k[5],k[6]),N.iterator=Y,N.angleFinder=q,N.length=at(Y,j,E),j=k[5],E=k[6];break;case"Q":Y=$(j,E,k[1],k[2],k[3],k[4]),q=tt(j,E,k[1],k[2],k[3],k[4]),N.iterator=Y,N.angleFinder=q,N.length=at(Y,j,E),j=k[3],E=k[4];break;case"Z":case"z":N.destX=T,N.destY=R,N.length=r(j,E,T,R),j=T,E=R}I+=N.length,L.push(N)}return L.push({length:I,x:j,y:E}),L}_.util.joinPath=function(S){return S.map(function(I){return I.join(" ")}).join(" ")},_.util.parsePath=function ut(S){var k,j,q,J,st,I=[],D=[],E=_.rePathCommand,T="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",R="("+T+")"+_.commaWsp,L="([01])"+_.commaWsp+"?",N=new RegExp(R+"?"+R+"?"+R+L+L+R+"?("+T+")","g");if(!S||!S.match)return I;for(var F,V=0,W=(st=S.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;V<W;V++){J=(k=st[V]).slice(1).trim(),D.length=0;var G=k.charAt(0);if(F=[G],"a"===G.toLowerCase())for(var H;H=N.exec(J);)for(var K=1;K<H.length;K++)D.push(H[K]);else for(;q=E.exec(J);)D.push(q[0]);K=0;for(var ot=D.length;K<ot;K++)j=parseFloat(D[K]),isNaN(j)||F.push(j);var bt=a[G.toLowerCase()],mt=u[G]||G;if(F.length-1>bt)for(var z=1,gt=F.length;z<gt;z+=bt)I.push([G].concat(F.slice(z,z+bt))),G=mt;else I.push(F)}return I},_.util.makePathSimpler=function c(S){var T,R,L,N,q,J,I=0,D=0,k=S.length,j=0,E=0,Y=[];for(R=0;R<k;++R){switch(L=!1,(T=S[R].slice(0))[0]){case"l":T[0]="L",T[1]+=I,T[2]+=D;case"L":I=T[1],D=T[2];break;case"h":T[1]+=I;case"H":T[0]="L",T[2]=D,I=T[1];break;case"v":T[1]+=D;case"V":T[0]="L",D=T[1],T[1]=I,T[2]=D;break;case"m":T[0]="M",T[1]+=I,T[2]+=D;case"M":I=T[1],D=T[2],j=T[1],E=T[2];break;case"c":T[0]="C",T[1]+=I,T[2]+=D,T[3]+=I,T[4]+=D,T[5]+=I,T[6]+=D;case"C":q=T[3],J=T[4],I=T[5],D=T[6];break;case"s":T[0]="S",T[1]+=I,T[2]+=D,T[3]+=I,T[4]+=D;case"S":"C"===N?(q=2*I-q,J=2*D-J):(q=I,J=D),I=T[3],D=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=q,T[2]=J,q=T[3],J=T[4];break;case"q":T[0]="Q",T[1]+=I,T[2]+=D,T[3]+=I,T[4]+=D;case"Q":q=T[1],J=T[2],I=T[3],D=T[4];break;case"t":T[0]="T",T[1]+=I,T[2]+=D;case"T":"Q"===N?(q=2*I-q,J=2*D-J):(q=I,J=D),T[0]="Q",I=T[1],D=T[2],T[1]=q,T[2]=J,T[3]=I,T[4]=D;break;case"a":T[0]="A",T[6]+=I,T[7]+=D;case"A":L=!0,Y=Y.concat(o(I,D,T)),I=T[6],D=T[7];break;case"z":case"Z":I=j,D=E}L||Y.push(T),N=T[0]}return Y},_.util.getSmoothPathFromPoints=function pt(S,I){var k,D=[],j=new _.Point(S[0].x,S[0].y),E=new _.Point(S[1].x,S[1].y),T=S.length,R=1,L=0,Y=T>2;for(Y&&(R=S[2].x<E.x?-1:S[2].x===E.x?0:1,L=S[2].y<E.y?-1:S[2].y===E.y?0:1),D.push(["M",j.x-R*(I=I||0),j.y-L*I]),k=1;k<T;k++){if(!j.eq(E)){var N=j.midPointFrom(E);D.push(["Q",j.x,j.y,N.x,N.y])}j=S[k],k+1<S.length&&(E=S[k+1])}return Y&&(R=j.x>S[k-2].x?1:j.x===S[k-2].x?0:-1,L=j.y>S[k-2].y?1:j.y===S[k-2].y?0:-1),D.push(["L",j.x+R*I,j.y+L*I]),D},_.util.getPathSegmentsInfo=et,_.util.getBoundsOfCurve=function i(S,I,D,k,j,E,T,R){var L;if(_.cachesBoundsOfCurve&&(L=p.call(arguments),_.boundsOfCurveCache[L]))return _.boundsOfCurveCache[L];var F,W,G,H,K,ot,bt,mt,Y=Math.sqrt,N=Math.min,q=Math.max,J=Math.abs,st=[],V=[[],[]];W=6*S-12*D+6*j,F=-3*S+9*D-9*j+3*T,G=3*D-3*S;for(var z=0;z<2;++z)if(z>0&&(W=6*I-12*k+6*E,F=-3*I+9*k-9*E+3*R,G=3*k-3*I),J(F)<1e-12){if(J(W)<1e-12)continue;0<(H=-G/W)&&H<1&&st.push(H)}else!((bt=W*W-4*G*F)<0)&&(0<(K=(-W+(mt=Y(bt)))/(2*F))&&K<1&&st.push(K),0<(ot=(-W-mt)/(2*F))&&ot<1&&st.push(ot));for(var St,wt=st.length,Mt=wt;wt--;)V[0][wt]=(St=1-(H=st[wt]))*St*St*S+3*St*St*H*D+3*St*H*H*j+H*H*H*T,V[1][wt]=St*St*St*I+3*St*St*H*k+3*St*H*H*E+H*H*H*R;V[0][Mt]=S,V[1][Mt]=I,V[0][Mt+1]=T,V[1][Mt+1]=R;var Pt=[{x:N.apply(null,V[0]),y:N.apply(null,V[1])},{x:q.apply(null,V[0]),y:q.apply(null,V[1])}];return _.cachesBoundsOfCurve&&(_.boundsOfCurveCache[L]=Pt),Pt},_.util.getPointOnPath=function rt(S,I,D){D||(D=et(S));for(var k=0;I-D[k].length>0&&k<D.length-2;)I-=D[k].length,k++;var L,j=D[k],E=I/j.length,R=S[k];switch(j.command){case"M":return{x:j.x,y:j.y,angle:0};case"Z":case"z":return(L=new _.Point(j.x,j.y).lerp(new _.Point(j.destX,j.destY),E)).angle=Math.atan2(j.destY-j.y,j.destX-j.x),L;case"L":return(L=new _.Point(j.x,j.y).lerp(new _.Point(R[1],R[2]),E)).angle=Math.atan2(R[2]-j.y,R[1]-j.x),L;case"C":case"Q":return function ht(S,I){for(var T,R,N,D=0,k=0,j=S.iterator,E={x:S.x,y:S.y},L=.01,Y=S.angleFinder;k<I&&L>1e-4;)T=j(D),N=D,(R=r(E.x,E.y,T.x,T.y))+k>I?(D-=L,L/=2):(E=T,D+=L,k+=R);return T.angle=Y(N),T}(j,I)}},_.util.transformPath=function ft(S,I,D){return D&&(I=_.util.multiplyTransformMatrices(I,[1,0,0,1,-D.x,-D.y])),S.map(function(k){for(var j=k.slice(0),E={},T=1;T<k.length-1;T+=2)E.x=k[T],E.y=k[T+1],E=_.util.transformPoint(E,I),j[T]=E.x,j[T+1]=E.y;return j})}}(),function(){var p=Array.prototype.slice;function s(i,o,c){if(i&&0!==i.length){var r=i.length-1,f=o?i[r][o]:i[r];if(o)for(;r--;)c(i[r][o],f)&&(f=i[r][o]);else for(;r--;)c(i[r],f)&&(f=i[r]);return f}}_.util.array={fill:function n(i,o){for(var c=i.length;c--;)i[c]=o;return i},invoke:function a(i,o){for(var c=p.call(arguments,2),r=[],f=0,m=i.length;f<m;f++)r[f]=c.length?i[f][o].apply(i[f],c):i[f][o].call(i[f]);return r},min:function h(i,o){return s(i,o,function(c,r){return c<r})},max:function u(i,o){return s(i,o,function(c,r){return c>=r})}}}(),function(){function p(u,h,n){if(n)if(!_.isLikelyNode&&h instanceof Element)u=h;else if(h instanceof Array){u=[];for(var s=0,i=h.length;s<i;s++)u[s]=p({},h[s],n)}else if(h&&"object"==typeof h)for(var o in h)"canvas"===o||"group"===o?u[o]=null:h.hasOwnProperty(o)&&(u[o]=p({},h[o],n));else u=h;else for(var o in h)u[o]=h[o];return u}_.util.object={extend:p,clone:function a(u,h){return p({},u,h)}},_.util.object.extend(_.util,_.Observable)}(),function(){function n(s,i){var o=s.charCodeAt(i);if(isNaN(o))return"";if(o<55296||o>57343)return s.charAt(i);if(55296<=o&&o<=56319){if(s.length<=i+1)throw"High surrogate without following low surrogate";var c=s.charCodeAt(i+1);if(56320>c||c>57343)throw"High surrogate without following low surrogate";return s.charAt(i)+s.charAt(i+1)}if(0===i)throw"Low surrogate without preceding high surrogate";var r=s.charCodeAt(i-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}_.util.string={camelize:function p(s){return s.replace(/-+(.)?/g,function(i,o){return o?o.toUpperCase():""})},capitalize:function a(s,i){return s.charAt(0).toUpperCase()+(i?s.slice(1):s.slice(1).toLowerCase())},escapeXml:function u(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function h(s){var o,i=0,c=[];for(i=0;i<s.length;i++)!1!==(o=n(s,i))&&c.push(o);return c}}}(),function(){var p=Array.prototype.slice,a=function(){},u=function(){for(var o in{toString:1})if("toString"===o)return!1;return!0}(),h=function(o,c,r){for(var f in c)o.prototype[f]=f in o.prototype&&"function"==typeof o.prototype[f]&&(c[f]+"").indexOf("callSuper")>-1?function(m){return function(){var v=this.constructor.superclass;this.constructor.superclass=r;var y=c[m].apply(this,arguments);if(this.constructor.superclass=v,"initialize"!==m)return y}}(f):c[f],u&&(c.toString!==Object.prototype.toString&&(o.prototype.toString=c.toString),c.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=c.valueOf))};function n(){}function s(o){for(var c=null,r=this;r.constructor.superclass;){var f=r.constructor.superclass.prototype[o];if(r[o]!==f){c=f;break}r=r.constructor.superclass.prototype}return c?arguments.length>1?c.apply(this,p.call(arguments,1)):c.call(this):console.log("tried to callSuper "+o+", method not found in prototype chain",this)}_.util.createClass=function i(){var o=null,c=p.call(arguments,0);function r(){this.initialize.apply(this,arguments)}"function"==typeof c[0]&&(o=c.shift()),r.superclass=o,r.subclasses=[],o&&(n.prototype=o.prototype,r.prototype=new n,o.subclasses.push(r));for(var f=0,m=c.length;f<m;f++)h(r,c[f],o);return r.prototype.initialize||(r.prototype.initialize=a),r.prototype.constructor=r,r.prototype.callSuper=s,r}}(),function(){var p=!!_.document.createElement("div").attachEvent,a=["touchstart","touchmove","touchend"];_.util.addListener=function(h,n,s,i){h&&h.addEventListener(n,s,!p&&i)},_.util.removeListener=function(h,n,s,i){h&&h.removeEventListener(n,s,!p&&i)},_.util.getPointer=function(h){var s=_.util.getScrollLeftTop(h.target),i=function u(h){var n=h.changedTouches;return n&&n[0]?n[0]:h}(h);return{x:i.clientX+s.left,y:i.clientY+s.top}},_.util.isTouchEvent=function(h){return a.indexOf(h.type)>-1||"touch"===h.pointerType}}(),function(){var a=_.document.createElement("div"),n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(i){return i};"string"==typeof a.style.opacity?s=function(i,o){return i.style.opacity=o,i}:"string"==typeof a.style.filter&&(s=function(i,o){var c=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(c.zoom=1),n.test(c.filter)?c.filter=c.filter.replace(n,o=o>=.9999?"":"alpha(opacity="+100*o+")"):c.filter+=" alpha(opacity="+100*o+")",i}),_.util.setStyle=function p(i,o){var c=i.style;if(!c)return i;if("string"==typeof o)return i.style.cssText+=";"+o,o.indexOf("opacity")>-1?s(i,o.match(/opacity:\s*(\d?\.?\d*)/)[1]):i;for(var r in o)"opacity"===r?s(i,o[r]):c.setProperty("float"===r||"cssFloat"===r?typeof c.styleFloat>"u"?"cssFloat":"styleFloat":r,o[r]);return i}}(),function(){var u,r,y,x,p=Array.prototype.slice,h=function(y){return p.call(y,0)};try{u=h(_.document.childNodes)instanceof Array}catch{}function n(y,x){var w=_.document.createElement(y);for(var O in x)"class"===O?w.className=x[O]:"for"===O?w.htmlFor=x[O]:w.setAttribute(O,x[O]);return w}function o(y){for(var x=0,w=0,O=_.document.documentElement,P=_.document.body||{scrollLeft:0,scrollTop:0};y&&(y.parentNode||y.host)&&((y=y.parentNode||y.host)===_.document?(x=P.scrollLeft||O.scrollLeft||0,w=P.scrollTop||O.scrollTop||0):(x+=y.scrollLeft||0,w+=y.scrollTop||0),1!==y.nodeType||"fixed"!==y.style.position););return{left:x,top:w}}u||(h=function(y){for(var x=new Array(y.length),w=y.length;w--;)x[w]=y[w];return x}),r=_.document.defaultView&&_.document.defaultView.getComputedStyle?function(y,x){var w=_.document.defaultView.getComputedStyle(y,null);return w?w[x]:void 0}:function(y,x){var w=y.style[x];return!w&&y.currentStyle&&(w=y.currentStyle[x]),w},x="userSelect"in(y=_.document.documentElement.style)?"userSelect":"MozUserSelect"in y?"MozUserSelect":"WebkitUserSelect"in y?"WebkitUserSelect":"KhtmlUserSelect"in y?"KhtmlUserSelect":"",_.util.makeElementUnselectable=function w(P){return typeof P.onselectstart<"u"&&(P.onselectstart=_.util.falseFunction),x?P.style[x]="none":"string"==typeof P.unselectable&&(P.unselectable="on"),P},_.util.makeElementSelectable=function O(P){return typeof P.onselectstart<"u"&&(P.onselectstart=null),x?P.style[x]="":"string"==typeof P.unselectable&&(P.unselectable=""),P},_.util.setImageSmoothing=function v(y,x){y.imageSmoothingEnabled=y.imageSmoothingEnabled||y.webkitImageSmoothingEnabled||y.mozImageSmoothingEnabled||y.msImageSmoothingEnabled||y.oImageSmoothingEnabled,y.imageSmoothingEnabled=x},_.util.getById=function a(y){return"string"==typeof y?_.document.getElementById(y):y},_.util.toArray=h,_.util.addClass=function s(y,x){y&&-1===(" "+y.className+" ").indexOf(" "+x+" ")&&(y.className+=(y.className?" ":"")+x)},_.util.makeElement=n,_.util.wrapElement=function i(y,x,w){return"string"==typeof x&&(x=n(x,w)),y.parentNode&&y.parentNode.replaceChild(x,y),x.appendChild(y),x},_.util.getScrollLeftTop=o,_.util.getElementOffset=function c(y){var x,X,w=y&&y.ownerDocument,O={left:0,top:0},P={left:0,top:0},$={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!w)return P;for(var tt in $)P[$[tt]]+=parseInt(r(y,tt),10)||0;return x=w.documentElement,typeof y.getBoundingClientRect<"u"&&(O=y.getBoundingClientRect()),X=o(y),{left:O.left+X.left-(x.clientLeft||0)+P.left,top:O.top+X.top-(x.clientTop||0)+P.top}},_.util.getNodeCanvas=function f(y){var x=_.jsdomImplForWrapper(y);return x._canvas||x._image},_.util.cleanUpJsdomNode=function m(y){if(_.isLikelyNode){var x=_.jsdomImplForWrapper(y);x&&(x._image=null,x._canvas=null,x._currentSrc=null,x._attributes=null,x._classList=null)}}}(),function(){function a(){}_.util.request=function u(h,n){n||(n={});var s=n.method?n.method.toUpperCase():"GET",i=n.onComplete||function(){},o=new _.window.XMLHttpRequest,c=n.body||n.parameters;return o.onreadystatechange=function(){4===o.readyState&&(i(o),o.onreadystatechange=a)},"GET"===s&&(c=null,"string"==typeof n.parameters&&(h=function p(h,n){return h+(/\?/.test(h)?"&":"?")+n}(h,n.parameters))),o.open(s,h,!0),("POST"===s||"PUT"===s)&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(c),o}}(),_.log=console.log,_.warn=console.warn,function(){var p=_.util.object.extend,a=_.util.object.clone,u=[];function h(){return!1}function n(f,m,v,y){return-v*Math.cos(f/y*(Math.PI/2))+v+m}_.util.object.extend(u,{cancelAll:function(){var f=this.splice(0);return f.forEach(function(m){m.cancel()}),f},cancelByCanvas:function(f){if(!f)return[];var m=this.filter(function(v){return"object"==typeof v.target&&v.target.canvas===f});return m.forEach(function(v){v.cancel()}),m},cancelByTarget:function(f){var m=this.findAnimationsByTarget(f);return m.forEach(function(v){v.cancel()}),m},findAnimationIndex:function(f){return this.indexOf(this.findAnimation(f))},findAnimation:function(f){return this.find(function(m){return m.cancel===f})},findAnimationsByTarget:function(f){return f?this.filter(function(m){return m.target===f}):[]}});var i=_.window.requestAnimationFrame||_.window.webkitRequestAnimationFrame||_.window.mozRequestAnimationFrame||_.window.oRequestAnimationFrame||_.window.msRequestAnimationFrame||function(f){return _.window.setTimeout(f,1e3/60)},o=_.window.cancelAnimationFrame||_.window.clearTimeout;function c(){return i.apply(_.window,arguments)}_.util.animate=function s(f){f||(f={});var v,m=!1,y=function(){var x=_.runningAnimations.indexOf(v);return x>-1&&_.runningAnimations.splice(x,1)[0]};return v=p(a(f),{cancel:function(){return m=!0,y()},currentValue:"startValue"in f?f.startValue:0,completionRate:0,durationRate:0}),_.runningAnimations.push(v),c(function(x){var X,w=x||+new Date,O=f.duration||500,P=w+O,$=f.onChange||h,tt=f.abort||h,at=f.onComplete||h,ht=f.easing||n,et="startValue"in f&&f.startValue.length>0,rt="startValue"in f?f.startValue:0,ut="endValue"in f?f.endValue:100,pt=f.byValue||(et?rt.map(function(ft,S){return ut[S]-rt[S]}):ut-rt);f.onStart&&f.onStart(),function ft(S){var I=(X=S||+new Date)>P?O:X-w,D=I/O,k=et?rt.map(function(E,T){return ht(I,rt[T],pt[T],O)}):ht(I,rt,pt,O),j=Math.abs(et?(k[0]-rt[0])/pt[0]:(k-rt)/pt);if(v.currentValue=et?k.slice():k,v.completionRate=j,v.durationRate=D,!m){if(tt(k,j,D))return void y();if(X>P)return v.currentValue=et?ut.slice():ut,v.completionRate=1,v.durationRate=1,$(et?ut.slice():ut,1,1),at(ut,1,1),void y();$(k,j,D),c(ft)}}(w)}),v.cancel},_.util.requestAnimFrame=c,_.util.cancelAnimFrame=function r(){return o.apply(_.window,arguments)},_.runningAnimations=u}(),function(){function p(u,h,n){var s="rgba("+parseInt(u[0]+n*(h[0]-u[0]),10)+","+parseInt(u[1]+n*(h[1]-u[1]),10)+","+parseInt(u[2]+n*(h[2]-u[2]),10);return(s+=","+(u&&h?parseFloat(u[3]+n*(h[3]-u[3])):1))+")"}_.util.animateColor=function a(u,h,n,s){var i=new _.Color(u).getSource(),o=new _.Color(h).getSource(),c=s.onComplete,r=s.onChange;return _.util.animate(_.util.object.extend(s=s||{},{duration:n||500,startValue:i,endValue:o,byValue:o,easing:function(f,m,v,y){return p(m,v,s.colorEasing?s.colorEasing(f,y):1-Math.cos(f/y*(Math.PI/2)))},onComplete:function(f,m,v){if(c)return c(p(o,o,0),m,v)},onChange:function(f,m,v){if(r){if(Array.isArray(f))return r(p(f,f,0),m,v);r(f,m,v)}}}))}}(),function(){function p(S,I,D,k){return S<Math.abs(I)?(S=I,k=D/4):k=0===I&&0===S?D/(2*Math.PI)*Math.asin(1):D/(2*Math.PI)*Math.asin(I/S),{a:S,c:I,p:D,s:k}}function a(S,I,D){return S.a*Math.pow(2,10*(I-=1))*Math.sin((I*D-S.s)*(2*Math.PI)/S.p)}function ut(S,I,D,k){return D-pt(k-S,0,D,k)+I}function pt(S,I,D,k){return(S/=k)<1/2.75?D*(7.5625*S*S)+I:S<2/2.75?D*(7.5625*(S-=1.5/2.75)*S+.75)+I:S<2.5/2.75?D*(7.5625*(S-=2.25/2.75)*S+.9375)+I:D*(7.5625*(S-=2.625/2.75)*S+.984375)+I}_.util.ease={easeInQuad:function(S,I,D,k){return D*(S/=k)*S+I},easeOutQuad:function(S,I,D,k){return-D*(S/=k)*(S-2)+I},easeInOutQuad:function(S,I,D,k){return(S/=k/2)<1?D/2*S*S+I:-D/2*(--S*(S-2)-1)+I},easeInCubic:function(S,I,D,k){return D*(S/=k)*S*S+I},easeOutCubic:function u(S,I,D,k){return D*((S=S/k-1)*S*S+1)+I},easeInOutCubic:function h(S,I,D,k){return(S/=k/2)<1?D/2*S*S*S+I:D/2*((S-=2)*S*S+2)+I},easeInQuart:function n(S,I,D,k){return D*(S/=k)*S*S*S+I},easeOutQuart:function s(S,I,D,k){return-D*((S=S/k-1)*S*S*S-1)+I},easeInOutQuart:function i(S,I,D,k){return(S/=k/2)<1?D/2*S*S*S*S+I:-D/2*((S-=2)*S*S*S-2)+I},easeInQuint:function o(S,I,D,k){return D*(S/=k)*S*S*S*S+I},easeOutQuint:function c(S,I,D,k){return D*((S=S/k-1)*S*S*S*S+1)+I},easeInOutQuint:function r(S,I,D,k){return(S/=k/2)<1?D/2*S*S*S*S*S+I:D/2*((S-=2)*S*S*S*S+2)+I},easeInSine:function f(S,I,D,k){return-D*Math.cos(S/k*(Math.PI/2))+D+I},easeOutSine:function m(S,I,D,k){return D*Math.sin(S/k*(Math.PI/2))+I},easeInOutSine:function v(S,I,D,k){return-D/2*(Math.cos(Math.PI*S/k)-1)+I},easeInExpo:function y(S,I,D,k){return 0===S?I:D*Math.pow(2,10*(S/k-1))+I},easeOutExpo:function x(S,I,D,k){return S===k?I+D:D*(1-Math.pow(2,-10*S/k))+I},easeInOutExpo:function w(S,I,D,k){return 0===S?I:S===k?I+D:(S/=k/2)<1?D/2*Math.pow(2,10*(S-1))+I:D/2*(2-Math.pow(2,-10*--S))+I},easeInCirc:function O(S,I,D,k){return-D*(Math.sqrt(1-(S/=k)*S)-1)+I},easeOutCirc:function P(S,I,D,k){return D*Math.sqrt(1-(S=S/k-1)*S)+I},easeInOutCirc:function X(S,I,D,k){return(S/=k/2)<1?-D/2*(Math.sqrt(1-S*S)-1)+I:D/2*(Math.sqrt(1-(S-=2)*S)+1)+I},easeInElastic:function $(S,I,D,k){var E=0;return 0===S?I:1==(S/=k)?I+D:(E||(E=.3*k),-a(p(D,D,E,1.70158),S,k)+I)},easeOutElastic:function tt(S,I,D,k){var E=0;if(0===S)return I;if(1==(S/=k))return I+D;E||(E=.3*k);var R=p(D,D,E,1.70158);return R.a*Math.pow(2,-10*S)*Math.sin((S*k-R.s)*(2*Math.PI)/R.p)+R.c+I},easeInOutElastic:function at(S,I,D,k){var E=0;if(0===S)return I;if(2==(S/=k/2))return I+D;E||(E=k*(.3*1.5));var R=p(D,D,E,1.70158);return S<1?-.5*a(R,S,k)+I:R.a*Math.pow(2,-10*(S-=1))*Math.sin((S*k-R.s)*(2*Math.PI)/R.p)*.5+R.c+I},easeInBack:function ht(S,I,D,k,j){return void 0===j&&(j=1.70158),D*(S/=k)*S*((j+1)*S-j)+I},easeOutBack:function et(S,I,D,k,j){return void 0===j&&(j=1.70158),D*((S=S/k-1)*S*((j+1)*S+j)+1)+I},easeInOutBack:function rt(S,I,D,k,j){return void 0===j&&(j=1.70158),(S/=k/2)<1?D/2*(S*S*((1+(j*=1.525))*S-j))+I:D/2*((S-=2)*S*((1+(j*=1.525))*S+j)+2)+I},easeInBounce:ut,easeOutBounce:pt,easeInOutBounce:function ft(S,I,D,k){return S<k/2?.5*ut(2*S,0,D,k)+I:.5*pt(2*S-k,0,D,k)+.5*D+I}}}(),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.extend,h=a.util.object.clone,n=a.util.toFixed,s=a.util.parseUnit,i=a.util.multiplyTransformMatrices,m={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},v={stroke:"strokeOpacity",fill:"fillOpacity"},y="font-size",x="clip-path";function w(E){return E in m?m[E]:E}function O(E,T,R,L){var N,Y=Array.isArray(T);if("fill"!==E&&"stroke"!==E||"none"!==T){if("strokeUniform"===E)return"non-scaling-stroke"===T;if("strokeDashArray"===E)T="none"===T?null:T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===E)T=R&&R.transformMatrix?i(R.transformMatrix,a.parseTransformAttribute(T)):a.parseTransformAttribute(T);else if("visible"===E)T="none"!==T&&"hidden"!==T,R&&!1===R.visible&&(T=!1);else if("opacity"===E)T=parseFloat(T),R&&typeof R.opacity<"u"&&(T*=R.opacity);else if("textAnchor"===E)T="start"===T?"left":"end"===T?"right":"center";else if("charSpacing"===E)N=s(T,L)/L*1e3;else if("paintFirst"===E){var q=T.indexOf("fill"),J=T.indexOf("stroke");T="fill",(q>-1&&J>-1&&J<q||-1===q&&J>-1)&&(T="stroke")}else{if("href"===E||"xlink:href"===E||"font"===E)return T;if("imageSmoothing"===E)return"optimizeQuality"===T;N=Y?T.map(s):s(T,L)}}else T="";return!Y&&isNaN(N)?T:N}function P(E){return new RegExp("^("+E.join("|")+")\\b","i")}function $(E,T){var Y,N,q,L=[];for(N=0,q=T.length;N<q;N++)Y=E.getElementsByTagName(T[N]),L=L.concat(Array.prototype.slice.call(Y));return L}function et(E,T){var R,L=!0;return(R=ut(E,T.pop()))&&T.length&&(L=function rt(E,T){for(var R,L=!0;E.parentNode&&1===E.parentNode.nodeType&&T.length;)L&&(R=T.pop()),L=ut(E=E.parentNode,R);return 0===T.length}(E,T)),R&&L&&0===T.length}function ut(E,T){var N,q,R=E.nodeName,L=E.getAttribute("class"),Y=E.getAttribute("id");if(N=new RegExp("^"+R,"i"),T=T.replace(N,""),Y&&T.length&&(N=new RegExp("#"+Y+"(?![a-zA-Z\\-]+)","i"),T=T.replace(N,"")),L&&T.length)for(q=(L=L.split(" ")).length;q--;)N=new RegExp("\\."+L[q]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(N,"");return 0===T.length}function pt(E,T){var R;if(E.getElementById&&(R=E.getElementById(T)),R)return R;var L,Y,N,q=E.getElementsByTagName("*");for(Y=0,N=q.length;Y<N;Y++)if(T===(L=q[Y]).getAttribute("id"))return L}a.svgValidTagNamesRegEx=P(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),a.svgViewBoxElementsRegEx=P(["symbol","image","marker","pattern","view","svg"]),a.svgInvalidAncestorsRegEx=P(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),a.svgValidParentsRegEx=P(["symbol","g","a","svg","clipPath","defs"]),a.cssRules={},a.gradientDefs={},a.clipPaths={},a.parseTransformAttribute=function(){function R(z,gt,Ct){z[Ct]=Math.tan(a.util.degreesToRadians(gt[0]))}var Y=a.iMatrix,N=a.reNum,q=a.commaWsp,H="(?:(?:(matrix)\\s*\\(\\s*("+N+")"+q+"("+N+")"+q+"("+N+")"+q+"("+N+")"+q+"("+N+")"+q+"("+N+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+N+")(?:"+q+"("+N+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+N+")(?:"+q+"("+N+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+N+")(?:"+q+"("+N+")"+q+"("+N+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+N+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+N+")\\s*\\)))",bt=new RegExp("^\\s*(?:(?:"+H+"(?:"+q+"*"+H+")*)?)\\s*$"),mt=new RegExp(H,"g");return function(z){var gt=Y.concat(),Ct=[];if(!z||z&&!bt.test(z))return gt;z.replace(mt,function(Mt){var St=new RegExp(H).exec(Mt).filter(function(Ht){return!!Ht}),Pt=St[1],Et=St.slice(2).map(parseFloat);switch(Pt){case"translate":!function L(z,gt){z[4]=gt[0],2===gt.length&&(z[5]=gt[1])}(gt,Et);break;case"rotate":Et[0]=a.util.degreesToRadians(Et[0]),function E(z,gt){var Ct=a.util.cos(gt[0]),wt=a.util.sin(gt[0]),Mt=0,St=0;3===gt.length&&(Mt=gt[1],St=gt[2]),z[0]=Ct,z[1]=wt,z[2]=-wt,z[3]=Ct,z[4]=Mt-(Ct*Mt-wt*St),z[5]=St-(wt*Mt+Ct*St)}(gt,Et);break;case"scale":!function T(z,gt){var wt=2===gt.length?gt[1]:gt[0];z[0]=gt[0],z[3]=wt}(gt,Et);break;case"skewX":R(gt,Et,2);break;case"skewY":R(gt,Et,1);break;case"matrix":gt=Et}Ct.push(gt.concat()),gt=Y.concat()});for(var wt=Ct[0];Ct.length>1;)Ct.shift(),wt=a.util.multiplyTransformMatrices(wt,Ct[0]);return wt}}();var S=new RegExp("^\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*$");function I(E){if(!a.svgViewBoxElementsRegEx.test(E.nodeName))return{};var Y,N,q,J,st,V,T=E.getAttribute("viewBox"),R=1,L=1,F=E.getAttribute("width"),W=E.getAttribute("height"),G=E.getAttribute("x")||0,H=E.getAttribute("y")||0,K=E.getAttribute("preserveAspectRatio")||"",ot=!T||!(T=T.match(S)),bt=!F||!W||"100%"===F||"100%"===W,mt=ot&&bt,z={},gt="",Ct=0,wt=0;if(z.width=0,z.height=0,z.toBeParsed=mt,ot&&(G||H)&&E.parentNode&&"#document"!==E.parentNode.nodeName&&(gt=" translate("+s(G)+" "+s(H)+") ",st=(E.getAttribute("transform")||"")+gt,E.setAttribute("transform",st),E.removeAttribute("x"),E.removeAttribute("y")),mt)return z;if(ot)return z.width=s(F),z.height=s(W),z;if(Y=-parseFloat(T[1]),N=-parseFloat(T[2]),q=parseFloat(T[3]),J=parseFloat(T[4]),z.minX=Y,z.minY=N,z.viewBoxWidth=q,z.viewBoxHeight=J,bt?(z.width=q,z.height=J):(z.width=s(F),z.height=s(W),R=z.width/q,L=z.height/J),"none"!==(K=a.util.parsePreserveAspectRatioAttribute(K)).alignX&&("meet"===K.meetOrSlice&&(L=R=R>L?L:R),"slice"===K.meetOrSlice&&(L=R=R>L?R:L),Ct=z.width-q*R,wt=z.height-J*R,"Mid"===K.alignX&&(Ct/=2),"Mid"===K.alignY&&(wt/=2),"Min"===K.alignX&&(Ct=0),"Min"===K.alignY&&(wt=0)),1===R&&1===L&&0===Y&&0===N&&0===G&&0===H)return z;if((G||H)&&"#document"!==E.parentNode.nodeName&&(gt=" translate("+s(G)+" "+s(H)+") "),st=gt+" matrix("+R+" 0 0 "+L+" "+(Y*R+Ct)+" "+(N*L+wt)+") ","svg"===E.nodeName){for(V=E.ownerDocument.createElementNS(a.svgNS,"g");E.firstChild;)V.appendChild(E.firstChild);E.appendChild(V)}else(V=E).removeAttribute("x"),V.removeAttribute("y"),st=V.getAttribute("transform")+st;return V.setAttribute("transform",st),z}function k(E,T){var L="xlink:href",N=pt(E,T.getAttribute(L).slice(1));if(N&&N.getAttribute(L)&&k(E,N),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(J){N&&!T.hasAttribute(J)&&N.hasAttribute(J)&&T.setAttribute(J,N.getAttribute(J))}),!T.children.length)for(var q=N.cloneNode(!0);q.firstChild;)T.appendChild(q.firstChild);T.removeAttribute(L)}a.parseSVGDocument=function(E,T,R,L){if(E){!function ft(E){for(var T=$(E,["use","svg:use"]),R=0;T.length&&R<T.length;){var L=T[R],Y=L.getAttribute("xlink:href")||L.getAttribute("href");if(null===Y)return;var G,H,K,ot,N=Y.slice(1),q=L.getAttribute("x")||0,J=L.getAttribute("y")||0,st=pt(E,N).cloneNode(!0),V=(st.getAttribute("transform")||"")+" translate("+q+", "+J+")",W=T.length,bt=a.svgNS;if(I(st),/^svg$/i.test(st.nodeName)){var mt=st.ownerDocument.createElementNS(bt,"g");for(H=0,ot=(K=st.attributes).length;H<ot;H++)G=K.item(H),mt.setAttributeNS(bt,G.nodeName,G.nodeValue);for(;st.firstChild;)mt.appendChild(st.firstChild);st=mt}for(H=0,ot=(K=L.attributes).length;H<ot;H++)"x"!==(G=K.item(H)).nodeName&&"y"!==G.nodeName&&"xlink:href"!==G.nodeName&&"href"!==G.nodeName&&("transform"===G.nodeName?V=G.nodeValue+" "+V:st.setAttribute(G.nodeName,G.nodeValue));st.setAttribute("transform",V),st.setAttribute("instantiated_by_use","1"),st.removeAttribute("id"),L.parentNode.replaceChild(st,L),T.length===W&&R++}}(E);var N,q,Y=a.Object.__uid++,J=I(E),st=a.util.toArray(E.getElementsByTagName("*"));if(J.crossOrigin=L&&L.crossOrigin,J.svgUid=Y,0===st.length&&a.isLikelyNode){var V=[];for(N=0,q=(st=E.selectNodes('//*[name(.)!="svg"]')).length;N<q;N++)V[N]=st[N];st=V}var F=st.filter(function(G){return I(G),a.svgValidTagNamesRegEx.test(G.nodeName.replace("svg:",""))&&!function D(E,T){for(;E&&(E=E.parentNode);)if(E.nodeName&&T.test(E.nodeName.replace("svg:",""))&&!E.getAttribute("instantiated_by_use"))return!0;return!1}(G,a.svgInvalidAncestorsRegEx)});if(!F||F&&!F.length)return void(T&&T([],{}));var W={};st.filter(function(G){return"clipPath"===G.nodeName.replace("svg:","")}).forEach(function(G){var H=G.getAttribute("id");W[H]=a.util.toArray(G.getElementsByTagName("*")).filter(function(K){return a.svgValidTagNamesRegEx.test(K.nodeName.replace("svg:",""))})}),a.gradientDefs[Y]=a.getGradientDefs(E),a.cssRules[Y]=a.getCSSRules(E),a.clipPaths[Y]=W,a.parseElements(F,function(G,H){T&&(T(G,J,H,st),delete a.gradientDefs[Y],delete a.cssRules[Y],delete a.clipPaths[Y])},h(J),R,L)}};var j=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+a.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+a.reNum+"))?\\s+(.*)");u(a,{parseFontDeclaration:function(E,T){var R=E.match(j);if(R){var L=R[1],Y=R[3],N=R[4],q=R[5],J=R[6];L&&(T.fontStyle=L),Y&&(T.fontWeight=isNaN(parseFloat(Y))?Y:parseFloat(Y)),N&&(T.fontSize=s(N)),J&&(T.fontFamily=J),q&&(T.lineHeight="normal"===q?1:q)}},getGradientDefs:function(E){var L,R=$(E,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),Y=0,N={};for(Y=R.length;Y--;)(L=R[Y]).getAttribute("xlink:href")&&k(E,L),N[L.getAttribute("id")]=L;return N},parseAttributes:function(E,T,R){if(E){var L,N,q,Y={};typeof R>"u"&&(R=E.getAttribute("svgUid")),E.parentNode&&a.svgValidParentsRegEx.test(E.parentNode.nodeName)&&(Y=a.parseAttributes(E.parentNode,T,R));var J=T.reduce(function(K,ot){return(L=E.getAttribute(ot))&&(K[ot]=L),K},{}),st=u(function ht(E,T){var R={};for(var L in a.cssRules[T])if(et(E,L.split(" ")))for(var Y in a.cssRules[T][L])R[Y]=a.cssRules[T][L][Y];return R}(E,R),a.parseStyleAttribute(E));J=u(J,st),st[x]&&E.setAttribute(x,st[x]),N=q=Y.fontSize||a.Text.DEFAULT_SVG_FONT_SIZE,J[y]&&(J[y]=N=s(J[y],q));var V,F,W={};for(var G in J)F=O(V=w(G),J[G],Y,N),W[V]=F;W&&W.font&&a.parseFontDeclaration(W.font,W);var H=u(Y,W);return a.svgValidParentsRegEx.test(E.nodeName)?H:function X(E){for(var T in v)if(!(typeof E[v[T]]>"u"||""===E[T])){if(typeof E[T]>"u"){if(!a.Object.prototype[T])continue;E[T]=a.Object.prototype[T]}if(0!==E[T].indexOf("url(")){var R=new a.Color(E[T]);E[T]=R.setAlpha(n(R.getAlpha()*E[v[T]],2)).toRgba()}}return E}(H)}},parseElements:function(E,T,R,L,Y){new a.ElementsParser(E,T,R,L,Y).parse()},parseStyleAttribute:function(E){var T={},R=E.getAttribute("style");return R&&("string"==typeof R?function tt(E,T){var R,L;E.replace(/;\s*$/,"").split(";").forEach(function(Y){var N=Y.split(":");R=N[0].trim().toLowerCase(),L=N[1].trim(),T[R]=L})}(R,T):function at(E,T){for(var Y in E)typeof E[Y]>"u"||(T[Y.toLowerCase()]=E[Y])}(R,T)),T},parsePointsAttribute:function(E){if(!E)return null;var R,L,T=[];for(R=0,L=(E=(E=E.replace(/,/g," ").trim()).split(/\s+/)).length;R<L;R+=2)T.push({x:parseFloat(E[R]),y:parseFloat(E[R+1])});return T},getCSSRules:function(E){var R,L,T=E.getElementsByTagName("style"),Y={};for(R=0,L=T.length;R<L;R++){var q=T[R].textContent;""!==(q=q.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&q.split("}").filter(function(J){return J.trim()}).forEach(function(J){var st=J.split("{"),V={},W=st[1].trim().split(";").filter(function(ot){return ot.trim()});for(R=0,L=W.length;R<L;R++){var G=W[R].split(":"),H=G[0].trim(),K=G[1].trim();V[H]=K}(J=st[0].trim()).split(",").forEach(function(ot){""!==(ot=ot.replace(/^svg/i,"").trim())&&(Y[ot]?a.util.object.extend(Y[ot],V):Y[ot]=a.util.object.clone(V))})})}return Y},loadSVGFromURL:function(E,T,R,L){E=E.replace(/^\n\s*/,"").trim(),new a.util.request(E,{method:"get",onComplete:function Y(N){var q=N.responseXML;if(!q||!q.documentElement)return T&&T(null),!1;a.parseSVGDocument(q.documentElement,function(J,st,V,F){T&&T(J,st,V,F)},R,L)}})},loadSVGFromString:function(E,T,R,L){var N=(new a.window.DOMParser).parseFromString(E.trim(),"text/xml");a.parseSVGDocument(N.documentElement,function(q,J,st,V){T(q,J,st,V)},R,L)}})}(yt),_.ElementsParser=function(p,a,u,h,n,s){this.elements=p,this.callback=a,this.options=u,this.reviver=h,this.svgUid=u&&u.svgUid||0,this.parsingOptions=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},function(p){p.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},p.createObjects=function(){var a=this;this.elements.forEach(function(u,h){u.setAttribute("svgUid",a.svgUid),a.createObject(u,h)})},p.findTag=function(a){return _[_.util.string.capitalize(a.tagName.replace("svg:",""))]},p.createObject=function(a,u){var h=this.findTag(a);if(h&&h.fromElement)try{h.fromElement(a,this.createCallback(u,a),this.options)}catch(n){_.log(n)}else this.checkIfDone()},p.createCallback=function(a,u){var h=this;return function(n){var s;h.resolveGradient(n,u,"fill"),h.resolveGradient(n,u,"stroke"),n instanceof _.Image&&n._originalElement&&(s=n.parsePreserveAspectRatioAttribute(u)),n._removeTransformMatrix(s),h.resolveClipPath(n,u),h.reviver&&h.reviver(u,n),h.instances[a]=n,h.checkIfDone()}},p.extractPropertyDefinition=function(a,u,h){var n=a[u],s=this.regexUrl;if(s.test(n)){s.lastIndex=0;var i=s.exec(n)[1];return s.lastIndex=0,_[h][this.svgUid][i]}},p.resolveGradient=function(a,u,h){var n=this.extractPropertyDefinition(a,h,"gradientDefs");if(n){var s=u.getAttribute(h+"-opacity"),i=_.Gradient.fromElement(n,a,s,this.options);a.set(h,i)}},p.createClipPathCallback=function(a,u){return function(h){h._removeTransformMatrix(),h.fillRule=h.clipRule,u.push(h)}},p.resolveClipPath=function(a,u){var n,i,o,c,h=this.extractPropertyDefinition(a,"clipPath","clipPaths");if(h){o=[],i=_.util.invertTransform(a.calcTransformMatrix());for(var f=h[0].parentNode,m=u;m.parentNode&&m.getAttribute("clip-path")!==a.clipPath;)m=m.parentNode;m.parentNode.appendChild(f);for(var v=0;v<h.length;v++)this.findTag(n=h[v]).fromElement(n,this.createClipPathCallback(a,o),this.options);h=1===o.length?o[0]:new _.Group(o),c=_.util.multiplyTransformMatrices(i,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,m);var r=_.util.qrDecompose(c);h.flipX=!1,h.flipY=!1,h.set("scaleX",r.scaleX),h.set("scaleY",r.scaleY),h.angle=r.angle,h.skewX=r.skewX,h.skewY=0,h.setPositionByOrigin({x:r.translateX,y:r.translateY},"center","center"),a.clipPath=h}else delete a.clipPath},p.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances,this.elements))}}(_.ElementsParser.prototype),function(p){"use strict";var a=p.fabric||(p.fabric={});function u(h,n){this.x=h,this.y=n}a.Point?a.warn("fabric.Point is already defined"):(a.Point=u,u.prototype={type:"point",constructor:u,add:function(h){return new u(this.x+h.x,this.y+h.y)},addEquals:function(h){return this.x+=h.x,this.y+=h.y,this},scalarAdd:function(h){return new u(this.x+h,this.y+h)},scalarAddEquals:function(h){return this.x+=h,this.y+=h,this},subtract:function(h){return new u(this.x-h.x,this.y-h.y)},subtractEquals:function(h){return this.x-=h.x,this.y-=h.y,this},scalarSubtract:function(h){return new u(this.x-h,this.y-h)},scalarSubtractEquals:function(h){return this.x-=h,this.y-=h,this},multiply:function(h){return new u(this.x*h,this.y*h)},multiplyEquals:function(h){return this.x*=h,this.y*=h,this},divide:function(h){return new u(this.x/h,this.y/h)},divideEquals:function(h){return this.x/=h,this.y/=h,this},eq:function(h){return this.x===h.x&&this.y===h.y},lt:function(h){return this.x<h.x&&this.y<h.y},lte:function(h){return this.x<=h.x&&this.y<=h.y},gt:function(h){return this.x>h.x&&this.y>h.y},gte:function(h){return this.x>=h.x&&this.y>=h.y},lerp:function(h,n){return typeof n>"u"&&(n=.5),n=Math.max(Math.min(1,n),0),new u(this.x+(h.x-this.x)*n,this.y+(h.y-this.y)*n)},distanceFrom:function(h){var n=this.x-h.x,s=this.y-h.y;return Math.sqrt(n*n+s*s)},midPointFrom:function(h){return this.lerp(h)},min:function(h){return new u(Math.min(this.x,h.x),Math.min(this.y,h.y))},max:function(h){return new u(Math.max(this.x,h.x),Math.max(this.y,h.y))},toString:function(){return this.x+","+this.y},setXY:function(h,n){return this.x=h,this.y=n,this},setX:function(h){return this.x=h,this},setY:function(h){return this.y=h,this},setFromPoint:function(h){return this.x=h.x,this.y=h.y,this},swap:function(h){var n=this.x,s=this.y;this.x=h.x,this.y=h.y,h.x=n,h.y=s},clone:function(){return new u(this.x,this.y)}})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={});function u(h){this.status=h,this.points=[]}a.Intersection?a.warn("fabric.Intersection is already defined"):(a.Intersection=u,a.Intersection.prototype={constructor:u,appendPoint:function(h){return this.points.push(h),this},appendPoints:function(h){return this.points=this.points.concat(h),this}},a.Intersection.intersectLineLine=function(h,n,s,i){var o,c=(i.x-s.x)*(h.y-s.y)-(i.y-s.y)*(h.x-s.x),r=(n.x-h.x)*(h.y-s.y)-(n.y-h.y)*(h.x-s.x),f=(i.y-s.y)*(n.x-h.x)-(i.x-s.x)*(n.y-h.y);if(0!==f){var m=c/f,v=r/f;0<=m&&m<=1&&0<=v&&v<=1?(o=new u("Intersection")).appendPoint(new a.Point(h.x+m*(n.x-h.x),h.y+m*(n.y-h.y))):o=new u}else o=new u(0===c||0===r?"Coincident":"Parallel");return o},a.Intersection.intersectLinePolygon=function(h,n,s){var f,m,i=new u,o=s.length;for(m=0;m<o;m++)f=u.intersectLineLine(h,n,s[m],s[(m+1)%o]),i.appendPoints(f.points);return i.points.length>0&&(i.status="Intersection"),i},a.Intersection.intersectPolygonPolygon=function(h,n){var o,s=new u,i=h.length;for(o=0;o<i;o++){var f=u.intersectLinePolygon(h[o],h[(o+1)%i],n);s.appendPoints(f.points)}return s.points.length>0&&(s.status="Intersection"),s},a.Intersection.intersectPolygonRectangle=function(h,n,s){var i=n.min(s),o=n.max(s),c=new a.Point(o.x,i.y),r=new a.Point(i.x,o.y),f=u.intersectLinePolygon(i,c,h),m=u.intersectLinePolygon(c,o,h),v=u.intersectLinePolygon(o,r,h),y=u.intersectLinePolygon(r,i,h),x=new u;return x.appendPoints(f.points),x.appendPoints(m.points),x.appendPoints(v.points),x.appendPoints(y.points),x.points.length>0&&(x.status="Intersection"),x})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={});function u(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}function h(n,s,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+6*(s-n)*i:i<.5?s:i<2/3?n+(s-n)*(2/3-i)*6:n}a.Color?a.warn("fabric.Color is already defined."):(a.Color=u,a.Color.prototype={_tryParsingColor:function(n){var s;n in u.colorNameMap&&(n=u.colorNameMap[n]),"transparent"===n&&(s=[255,255,255,0]),s||(s=u.sourceFromHex(n)),s||(s=u.sourceFromRgb(n)),s||(s=u.sourceFromHsl(n)),s||(s=[0,0,0,1]),s&&this.setSource(s)},_rgbToHsl:function(n,s,i){var o,c,r,f=a.util.array.max([n/=255,s/=255,i/=255]),m=a.util.array.min([n,s,i]);if(r=(f+m)/2,f===m)o=c=0;else{var v=f-m;switch(c=r>.5?v/(2-f-m):v/(f+m),f){case n:o=(s-i)/v+(s<i?6:0);break;case s:o=(i-n)/v+2;break;case i:o=(n-s)/v+4}o/=6}return[Math.round(360*o),Math.round(100*c),Math.round(100*r)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),s=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+s[0]+","+s[1]+"%,"+s[2]+"%)"},toHsla:function(){var n=this.getSource(),s=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+n[3]+")"},toHex:function(){var s,i,o,n=this.getSource();return s=1===(s=n[0].toString(16)).length?"0"+s:s,i=1===(i=n[1].toString(16)).length?"0"+i:i,o=1===(o=n[2].toString(16)).length?"0"+o:o,s.toUpperCase()+i.toUpperCase()+o.toUpperCase()},toHexa:function(){var s,n=this.getSource();return s=1===(s=(s=Math.round(255*n[3])).toString(16)).length?"0"+s:s,this.toHex()+s.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var s=this.getSource();return s[3]=n,this.setSource(s),this},toGrayscale:function(){var n=this.getSource(),s=parseInt((.3*n[0]+.59*n[1]+.11*n[2]).toFixed(0),10);return this.setSource([s,s,s,n[3]]),this},toBlackWhite:function(n){var s=this.getSource(),i=(.3*s[0]+.59*s[1]+.11*s[2]).toFixed(0),o=s[3];return n=n||127,i=Number(i)<Number(n)?0:255,this.setSource([i,i,i,o]),this},overlayWith:function(n){n instanceof u||(n=new u(n));var f,s=[],i=this.getAlpha(),c=this.getSource(),r=n.getSource();for(f=0;f<3;f++)s.push(Math.round(.5*c[f]+.5*r[f]));return s[3]=i,this.setSource(s),this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,a.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,a.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},a.Color.fromRgb=function(n){return u.fromSource(u.sourceFromRgb(n))},a.Color.sourceFromRgb=function(n){var s=n.match(u.reRGBa);if(s){var i=parseInt(s[1],10)/(/%$/.test(s[1])?100:1)*(/%$/.test(s[1])?255:1),o=parseInt(s[2],10)/(/%$/.test(s[2])?100:1)*(/%$/.test(s[2])?255:1),c=parseInt(s[3],10)/(/%$/.test(s[3])?100:1)*(/%$/.test(s[3])?255:1);return[parseInt(i,10),parseInt(o,10),parseInt(c,10),s[4]?parseFloat(s[4]):1]}},a.Color.fromRgba=u.fromRgb,a.Color.fromHsl=function(n){return u.fromSource(u.sourceFromHsl(n))},a.Color.sourceFromHsl=function(n){var s=n.match(u.reHSLa);if(s){var r,f,m,i=(parseFloat(s[1])%360+360)%360/360,o=parseFloat(s[2])/(/%$/.test(s[2])?100:1),c=parseFloat(s[3])/(/%$/.test(s[3])?100:1);if(0===o)r=f=m=c;else{var v=c<=.5?c*(o+1):c+o-c*o,y=2*c-v;r=h(y,v,i+1/3),f=h(y,v,i),m=h(y,v,i-1/3)}return[Math.round(255*r),Math.round(255*f),Math.round(255*m),s[4]?parseFloat(s[4]):1]}},a.Color.fromHsla=u.fromHsl,a.Color.fromHex=function(n){return u.fromSource(u.sourceFromHex(n))},a.Color.sourceFromHex=function(n){if(n.match(u.reHex)){var s=n.slice(n.indexOf("#")+1),i=3===s.length||4===s.length,o=8===s.length||4===s.length,c=i?s.charAt(0)+s.charAt(0):s.substring(0,2),r=i?s.charAt(1)+s.charAt(1):s.substring(2,4),f=i?s.charAt(2)+s.charAt(2):s.substring(4,6),m=o?i?s.charAt(3)+s.charAt(3):s.substring(6,8):"FF";return[parseInt(c,16),parseInt(r,16),parseInt(f,16),parseFloat((parseInt(m,16)/255).toFixed(2))]}},a.Color.fromSource=function(n){var s=new u;return s.setSource(n),s})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=["e","se","s","sw","w","nw","n","ne","e"],h=["ns","nesw","ew","nwse"],n={},s="left",i="top",o="right",c="bottom",r="center",f={top:c,bottom:i,left:o,right:s,center:r},m=a.util.radiansToDegrees,v=Math.sign||function(V){return(V>0)-(V<0)||+V};function y(V,F){var W=V.angle+m(Math.atan2(F.y,F.x))+360;return Math.round(W%360/45)}function x(V,F){var W=F.transform.target,G=W.canvas,H=a.util.object.clone(F);H.target=W,G&&G.fire("object:"+V,H),W.fire(V,F)}function w(V,F){var W=F.canvas,H=V[W.uniScaleKey];return W.uniformScaling&&!H||!W.uniformScaling&&H}function O(V){return V.originX===r&&V.originY===r}function P(V,F,W){var G=V.lockScalingX,H=V.lockScalingY;return!!(G&&H||!F&&(G||H)&&W||G&&"x"===F||H&&"y"===F)}function et(V,F,W,G){return{e:V,transform:F,pointer:{x:W,y:G}}}function rt(V){return function(F,W,G,H){var K=W.target,ot=K.getCenterPoint(),bt=K.translateToOriginPoint(ot,W.originX,W.originY),mt=V(F,W,G,H);return K.setPositionByOrigin(bt,W.originX,W.originY),mt}}function ut(V,F){return function(W,G,H,K){var ot=F(W,G,H,K);return ot&&x(V,et(W,G,H,K)),ot}}function pt(V,F,W,G,H){var K=V.target,ot=K.controls[V.corner],bt=K.canvas.getZoom(),mt=K.padding/bt,z=K.toLocalPoint(new a.Point(G,H),F,W);return z.x>=mt&&(z.x-=mt),z.x<=-mt&&(z.x+=mt),z.y>=mt&&(z.y-=mt),z.y<=mt&&(z.y+=mt),z.x-=ot.offsetX,z.y-=ot.offsetY,z}function ft(V){return V.flipX!==V.flipY}function S(V,F,W,G,H){if(0!==V[F]){var K=V._getTransformedDimensions()[G];V.set(W,H/K*V[W])}}function I(V,F,W,G){var z,H=F.target,K=H._getTransformedDimensions(0,H.skewY),ot=pt(F,F.originX,F.originY,W,G),bt=Math.abs(2*ot.x)-K.x,mt=H.skewX;bt<2?z=0:(z=m(Math.atan2(bt/H.scaleX,K.y/H.scaleY)),F.originX===s&&F.originY===c&&(z=-z),F.originX===o&&F.originY===i&&(z=-z),ft(H)&&(z=-z));var gt=mt!==z;if(gt){var Ct=H._getTransformedDimensions().y;H.set("skewX",z),S(H,"skewY","scaleY","y",Ct)}return gt}function D(V,F,W,G){var z,H=F.target,K=H._getTransformedDimensions(H.skewX,0),ot=pt(F,F.originX,F.originY,W,G),bt=Math.abs(2*ot.y)-K.y,mt=H.skewY;bt<2?z=0:(z=m(Math.atan2(bt/H.scaleY,K.x/H.scaleX)),F.originX===s&&F.originY===c&&(z=-z),F.originX===o&&F.originY===i&&(z=-z),ft(H)&&(z=-z));var gt=mt!==z;if(gt){var Ct=H._getTransformedDimensions().x;H.set("skewY",z),S(H,"skewX","scaleX","x",Ct)}return gt}function T(V,F,W,G,H){var z,gt,Ct,wt,Pt,Et,K=F.target,ot=K.lockScalingX,bt=K.lockScalingY,mt=(H=H||{}).by,Mt=w(V,K),St=P(K,mt,Mt),Ht=F.gestureScale;if(St)return!1;if(Ht)gt=F.scaleX*Ht,Ct=F.scaleY*Ht;else{if(z=pt(F,F.originX,F.originY,W,G),Pt="y"!==mt?v(z.x):1,Et="x"!==mt?v(z.y):1,F.signX||(F.signX=Pt),F.signY||(F.signY=Et),K.lockScalingFlip&&(F.signX!==Pt||F.signY!==Et))return!1;if(wt=K._getTransformedDimensions(),Mt&&!mt){var $t=Math.abs(z.x)+Math.abs(z.y),Ft=F.original,Xe=$t/(Math.abs(wt.x*Ft.scaleX/K.scaleX)+Math.abs(wt.y*Ft.scaleY/K.scaleY));gt=Ft.scaleX*Xe,Ct=Ft.scaleY*Xe}else gt=Math.abs(z.x*K.scaleX/wt.x),Ct=Math.abs(z.y*K.scaleY/wt.y);O(F)&&(gt*=2,Ct*=2),F.signX!==Pt&&"y"!==mt&&(F.originX=f[F.originX],gt*=-1,F.signX=Pt),F.signY!==Et&&"x"!==mt&&(F.originY=f[F.originY],Ct*=-1,F.signY=Et)}var vi=K.scaleX,yi=K.scaleY;return mt?("x"===mt&&K.set("scaleX",gt),"y"===mt&&K.set("scaleY",Ct)):(!ot&&K.set("scaleX",gt),!bt&&K.set("scaleY",Ct)),vi!==K.scaleX||yi!==K.scaleY}n.scaleCursorStyleHandler=function X(V,F,W){var H=w(V,W),K="";if(0!==F.x&&0===F.y?K="x":0===F.x&&0!==F.y&&(K="y"),P(W,K,H))return"not-allowed";var ot=y(W,F);return u[ot]+"-resize"},n.skewCursorStyleHandler=function $(V,F,W){if(0!==F.x&&W.lockSkewingY||0!==F.y&&W.lockSkewingX)return"not-allowed";var H=y(W,F)%4;return h[H]+"-resize"},n.scaleSkewCursorStyleHandler=function tt(V,F,W){return V[W.canvas.altActionKey]?n.skewCursorStyleHandler(V,F,W):n.scaleCursorStyleHandler(V,F,W)},n.rotationWithSnapping=ut("rotating",rt(function E(V,F,W,G){var H=F,K=H.target,ot=K.translateToOriginPoint(K.getCenterPoint(),H.originX,H.originY);if(K.lockRotation)return!1;var gt,bt=Math.atan2(H.ey-ot.y,H.ex-ot.x),mt=Math.atan2(G-ot.y,W-ot.x),z=m(mt-bt+H.theta);if(K.snapAngle>0){var Ct=K.snapAngle,wt=K.snapThreshold||Ct,Mt=Math.ceil(z/Ct)*Ct,St=Math.floor(z/Ct)*Ct;Math.abs(z-St)<wt?z=St:Math.abs(z-Mt)<wt&&(z=Mt)}return z<0&&(z=360+z),gt=K.angle!==(z%=360),K.angle=z,gt})),n.scalingEqually=ut("scaling",rt(function R(V,F,W,G){return T(V,F,W,G)})),n.scalingX=ut("scaling",rt(function L(V,F,W,G){return T(V,F,W,G,{by:"x"})})),n.scalingY=ut("scaling",rt(function Y(V,F,W,G){return T(V,F,W,G,{by:"y"})})),n.scalingYOrSkewingX=function N(V,F,W,G){return V[F.target.canvas.altActionKey]?n.skewHandlerX(V,F,W,G):n.scalingY(V,F,W,G)},n.scalingXOrSkewingY=function q(V,F,W,G){return V[F.target.canvas.altActionKey]?n.skewHandlerY(V,F,W,G):n.scalingX(V,F,W,G)},n.changeWidth=ut("resizing",rt(function J(V,F,W,G){var H=F.target,K=pt(F,F.originX,F.originY,W,G),ot=H.strokeWidth/(H.strokeUniform?H.scaleX:1),bt=O(F)?2:1,mt=H.width,z=Math.abs(K.x*bt/H.scaleX)-ot;return H.set("width",Math.max(z,0)),mt!==z})),n.skewHandlerX=function k(V,F,W,G){var ot,H=F.target,K=H.skewX,bt=F.originY;return!H.lockSkewingX&&(0===K?ot=pt(F,r,r,W,G).x>0?s:o:(K>0&&(ot=bt===i?s:o),K<0&&(ot=bt===i?o:s),ft(H)&&(ot=ot===s?o:s)),F.originX=ot,ut("skewing",rt(I))(V,F,W,G))},n.skewHandlerY=function j(V,F,W,G){var ot,H=F.target,K=H.skewY,bt=F.originX;return!H.lockSkewingY&&(0===K?ot=pt(F,r,r,W,G).y>0?i:c:(K>0&&(ot=bt===s?i:c),K<0&&(ot=bt===s?c:i),ft(H)&&(ot=ot===i?c:i)),F.originY=ot,ut("skewing",rt(D))(V,F,W,G))},n.dragHandler=function st(V,F,W,G){var H=F.target,K=W-F.offsetX,ot=G-F.offsetY,bt=!H.get("lockMovementX")&&H.left!==K,mt=!H.get("lockMovementY")&&H.top!==ot;return bt&&H.set("left",K),mt&&H.set("top",ot),(bt||mt)&&x("moving",et(V,F,W,G)),bt||mt},n.scaleOrSkewActionName=function at(V,F,W){var G=V[W.canvas.altActionKey];return 0===F.x?G?"skewX":"scaleY":0===F.y?G?"skewY":"scaleX":void 0},n.rotationStyleHandler=function ht(V,F,W){return W.lockRotation?"not-allowed":F.cursorStyle},n.fireEvent=x,n.wrapWithFixedAnchor=rt,n.wrapWithFireEvent=ut,n.getLocalPoint=pt,a.controlsUtils=n}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.degreesToRadians,h=a.controlsUtils;h.renderCircleControl=function n(i,o,c,r,f){r=r||{};var X,m=this.sizeX||r.cornerSize||f.cornerSize,v=this.sizeY||r.cornerSize||f.cornerSize,y=typeof r.transparentCorners<"u"?r.transparentCorners:f.transparentCorners,x=y?"stroke":"fill",w=!y&&(r.cornerStrokeColor||f.cornerStrokeColor),O=o,P=c;i.save(),i.fillStyle=r.cornerColor||f.cornerColor,i.strokeStyle=r.cornerStrokeColor||f.cornerStrokeColor,m>v?(X=m,i.scale(1,v/m),P=c*m/v):v>m?(X=v,i.scale(m/v,1),O=o*v/m):X=m,i.lineWidth=1,i.beginPath(),i.arc(O,P,X/2,0,2*Math.PI,!1),i[x](),w&&i.stroke(),i.restore()},h.renderSquareControl=function s(i,o,c,r,f){r=r||{};var m=this.sizeX||r.cornerSize||f.cornerSize,v=this.sizeY||r.cornerSize||f.cornerSize,y=typeof r.transparentCorners<"u"?r.transparentCorners:f.transparentCorners,x=y?"stroke":"fill",w=!y&&(r.cornerStrokeColor||f.cornerStrokeColor),O=m/2,P=v/2;i.save(),i.fillStyle=r.cornerColor||f.cornerColor,i.strokeStyle=r.cornerStrokeColor||f.cornerStrokeColor,i.lineWidth=1,i.translate(o,c),i.rotate(u(f.angle)),i[x+"Rect"](-O,-P,m,v),w&&i.strokeRect(-O,-P,m,v),i.restore()}}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={});a.Control=function u(h){for(var n in h)this[n]=h[n]},a.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(h,n){return n.cursorStyle},getActionName:function(h,n){return n.actionName},getVisibility:function(h,n){var s=h._controlsVisibility;return s&&typeof s[n]<"u"?s[n]:this.visible},setVisibility:function(h){this.visible=h},positionHandler:function(h,n){return a.util.transformPoint({x:this.x*h.x+this.offsetX,y:this.y*h.y+this.offsetY},n)},calcCornerCoords:function(h,n,s,i,o){var c,r,f,m,v=o?this.touchSizeX:this.sizeX,y=o?this.touchSizeY:this.sizeY;if(v&&y&&v!==y){var x=Math.atan2(y,v),w=Math.sqrt(v*v+y*y)/2,O=x-a.util.degreesToRadians(h),P=Math.PI/2-x-a.util.degreesToRadians(h);c=w*a.util.cos(O),r=w*a.util.sin(O),f=w*a.util.cos(P),m=w*a.util.sin(P)}else w=.7071067812*(v&&y?v:n),O=a.util.degreesToRadians(45-h),c=f=w*a.util.cos(O),r=m=w*a.util.sin(O);return{tl:{x:s-m,y:i-f},tr:{x:s+c,y:i-r},bl:{x:s-c,y:i+r},br:{x:s+m,y:i+f}}},render:function(h,n,s,i,o){"circle"===((i=i||{}).cornerStyle||o.cornerStyle)?a.controlsUtils.renderCircleControl.call(this,h,n,s,i,o):a.controlsUtils.renderSquareControl.call(this,h,n,s,i,o)}}}(yt),function(){function p(s,i){var r,f,m,v,o=s.getAttribute("style"),c=s.getAttribute("offset")||0;if(c=(c=parseFloat(c)/(/%$/.test(c)?100:1))<0?0:c>1?1:c,o){var y=o.split(/\s*;\s*/);for(""===y[y.length-1]&&y.pop(),v=y.length;v--;){var x=y[v].split(/\s*:\s*/),w=x[0].trim(),O=x[1].trim();"stop-color"===w?r=O:"stop-opacity"===w&&(m=O)}}return r||(r=s.getAttribute("stop-color")||"rgb(0,0,0)"),m||(m=s.getAttribute("stop-opacity")),f=(r=new _.Color(r)).getAlpha(),m=isNaN(parseFloat(m))?1:parseFloat(m),m*=f*i,{offset:c,color:r.toRgb(),opacity:m}}var h=_.util.object.clone;_.Gradient=_.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(s){s||(s={}),s.coords||(s.coords={});var i,o=this;Object.keys(s).forEach(function(c){o[c]=s[c]}),this.id?this.id+="_"+_.Object.__uid++:this.id=_.Object.__uid++,i={x1:s.coords.x1||0,y1:s.coords.y1||0,x2:s.coords.x2||0,y2:s.coords.y2||0},"radial"===this.type&&(i.r1=s.coords.r1||0,i.r2=s.coords.r2||0),this.coords=i,this.colorStops=s.colorStops.slice()},addColorStop:function(s){for(var i in s){var o=new _.Color(s[i]);this.colorStops.push({offset:parseFloat(i),color:o.toRgb(),opacity:o.getAlpha()})}return this},toObject:function(s){var i={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return _.util.populateWithProperties(this,i,s),i},toSVG:function(s,f){var c,r,m,v,o=h(this.coords,!0),y=(f=f||{},h(this.colorStops,!0)),x=o.r1>o.r2,w=this.gradientTransform?this.gradientTransform.concat():_.iMatrix.concat(),O=-this.offsetX,P=-this.offsetY,X=!!f.additionalTransform,$="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(y.sort(function(rt,ut){return rt.offset-ut.offset}),"objectBoundingBox"===$?(O/=s.width,P/=s.height):(O+=s.width/2,P+=s.height/2),"path"===s.type&&"percentage"!==this.gradientUnits&&(O-=s.pathOffset.x,P-=s.pathOffset.y),w[4]-=O,w[5]-=P,v='id="SVGID_'+this.id+'" gradientUnits="'+$+'"',v+=' gradientTransform="'+(X?f.additionalTransform+" ":"")+_.util.matrixToSVG(w)+'" ',"linear"===this.type?m=["<linearGradient ",v,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,'">\n']:"radial"===this.type&&(m=["<radialGradient ",v,' cx="',x?o.x1:o.x2,'" cy="',x?o.y1:o.y2,'" r="',x?o.r1:o.r2,'" fx="',x?o.x2:o.x1,'" fy="',x?o.y2:o.y1,'">\n']),"radial"===this.type){if(x)for((y=y.concat()).reverse(),c=0,r=y.length;c<r;c++)y[c].offset=1-y[c].offset;var tt=Math.min(o.r1,o.r2);if(tt>0){var ht=tt/Math.max(o.r1,o.r2);for(c=0,r=y.length;c<r;c++)y[c].offset+=ht*(1-y[c].offset)}}for(c=0,r=y.length;c<r;c++){var et=y[c];m.push("<stop ",'offset="',100*et.offset+"%",'" style="stop-color:',et.color,typeof et.opacity<"u"?";stop-opacity: "+et.opacity:";",'"/>\n')}return m.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),m.join("")},toLive:function(s){var i,c,r,o=_.util.object.clone(this.coords);if(this.type){for("linear"===this.type?i=s.createLinearGradient(o.x1,o.y1,o.x2,o.y2):"radial"===this.type&&(i=s.createRadialGradient(o.x1,o.y1,o.r1,o.x2,o.y2,o.r2)),c=0,r=this.colorStops.length;c<r;c++){var f=this.colorStops[c].color,m=this.colorStops[c].opacity,v=this.colorStops[c].offset;typeof m<"u"&&(f=new _.Color(f).setAlpha(m).toRgba()),i.addColorStop(v,f)}return i}}}),_.util.object.extend(_.Gradient,{fromElement:function(s,i,o,c){var r=parseFloat(o)/(/%$/.test(o)?100:1);r=r<0?0:r>1?1:r,isNaN(r)&&(r=1);var m,w,O,$,f=s.getElementsByTagName("stop"),v="userSpaceOnUse"===s.getAttribute("gradientUnits")?"pixels":"percentage",y=s.getAttribute("gradientTransform")||"",x=[],P=0,X=0;for("linearGradient"===s.nodeName||"LINEARGRADIENT"===s.nodeName?(m="linear",w=function a(s){return{x1:s.getAttribute("x1")||0,y1:s.getAttribute("y1")||0,x2:s.getAttribute("x2")||"100%",y2:s.getAttribute("y2")||0}}(s)):(m="radial",w=function u(s){return{x1:s.getAttribute("fx")||s.getAttribute("cx")||"50%",y1:s.getAttribute("fy")||s.getAttribute("cy")||"50%",r1:0,x2:s.getAttribute("cx")||"50%",y2:s.getAttribute("cy")||"50%",r2:s.getAttribute("r")||"50%"}}(s)),O=f.length;O--;)x.push(p(f[O],r));return $=_.parseTransformAttribute(y),function n(s,i,o,c){var r,f;Object.keys(i).forEach(function(m){"Infinity"===(r=i[m])?f=1:"-Infinity"===r?f=0:(f=parseFloat(i[m],10),"string"==typeof r&&/^(\d+\.\d+)%|(\d+)%$/.test(r)&&(f*=.01,"pixels"===c&&(("x1"===m||"x2"===m||"r2"===m)&&(f*=o.viewBoxWidth||o.width),("y1"===m||"y2"===m)&&(f*=o.viewBoxHeight||o.height)))),i[m]=f})}(0,w,c,v),"pixels"===v&&(P=-i.left,X=-i.top),new _.Gradient({id:s.getAttribute("id"),type:m,coords:w,colorStops:x,gradientUnits:v,gradientTransform:$,offsetX:P,offsetY:X})}})}(),function(){"use strict";var p=_.util.toFixed;_.Pattern=_.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(a,u){if(a||(a={}),this.id=_.Object.__uid++,this.setOptions(a),!a.source||a.source&&"string"!=typeof a.source)u&&u(this);else{var h=this;this.source=_.util.createImage(),_.util.loadImage(a.source,function(n,s){h.source=n,u&&u(h,s)},null,this.crossOrigin)}},toObject:function(a){var h,n,u=_.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?h=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(h=this.source.toDataURL()),n={type:"pattern",source:h,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:p(this.offsetX,u),offsetY:p(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},_.util.populateWithProperties(this,n,a),n},toSVG:function(a){var u="function"==typeof this.source?this.source():this.source,h=u.width/a.width,n=u.height/a.height,s=this.offsetX/a.width,i=this.offsetY/a.height,o="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(n=1,i&&(n+=Math.abs(i))),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(h=1,s&&(h+=Math.abs(s))),u.src?o=u.src:u.toDataURL&&(o=u.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+s+'" y="'+i+'" width="'+h+'" height="'+n+'">\n<image x="0" y="0" width="'+u.width+'" height="'+u.height+'" xlink:href="'+o+'"></image>\n</pattern>\n'},setOptions:function(a){for(var u in a)this[u]=a[u]},toLive:function(a){var u=this.source;return!u||typeof u.src<"u"&&(!u.complete||0===u.naturalWidth||0===u.naturalHeight)?"":a.createPattern(u,this.repeat)}})}(),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.toFixed;a.Shadow?a.warn("fabric.Shadow is already defined."):(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(h){for(var n in"string"==typeof h&&(h=this._parseShadow(h)),h)this[n]=h[n];this.id=a.Object.__uid++},_parseShadow:function(h){var n=h.trim(),s=a.Shadow.reOffsetsAndBlur.exec(n)||[];return{color:(n.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(s[1],10)||0,offsetY:parseFloat(s[2],10)||0,blur:parseFloat(s[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(h){var n=40,s=40,i=a.Object.NUM_FRACTION_DIGITS,o=a.util.rotateVector({x:this.offsetX,y:this.offsetY},a.util.degreesToRadians(-h.angle)),r=new a.Color(this.color);return h.width&&h.height&&(n=100*u((Math.abs(o.x)+this.blur)/h.width,i)+20,s=100*u((Math.abs(o.y)+this.blur)/h.height,i)+20),h.flipX&&(o.x*=-1),h.flipY&&(o.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+u(this.blur?this.blur/2:0,i)+'"></feGaussianBlur>\n\t<feOffset dx="'+u(o.x,i)+'" dy="'+u(o.y,i)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+r.toRgb()+'" flood-opacity="'+r.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var h={},n=a.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(s){this[s]!==n[s]&&(h[s]=this[s])},this),h}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(yt),function(){"use strict";if(_.StaticCanvas)_.warn("fabric.StaticCanvas is already defined.");else{var p=_.util.object.extend,a=_.util.getElementOffset,u=_.util.removeFromArray,h=_.util.toFixed,n=_.util.transformPoint,s=_.util.invertTransform,i=_.util.getNodeCanvas,o=_.util.createCanvasElement,c=new Error("Could not initialize `canvas` element");_.StaticCanvas=_.util.createClass(_.CommonMethods,{initialize:function(r,f){f||(f={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,f)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:_.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(r,f){var m=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(r),this._initOptions(f),this.interactive||this._initRetinaScaling(),f.overlayImage&&this.setOverlayImage(f.overlayImage,m),f.backgroundImage&&this.setBackgroundImage(f.backgroundImage,m),f.backgroundColor&&this.setBackgroundColor(f.backgroundColor,m),f.overlayColor&&this.setOverlayColor(f.overlayColor,m),this.calcOffset()},_isRetinaScaling:function(){return _.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,_.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var r=_.devicePixelRatio;this.__initRetinaScaling(r,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(r,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(r,f,m){f.setAttribute("width",this.width*r),f.setAttribute("height",this.height*r),m.scale(r,r)},calcOffset:function(){return this._offset=a(this.lowerCanvasEl),this},setOverlayImage:function(r,f,m){return this.__setBgOverlayImage("overlayImage",r,f,m)},setBackgroundImage:function(r,f,m){return this.__setBgOverlayImage("backgroundImage",r,f,m)},setOverlayColor:function(r,f){return this.__setBgOverlayColor("overlayColor",r,f)},setBackgroundColor:function(r,f){return this.__setBgOverlayColor("backgroundColor",r,f)},__setBgOverlayImage:function(r,f,m,v){return"string"==typeof f?_.util.loadImage(f,function(y,x){if(y){var w=new _.Image(y,v);this[r]=w,w.canvas=this}m&&m(y,x)},this,v&&v.crossOrigin):(v&&f.setOptions(v),this[r]=f,f&&(f.canvas=this),m&&m(f,!1)),this},__setBgOverlayColor:function(r,f,m){return this[r]=f,this._initGradient(f,r),this._initPattern(f,r,m),this},_createCanvasElement:function(){var r=o();if(!r||(r.style||(r.style={}),typeof r.getContext>"u"))throw c;return r},_initOptions:function(r){var f=this.lowerCanvasEl;this._setOptions(r),this.width=this.width||parseInt(f.width,10)||0,this.height=this.height||parseInt(f.height,10)||0,this.lowerCanvasEl.style&&(f.width=this.width,f.height=this.height,f.style.width=this.width+"px",f.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(r){this.lowerCanvasEl=r&&r.getContext?r:_.util.getById(r)||this._createCanvasElement(),_.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(r,f){return this.setDimensions({width:r},f)},setHeight:function(r,f){return this.setDimensions({height:r},f)},setDimensions:function(r,f){var m;for(var v in f=f||{},r)m=r[v],f.cssOnly||(this._setBackstoreDimension(v,r[v]),m+="px",this.hasLostContext=!0),f.backstoreOnly||this._setCssDimension(v,m);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),f.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(r,f){return this.lowerCanvasEl[r]=f,this.upperCanvasEl&&(this.upperCanvasEl[r]=f),this.cacheCanvasEl&&(this.cacheCanvasEl[r]=f),this[r]=f,this},_setCssDimension:function(r,f){return this.lowerCanvasEl.style[r]=f,this.upperCanvasEl&&(this.upperCanvasEl.style[r]=f),this.wrapperEl&&(this.wrapperEl.style[r]=f),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(r){var y,x,w,f=this._activeObject,m=this.backgroundImage,v=this.overlayImage;for(this.viewportTransform=r,x=0,w=this._objects.length;x<w;x++)(y=this._objects[x]).group||y.setCoords(!0);return f&&f.setCoords(),m&&m.setCoords(!0),v&&v.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(r,f){var m=r,v=this.viewportTransform.slice(0);r=n(r,s(this.viewportTransform)),v[0]=f,v[3]=f;var y=n(r,v);return v[4]+=m.x-y.x,v[5]+=m.y-y.y,this.setViewportTransform(v)},setZoom:function(r){return this.zoomToPoint(new _.Point(0,0),r),this},absolutePan:function(r){var f=this.viewportTransform.slice(0);return f[4]=-r.x,f[5]=-r.y,this.setViewportTransform(f)},relativePan:function(r){return this.absolutePan(new _.Point(-r.x-this.viewportTransform[4],-r.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(r){this.stateful&&r.setupState(),r._set("canvas",this),r.setCoords(),this.fire("object:added",{target:r}),r.fire("added")},_onObjectRemoved:function(r){this.fire("object:removed",{target:r}),r.fire("removed"),delete r.canvas},clearContext:function(r){return r.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=_.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var r={},f=this.width,m=this.height,v=s(this.viewportTransform);return r.tl=n({x:0,y:0},v),r.br=n({x:f,y:m},v),r.tr=new _.Point(r.br.x,r.tl.y),r.bl=new _.Point(r.tl.x,r.br.y),this.vptCoords=r,r},cancelRequestedRender:function(){this.isRendering&&(_.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(r,f){var m=this.viewportTransform,v=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(r),_.util.setImageSmoothing(r,this.imageSmoothingEnabled),this.fire("before:render",{ctx:r}),this._renderBackground(r),r.save(),r.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._renderObjects(r,f),r.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(r),v&&(v.canvas=this,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(r)),this._renderOverlay(r),this.controlsAboveOverlay&&this.interactive&&this.drawControls(r),this.fire("after:render",{ctx:r})},drawClipPathOnCanvas:function(r){var f=this.viewportTransform,m=this.clipPath;r.save(),r.transform(f[0],f[1],f[2],f[3],f[4],f[5]),r.globalCompositeOperation="destination-in",m.transform(r),r.scale(1/m.zoomX,1/m.zoomY),r.drawImage(m._cacheCanvas,-m.cacheTranslationX,-m.cacheTranslationY),r.restore()},_renderObjects:function(r,f){var m,v;for(m=0,v=f.length;m<v;++m)f[m]&&f[m].render(r)},_renderBackgroundOrOverlay:function(r,f){var m=this[f+"Color"],v=this[f+"Image"],y=this.viewportTransform,x=this[f+"Vpt"];if(m||v){if(m){r.save(),r.beginPath(),r.moveTo(0,0),r.lineTo(this.width,0),r.lineTo(this.width,this.height),r.lineTo(0,this.height),r.closePath(),r.fillStyle=m.toLive?m.toLive(r,this):m,x&&r.transform(y[0],y[1],y[2],y[3],y[4],y[5]),r.transform(1,0,0,1,m.offsetX||0,m.offsetY||0);var w=m.gradientTransform||m.patternTransform;w&&r.transform(w[0],w[1],w[2],w[3],w[4],w[5]),r.fill(),r.restore()}v&&(r.save(),x&&r.transform(y[0],y[1],y[2],y[3],y[4],y[5]),v.render(r),r.restore())}},_renderBackground:function(r){this._renderBackgroundOrOverlay(r,"background")},_renderOverlay:function(r){this._renderBackgroundOrOverlay(r,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new _.Point(this.width/2,this.height/2)},centerObjectH:function(r){return this._centerObject(r,new _.Point(this.getCenterPoint().x,r.getCenterPoint().y))},centerObjectV:function(r){return this._centerObject(r,new _.Point(r.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(r){var f=this.getCenterPoint();return this._centerObject(r,f)},viewportCenterObject:function(r){var f=this.getVpCenter();return this._centerObject(r,f)},viewportCenterObjectH:function(r){var f=this.getVpCenter();return this._centerObject(r,new _.Point(f.x,r.getCenterPoint().y)),this},viewportCenterObjectV:function(r){var f=this.getVpCenter();return this._centerObject(r,new _.Point(r.getCenterPoint().x,f.y))},getVpCenter:function(){var r=this.getCenterPoint(),f=s(this.viewportTransform);return n(r,f)},_centerObject:function(r,f){return r.setPositionByOrigin(f,"center","center"),r.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(r){return this.toDatalessObject(r)},toObject:function(r){return this._toObjectMethod("toObject",r)},toDatalessObject:function(r){return this._toObjectMethod("toDatalessObject",r)},_toObjectMethod:function(r,f){var m=this.clipPath,v={version:_.version,objects:this._toObjects(r,f)};return m&&!m.excludeFromExport&&(v.clipPath=this._toObject(this.clipPath,r,f)),p(v,this.__serializeBgOverlay(r,f)),_.util.populateWithProperties(this,v,f),v},_toObjects:function(r,f){return this._objects.filter(function(m){return!m.excludeFromExport}).map(function(m){return this._toObject(m,r,f)},this)},_toObject:function(r,f,m){var v;this.includeDefaultValues||(v=r.includeDefaultValues,r.includeDefaultValues=!1);var y=r[f](m);return this.includeDefaultValues||(r.includeDefaultValues=v),y},__serializeBgOverlay:function(r,f){var m={},v=this.backgroundImage,y=this.overlayImage,x=this.backgroundColor,w=this.overlayColor;return x&&x.toObject?x.excludeFromExport||(m.background=x.toObject(f)):x&&(m.background=x),w&&w.toObject?w.excludeFromExport||(m.overlay=w.toObject(f)):w&&(m.overlay=w),v&&!v.excludeFromExport&&(m.backgroundImage=this._toObject(v,r,f)),y&&!y.excludeFromExport&&(m.overlayImage=this._toObject(y,r,f)),m},svgViewportTransformation:!0,toSVG:function(r,f){r||(r={}),r.reviver=f;var m=[];return this._setSVGPreamble(m,r),this._setSVGHeader(m,r),this.clipPath&&m.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(m,"background"),this._setSVGBgOverlayImage(m,"backgroundImage",f),this._setSVGObjects(m,f),this.clipPath&&m.push("</g>\n"),this._setSVGBgOverlayColor(m,"overlay"),this._setSVGBgOverlayImage(m,"overlayImage",f),m.push("</svg>"),m.join("")},_setSVGPreamble:function(r,f){f.suppressPreamble||r.push('<?xml version="1.0" encoding="',f.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(r,f){var y,m=f.width||this.width,v=f.height||this.height,x='viewBox="0 0 '+this.width+" "+this.height+'" ',w=_.Object.NUM_FRACTION_DIGITS;f.viewBox?x='viewBox="'+f.viewBox.x+" "+f.viewBox.y+" "+f.viewBox.width+" "+f.viewBox.height+'" ':this.svgViewportTransformation&&(x='viewBox="'+h(-(y=this.viewportTransform)[4]/y[0],w)+" "+h(-y[5]/y[3],w)+" "+h(this.width/y[0],w)+" "+h(this.height/y[3],w)+'" '),r.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',m,'" ','height="',v,'" ',x,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",_.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(f),"</defs>\n")},createSVGClipPathMarkup:function(r){var f=this.clipPath;return f?(f.clipPathId="CLIPPATH_"+_.Object.__uid++,'<clipPath id="'+f.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(r.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var r=this;return["background","overlay"].map(function(m){var v=r[m+"Color"];if(v&&v.toLive){var y=r[m+"Vpt"],x=r.viewportTransform;return v.toSVG({width:r.width/(y?x[0]:1),height:r.height/(y?x[3]:1)},{additionalTransform:y?_.util.matrixToSVG(x):""})}}).join("")},createSVGFontFacesMarkup:function(){var m,v,y,x,w,P,X,$,r="",f={},tt=_.fontPaths,at=[];for(this._objects.forEach(function et(rt){at.push(rt),rt._objects&&rt._objects.forEach(et)}),X=0,$=at.length;X<$;X++)if(v=(m=at[X]).fontFamily,-1!==m.type.indexOf("text")&&!f[v]&&tt[v]&&(f[v]=!0,m.styles))for(w in y=m.styles)for(P in x=y[w])!f[v=x[P].fontFamily]&&tt[v]&&(f[v]=!0);for(var ht in f)r+=["\t\t@font-face {\n","\t\t\tfont-family: '",ht,"';\n","\t\t\tsrc: url('",tt[ht],"');\n","\t\t}\n"].join("");return r&&(r=['\t<style type="text/css">',"<![CDATA[\n",r,"]]>","</style>\n"].join("")),r},_setSVGObjects:function(r,f){var m,v,y,x=this._objects;for(v=0,y=x.length;v<y;v++)!(m=x[v]).excludeFromExport&&this._setSVGObject(r,m,f)},_setSVGObject:function(r,f,m){r.push(f.toSVG(m))},_setSVGBgOverlayImage:function(r,f,m){this[f]&&!this[f].excludeFromExport&&this[f].toSVG&&r.push(this[f].toSVG(m))},_setSVGBgOverlayColor:function(r,f){var m=this[f+"Color"],y=this.width,x=this.height;if(m)if(m.toLive){var w=m.repeat,O=_.util.invertTransform(this.viewportTransform),X=this[f+"Vpt"]?_.util.matrixToSVG(O):"";r.push('<rect transform="'+X+" translate(",y/2,",",x/2,')"',' x="',m.offsetX-y/2,'" y="',m.offsetY-x/2,'" ','width="',"repeat-y"===w||"no-repeat"===w?m.source.width:y,'" height="',"repeat-x"===w||"no-repeat"===w?m.source.height:x,'" fill="url(#SVGID_'+m.id+')"',"></rect>\n")}else r.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',m,'"',"></rect>\n")},sendToBack:function(r){if(!r)return this;var m,v,y,f=this._activeObject;if(r===f&&"activeSelection"===r.type)for(m=(y=f._objects).length;m--;)u(this._objects,v=y[m]),this._objects.unshift(v);else u(this._objects,r),this._objects.unshift(r);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(r){if(!r)return this;var m,v,y,f=this._activeObject;if(r===f&&"activeSelection"===r.type)for(y=f._objects,m=0;m<y.length;m++)u(this._objects,v=y[m]),this._objects.push(v);else u(this._objects,r),this._objects.push(r);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(r,f){if(!r)return this;var v,y,x,w,O,m=this._activeObject,P=0;if(r===m&&"activeSelection"===r.type)for(O=m._objects,v=0;v<O.length;v++)(x=this._objects.indexOf(y=O[v]))>0+P&&(w=x-1,u(this._objects,y),this._objects.splice(w,0,y)),P++;else 0!==(x=this._objects.indexOf(r))&&(w=this._findNewLowerIndex(r,x,f),u(this._objects,r),this._objects.splice(w,0,r));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(r,f,m){var v,y;if(m){for(v=f,y=f-1;y>=0;--y)if(r.intersectsWithObject(this._objects[y])||r.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(r)){v=y;break}}else v=f-1;return v},bringForward:function(r,f){if(!r)return this;var v,y,x,w,O,m=this._activeObject,P=0;if(r===m&&"activeSelection"===r.type)for(v=(O=m._objects).length;v--;)(x=this._objects.indexOf(y=O[v]))<this._objects.length-1-P&&(w=x+1,u(this._objects,y),this._objects.splice(w,0,y)),P++;else(x=this._objects.indexOf(r))!==this._objects.length-1&&(w=this._findNewUpperIndex(r,x,f),u(this._objects,r),this._objects.splice(w,0,r));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(r,f,m){var v,y,x;if(m){for(v=f,y=f+1,x=this._objects.length;y<x;++y)if(r.intersectsWithObject(this._objects[y])||r.isContainedWithinObject(this._objects[y])||this._objects[y].isContainedWithinObject(r)){v=y;break}}else v=f+1;return v},moveTo:function(r,f){return u(this._objects,r),this._objects.splice(f,0,r),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(_.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),_.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),_.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),p(_.StaticCanvas.prototype,_.Observable),p(_.StaticCanvas.prototype,_.Collection),p(_.StaticCanvas.prototype,_.DataURLExporter),p(_.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(r){var f=o();if(!f||!f.getContext)return null;var m=f.getContext("2d");return m&&"setLineDash"===r?typeof m.setLineDash<"u":null}}),_.StaticCanvas.prototype.toJSON=_.StaticCanvas.prototype.toObject,_.isLikelyNode&&(_.StaticCanvas.prototype.createPNGStream=function(){var r=i(this.lowerCanvasEl);return r&&r.createPNGStream()},_.StaticCanvas.prototype.createJPEGStream=function(r){var f=i(this.lowerCanvasEl);return f&&f.createJPEGStream(r)})}}(),_.BaseBrush=_.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(p){p.strokeStyle=this.color,p.lineWidth=this.width,p.lineCap=this.strokeLineCap,p.miterLimit=this.strokeMiterLimit,p.lineJoin=this.strokeLineJoin,p.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(p){var a=this.canvas.viewportTransform;p.save(),p.transform(a[0],a[1],a[2],a[3],a[4],a[5])},_setShadow:function(){if(this.shadow){var p=this.canvas,a=this.shadow,u=p.contextTop,h=p.getZoom();p&&p._isRetinaScaling()&&(h*=_.devicePixelRatio),u.shadowColor=a.color,u.shadowBlur=a.blur*h,u.shadowOffsetX=a.offsetX*h,u.shadowOffsetY=a.offsetY*h}},needsFullRender:function(){return new _.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var p=this.canvas.contextTop;p.shadowColor="",p.shadowBlur=p.shadowOffsetX=p.shadowOffsetY=0},_isOutSideCanvas:function(p){return p.x<0||p.x>this.canvas.getWidth()||p.y<0||p.y>this.canvas.getHeight()}}),_.PencilBrush=_.util.createClass(_.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(p){this.canvas=p,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(p,a,u){var h=a.midPointFrom(u);return p.quadraticCurveTo(a.x,a.y,h.x,h.y),h},onMouseDown:function(p,a){!this.canvas._isMainEvent(a.e)||(this.drawStraightLine=a.e[this.straightLineKey],this._prepareForDrawing(p),this._captureDrawingPath(p),this._render())},onMouseMove:function(p,a){if(this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(p))&&this._captureDrawingPath(p)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var u=this._points,h=u.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,u[h-2],u[h-1],!0),n.stroke(),n.restore()}},onMouseUp:function(p){return!this.canvas._isMainEvent(p.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(p){var a=new _.Point(p.x,p.y);this._reset(),this._addPoint(a),this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(p){return!(this._points.length>1&&p.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(p),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(p){var a=new _.Point(p.x,p.y);return this._addPoint(a)},_render:function(p){var a,u,h=this._points[0],n=this._points[1];if(this._saveAndTransform(p=p||this.canvas.contextTop),p.beginPath(),2===this._points.length&&h.x===n.x&&h.y===n.y){var s=this.width/1e3;h=new _.Point(h.x,h.y),n=new _.Point(n.x,n.y),h.x-=s,n.x+=s}for(p.moveTo(h.x,h.y),a=1,u=this._points.length;a<u;a++)this._drawSegment(p,h,n),h=this._points[a],n=this._points[a+1];p.lineTo(h.x,h.y),p.stroke(),p.restore()},convertPointsToSVGPath:function(p){return _.util.getSmoothPathFromPoints(p,this.width/1e3)},_isEmptySVGPath:function(p){return"M 0 0 Q 0 0 0 0 L 0 0"===_.util.joinPath(p)},createPath:function(p){var a=new _.Path(p,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,a.shadow=new _.Shadow(this.shadow)),a},decimatePoints:function(p,a){if(p.length<=2)return p;var n,u=this.canvas.getZoom(),h=Math.pow(a/u,2),s=p.length-1,i=p[0],o=[i];for(n=1;n<s-1;n++)Math.pow(i.x-p[n].x,2)+Math.pow(i.y-p[n].y,2)>=h&&o.push(i=p[n]);return o.push(p[s]),o},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var a=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(a))this.canvas.requestRenderAll();else{var u=this.createPath(a);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.requestRenderAll(),u.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:u})}}}),_.CircleBrush=_.util.createClass(_.BaseBrush,{width:10,initialize:function(p){this.canvas=p,this.points=[]},drawDot:function(p){var a=this.addPoint(p),u=this.canvas.contextTop;this._saveAndTransform(u),this.dot(u,a),u.restore()},dot:function(p,a){p.fillStyle=a.fill,p.beginPath(),p.arc(a.x,a.y,a.radius,0,2*Math.PI,!1),p.closePath(),p.fill()},onMouseDown:function(p){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(p)},_render:function(){var a,u,p=this.canvas.contextTop,h=this.points;for(this._saveAndTransform(p),a=0,u=h.length;a<u;a++)this.dot(p,h[a]);p.restore()},onMouseMove:function(p){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(p)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(p),this._render()):this.drawDot(p))},onMouseUp:function(){var a,u,p=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var h=[];for(a=0,u=this.points.length;a<u;a++){var n=this.points[a],s=new _.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&(s.shadow=new _.Shadow(this.shadow)),h.push(s)}var i=new _.Group(h);i.canvas=this.canvas,this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=p,this.canvas.requestRenderAll()},addPoint:function(p){var a=new _.Point(p.x,p.y),u=_.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,h=new _.Color(this.color).setAlpha(_.util.getRandomInt(0,100)/100).toRgba();return a.radius=u,a.fill=h,this.points.push(a),a}}),_.SprayBrush=_.util.createClass(_.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(p){this.canvas=p,this.sprayChunks=[]},onMouseDown:function(p){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(p),this.render(this.sprayChunkPoints)},onMouseMove:function(p){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(p)||(this.addSprayChunk(p),this.render(this.sprayChunkPoints))},onMouseUp:function(){var p=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],u=0,h=this.sprayChunks.length;u<h;u++)for(var n=this.sprayChunks[u],s=0,i=n.length;s<i;s++){var o=new _.Rect({width:n[s].width,height:n[s].width,left:n[s].x+1,top:n[s].y+1,originX:"center",originY:"center",fill:this.color});a.push(o)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));var c=new _.Group(a);this.shadow&&c.set("shadow",new _.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=p,this.canvas.requestRenderAll()},_getOptimizedRects:function(p){var u,h,n,a={};for(h=0,n=p.length;h<n;h++)a[u=p[h].left+""+p[h].top]||(a[u]=p[h]);var s=[];for(u in a)s.push(a[u]);return s},render:function(p){var u,h,a=this.canvas.contextTop;for(a.fillStyle=this.color,this._saveAndTransform(a),u=0,h=p.length;u<h;u++){var n=p[u];typeof n.opacity<"u"&&(a.globalAlpha=n.opacity),a.fillRect(n.x,n.y,n.width,n.width)}a.restore()},_render:function(){var a,u,p=this.canvas.contextTop;for(p.fillStyle=this.color,this._saveAndTransform(p),a=0,u=this.sprayChunks.length;a<u;a++)this.render(this.sprayChunks[a]);p.restore()},addSprayChunk:function(p){this.sprayChunkPoints=[];var a,u,h,s,n=this.width/2;for(s=0;s<this.density;s++){a=_.util.getRandomInt(p.x-n,p.x+n),u=_.util.getRandomInt(p.y-n,p.y+n),h=this.dotWidthVariance?_.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var i=new _.Point(a,u);i.width=h,this.randomOpacity&&(i.opacity=_.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}}),_.PatternBrush=_.util.createClass(_.PencilBrush,{getPatternSrc:function(){var u=_.util.createCanvasElement(),h=u.getContext("2d");return u.width=u.height=25,h.fillStyle=this.color,h.beginPath(),h.arc(10,10,10,0,2*Math.PI,!1),h.closePath(),h.fill(),u},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(p){return p.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(p){this.callSuper("_setBrushStyles",p),p.strokeStyle=this.getPattern(p)},createPath:function(p){var a=this.callSuper("createPath",p),u=a._getLeftTopCoords().scalarAdd(a.strokeWidth/2);return a.stroke=new _.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-u.x,offsetY:-u.y}),a}}),function(){var p=_.util.getPointer,a=_.util.degreesToRadians,u=_.util.isTouchEvent;for(var h in _.Canvas=_.util.createClass(_.StaticCanvas,{initialize:function(n,s){s||(s={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(n,s),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=_.PencilBrush&&new _.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var s,i,o,n=this.getActiveObjects();if(n.length>0&&!this.preserveObjectStacking){i=[],o=[];for(var c=0,r=this._objects.length;c<r;c++)-1===n.indexOf(s=this._objects[c])?i.push(s):o.push(s);n.length>1&&(this._activeObject._objects=o),i.push.apply(i,o)}else i=this._objects;return i},renderAll:function(){return this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(n){n.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(n),this.contextTopDirty=!0),n.restore()},renderTop:function(){var n=this.contextTop;return this.clearContext(n),this.renderTopLayer(n),this.fire("after:render"),this},_normalizePointer:function(n,s){var i=n.calcTransformMatrix(),o=_.util.invertTransform(i),c=this.restorePointerVpt(s);return _.util.transformPoint(c,o)},isTargetTransparent:function(n,s,i){if(n.shouldCache()&&n._cacheCanvas&&n!==this._activeObject){var o=this._normalizePointer(n,{x:s,y:i}),c=Math.max(n.cacheTranslationX+o.x*n.zoomX,0),r=Math.max(n.cacheTranslationY+o.y*n.zoomY,0);return _.util.isTransparent(n._cacheContext,Math.round(c),Math.round(r),this.targetFindTolerance)}var f=this.contextCache,m=n.selectionBackgroundColor,v=this.viewportTransform;return n.selectionBackgroundColor="",this.clearContext(f),f.save(),f.transform(v[0],v[1],v[2],v[3],v[4],v[5]),n.render(f),f.restore(),n.selectionBackgroundColor=m,_.util.isTransparent(f,s,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(n){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(i){return!0===n[i]}):n[this.selectionKey]},_shouldClearSelection:function(n,s){var i=this.getActiveObjects(),o=this._activeObject;return!s||s&&o&&i.length>1&&-1===i.indexOf(s)&&o!==s&&!this._isSelectionKeyPressed(n)||s&&!s.evented||s&&!s.selectable&&o&&o!==s},_shouldCenterTransform:function(n,s,i){var o;if(n)return"scale"===s||"scaleX"===s||"scaleY"===s||"resizing"===s?o=this.centeredScaling||n.centeredScaling:"rotate"===s&&(o=this.centeredRotation||n.centeredRotation),o?!i:i},_getOriginFromCorner:function(n,s){var i={x:n.originX,y:n.originY};return"ml"===s||"tl"===s||"bl"===s?i.x="right":("mr"===s||"tr"===s||"br"===s)&&(i.x="left"),"tl"===s||"mt"===s||"tr"===s?i.y="bottom":("bl"===s||"mb"===s||"br"===s)&&(i.y="top"),i},_getActionFromCorner:function(n,s,i,o){if(!s||!n)return"drag";var c=o.controls[s];return c.getActionName(i,c,o)},_setupCurrentTransform:function(n,s,i){if(s){var o=this.getPointer(n),c=s.__corner,r=s.controls[c],f=i&&c?r.getActionHandler(n,s,r):_.controlsUtils.dragHandler,m=this._getActionFromCorner(i,c,n,s),v=this._getOriginFromCorner(s,c),y=n[this.centeredKey],x={target:s,action:m,actionHandler:f,corner:c,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,offsetX:o.x-s.left,offsetY:o.y-s.top,originX:v.x,originY:v.y,ex:o.x,ey:o.y,lastX:o.x,lastY:o.y,theta:a(s.angle),width:s.width*s.scaleX,shiftKey:n.shiftKey,altKey:y,original:_.util.saveObjectTransform(s)};this._shouldCenterTransform(s,m,y)&&(x.originX="center",x.originY="center"),x.original.originX=v.x,x.original.originY=v.y,this._currentTransform=x,this._beforeTransform(n)}},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_drawSelection:function(n){var s=this._groupSelector,i=new _.Point(s.ex,s.ey),o=_.util.transformPoint(i,this.viewportTransform),c=new _.Point(s.ex+s.left,s.ey+s.top),r=_.util.transformPoint(c,this.viewportTransform),f=Math.min(o.x,r.x),m=Math.min(o.y,r.y),v=Math.max(o.x,r.x),y=Math.max(o.y,r.y),x=this.selectionLineWidth/2;this.selectionColor&&(n.fillStyle=this.selectionColor,n.fillRect(f,m,v-f,y-m)),this.selectionLineWidth&&this.selectionBorderColor&&(n.lineWidth=this.selectionLineWidth,n.strokeStyle=this.selectionBorderColor,f+=x,m+=x,v-=x,y-=x,_.Object.prototype._setLineDash.call(this,n,this.selectionDashArray),n.strokeRect(f,m,v-f,y-m))},findTarget:function(n,s){if(!this.skipTargetFind){var f,m,o=this.getPointer(n,!0),c=this._activeObject,r=this.getActiveObjects(),v=u(n),y=r.length>1&&!s||1===r.length;if(this.targets=[],y&&c._findTargetCorner(o,v)||r.length>1&&!s&&c===this._searchPossibleTargets([c],o))return c;if(1===r.length&&c===this._searchPossibleTargets([c],o)){if(!this.preserveObjectStacking)return c;f=c,m=this.targets,this.targets=[]}var x=this._searchPossibleTargets(this._objects,o);return n[this.altSelectionKey]&&x&&f&&x!==f&&(x=f,this.targets=m),x}},_checkTarget:function(n,s,i){if(s&&s.visible&&s.evented&&s.containsPoint(n)){if(!this.perPixelTargetFind&&!s.perPixelTargetFind||s.isEditing)return!0;if(!this.isTargetTransparent(s,i.x,i.y))return!0}},_searchPossibleTargets:function(n,s){for(var i,c,o=n.length;o--;){var r=n[o],f=r.group?this._normalizePointer(r.group,s):s;if(this._checkTarget(f,r,s)){(i=n[o]).subTargetCheck&&i instanceof _.Group&&(c=this._searchPossibleTargets(i._objects,s))&&this.targets.push(c);break}}return i},restorePointerVpt:function(n){return _.util.transformPoint(n,_.util.invertTransform(this.viewportTransform))},getPointer:function(n,s){if(this._absolutePointer&&!s)return this._absolutePointer;if(this._pointer&&s)return this._pointer;var m,i=p(n),o=this.upperCanvasEl,c=o.getBoundingClientRect(),r=c.width||0,f=c.height||0;(!r||!f)&&("top"in c&&"bottom"in c&&(f=Math.abs(c.top-c.bottom)),"right"in c&&"left"in c&&(r=Math.abs(c.right-c.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,s||(i=this.restorePointerVpt(i));var v=this.getRetinaScaling();return 1!==v&&(i.x/=v,i.y/=v),{x:i.x*(m=0===r||0===f?{width:1,height:1}:{width:o.width/r,height:o.height/f}).width,y:i.y*m.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),s=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),_.util.addClass(i,"upper-canvas "+n),this.wrapperEl.appendChild(i),this._copyCanvasStyle(s,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=_.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),_.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),_.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var s=this.width||n.width,i=this.height||n.height;_.util.setStyle(n,{position:"absolute",width:s+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),n.width=s,n.height=i,_.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,s){s.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var n=this._activeObject;return n?"activeSelection"===n.type&&n._objects?n._objects.slice(0):[n]:[]},_onObjectRemoved:function(n){n===this._activeObject&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared",{target:n}),n.fire("deselected")),n===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",n)},_fireSelectionEvents:function(n,s){var i=!1,o=this.getActiveObjects(),c=[],r=[];n.forEach(function(f){-1===o.indexOf(f)&&(i=!0,f.fire("deselected",{e:s,target:f}),r.push(f))}),o.forEach(function(f){-1===n.indexOf(f)&&(i=!0,f.fire("selected",{e:s,target:f}),c.push(f))}),n.length>0&&o.length>0?i&&this.fire("selection:updated",{e:s,selected:c,deselected:r}):o.length>0?this.fire("selection:created",{e:s,selected:c}):n.length>0&&this.fire("selection:cleared",{e:s,deselected:r})},setActiveObject:function(n,s){var i=this.getActiveObjects();return this._setActiveObject(n,s),this._fireSelectionEvents(i,s),this},_setActiveObject:function(n,s){return!(this._activeObject===n||!this._discardActiveObject(s,n)||n.onSelect({e:s})||(this._activeObject=n,0))},_discardActiveObject:function(n,s){var i=this._activeObject;if(i){if(i.onDeselect({e:n,object:s}))return!1;this._activeObject=null}return!0},discardActiveObject:function(n){var s=this.getActiveObjects(),i=this.getActiveObject();return s.length&&this.fire("before:selection:cleared",{target:i,e:n}),this._discardActiveObject(n),this._fireSelectionEvents(s,n),this},dispose:function(){var n=this.wrapperEl;return this.removeListeners(),n.removeChild(this.upperCanvasEl),n.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(s){_.util.cleanUpJsdomNode(this[s]),this[s]=void 0}.bind(this)),n.parentNode&&n.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,_.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(n){var s=this._activeObject;s&&s._renderControls(n)},_toObject:function(n,s,i){var o=this._realizeGroupTransformOnObject(n),c=this.callSuper("_toObject",n,s,i);return this._unwindGroupTransformOnObject(n,o),c},_realizeGroupTransformOnObject:function(n){if(n.group&&"activeSelection"===n.group.type&&this._activeObject===n.group){var i={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(o){i[o]=n[o]}),_.util.addTransformToObject(n,this._activeObject.calcOwnMatrix()),i}return null},_unwindGroupTransformOnObject:function(n,s){s&&n.set(s)},_setSVGObject:function(n,s,i){var o=this._realizeGroupTransformOnObject(s);this.callSuper("_setSVGObject",n,s,i),this._unwindGroupTransformOnObject(s,o)},setViewportTransform:function(n){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),_.StaticCanvas.prototype.setViewportTransform.call(this,n)}}),_.StaticCanvas)"prototype"!==h&&(_.Canvas[h]=_.StaticCanvas[h])}(),function(){var p=_.util.addListener,a=_.util.removeListener,s={passive:!1};function i(o,c){return o.button&&o.button===c-1}_.util.object.extend(_.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(p,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(o,c){var r=this.upperCanvasEl,f=this._getEventPrefix();o(_.window,"resize",this._onResize),o(r,f+"down",this._onMouseDown),o(r,f+"move",this._onMouseMove,s),o(r,f+"out",this._onMouseOut),o(r,f+"enter",this._onMouseEnter),o(r,"wheel",this._onMouseWheel),o(r,"contextmenu",this._onContextMenu),o(r,"dblclick",this._onDoubleClick),o(r,"dragover",this._onDragOver),o(r,"dragenter",this._onDragEnter),o(r,"dragleave",this._onDragLeave),o(r,"drop",this._onDrop),this.enablePointerEvents||o(r,"touchstart",this._onTouchStart,s),typeof eventjs<"u"&&c in eventjs&&(eventjs[c](r,"gesture",this._onGesture),eventjs[c](r,"drag",this._onDrag),eventjs[c](r,"orientation",this._onOrientationChange),eventjs[c](r,"shake",this._onShake),eventjs[c](r,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(a,"remove");var o=this._getEventPrefix();a(_.document,o+"up",this._onMouseUp),a(_.document,"touchend",this._onTouchEnd,s),a(_.document,o+"move",this._onMouseMove,s),a(_.document,"touchmove",this._onMouseMove,s)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(o,c){this.__onTransformGesture&&this.__onTransformGesture(o,c)},_onDrag:function(o,c){this.__onDrag&&this.__onDrag(o,c)},_onMouseWheel:function(o){this.__onMouseWheel(o)},_onMouseOut:function(o){var c=this._hoveredTarget;this.fire("mouse:out",{target:c,e:o}),this._hoveredTarget=null,c&&c.fire("mouseout",{e:o});var r=this;this._hoveredTargets.forEach(function(f){r.fire("mouse:out",{target:c,e:o}),f&&c.fire("mouseout",{e:o})}),this._hoveredTargets=[]},_onMouseEnter:function(o){!this._currentTransform&&!this.findTarget(o)&&(this.fire("mouse:over",{target:null,e:o}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(o,c){this.__onOrientationChange&&this.__onOrientationChange(o,c)},_onShake:function(o,c){this.__onShake&&this.__onShake(o,c)},_onLongPress:function(o,c){this.__onLongPress&&this.__onLongPress(o,c)},_onDragOver:function(o){o.preventDefault();var c=this._simpleEventHandler("dragover",o);this._fireEnterLeaveEvents(c,o)},_onDrop:function(o){return this._simpleEventHandler("drop:before",o),this._simpleEventHandler("drop",o)},_onContextMenu:function(o){return this.stopContextMenu&&(o.stopPropagation(),o.preventDefault()),!1},_onDoubleClick:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"dblclick"),this._resetTransformEventData(o)},getPointerId:function(o){var c=o.changedTouches;return c?c[0]&&c[0].identifier:this.enablePointerEvents?o.pointerId:-1},_isMainEvent:function(o){return!0===o.isPrimary||!1!==o.isPrimary&&("touchend"===o.type&&0===o.touches.length||!o.changedTouches||o.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(o){o.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(o)),this.__onMouseDown(o),this._resetTransformEventData();var c=this.upperCanvasEl,r=this._getEventPrefix();p(_.document,"touchend",this._onTouchEnd,s),p(_.document,"touchmove",this._onMouseMove,s),a(c,r+"down",this._onMouseDown)},_onMouseDown:function(o){this.__onMouseDown(o),this._resetTransformEventData();var c=this.upperCanvasEl,r=this._getEventPrefix();a(c,r+"move",this._onMouseMove,s),p(_.document,r+"up",this._onMouseUp),p(_.document,r+"move",this._onMouseMove,s)},_onTouchEnd:function(o){if(!(o.touches.length>0)){this.__onMouseUp(o),this._resetTransformEventData(),this.mainTouchId=null;var c=this._getEventPrefix();a(_.document,"touchend",this._onTouchEnd,s),a(_.document,"touchmove",this._onMouseMove,s);var r=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){p(r.upperCanvasEl,c+"down",r._onMouseDown),r._willAddMouseDown=0},400)}},_onMouseUp:function(o){this.__onMouseUp(o),this._resetTransformEventData();var c=this.upperCanvasEl,r=this._getEventPrefix();this._isMainEvent(o)&&(a(_.document,r+"up",this._onMouseUp),a(_.document,r+"move",this._onMouseMove,s),p(c,r+"move",this._onMouseMove,s))},_onMouseMove:function(o){!this.allowTouchScrolling&&o.preventDefault&&o.preventDefault(),this.__onMouseMove(o)},_onResize:function(){this.calcOffset()},_shouldRender:function(o){var c=this._activeObject;return!!(!!c!=!!o||c&&o&&c!==o)},__onMouseUp:function(o){var c,r=this._currentTransform,f=this._groupSelector,m=!1,v=!f||0===f.left&&0===f.top;if(this._cacheTransformEventData(o),c=this._target,this._handleEvent(o,"up:before"),i(o,3))this.fireRightClick&&this._handleEvent(o,"up",3,v);else{if(i(o,2))return this.fireMiddleClick&&this._handleEvent(o,"up",2,v),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(o);else if(this._isMainEvent(o)){if(r&&(this._finalizeCurrentTransform(o),m=r.actionPerformed),!v){var y=c===this._activeObject;this._maybeGroupObjects(o),m||(m=this._shouldRender(c)||!y&&c===this._activeObject)}var x,w;if(c){if(x=c._findTargetCorner(this.getPointer(o,!0),_.util.isTouchEvent(o)),c.selectable&&c!==this._activeObject&&"up"===c.activeOn)this.setActiveObject(c,o),m=!0;else{var O=c.controls[x],P=O&&O.getMouseUpHandler(o,c,O);P&&P(o,r,(w=this.getPointer(o)).x,w.y)}c.isMoving=!1}if(r&&(r.target!==c||r.corner!==x)){var X=r.target&&r.target.controls[r.corner],$=X&&X.getMouseUpHandler(o,c,O);w=w||this.getPointer(o),$&&$(o,r,w.x,w.y)}this._setCursorFromEvent(o,c),this._handleEvent(o,"up",1,v),this._groupSelector=null,this._currentTransform=null,c&&(c.__corner=0),m?this.requestRenderAll():v||this.renderTop()}}},_simpleEventHandler:function(o,c){var r=this.findTarget(c),f=this.targets,m={e:c,target:r,subTargets:f};if(this.fire(o,m),r&&r.fire(o,m),!f)return r;for(var v=0;v<f.length;v++)f[v].fire(o,m);return r},_handleEvent:function(o,c,r,f){var m=this._target,v=this.targets||[],y={e:o,target:m,subTargets:v,button:r||1,isClick:f||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===c&&(y.currentTarget=this.findTarget(o),y.currentSubTargets=this.targets),this.fire("mouse:"+c,y),m&&m.fire("mouse"+c,y);for(var x=0;x<v.length;x++)v[x].fire("mouse"+c,y)},_finalizeCurrentTransform:function(o){var c=this._currentTransform,r=c.target,f={e:o,target:r,transform:c,action:c.action};r._scaling&&(r._scaling=!1),r.setCoords(),(c.actionPerformed||this.stateful&&r.hasStateChanged())&&this._fire("modified",f)},_onMouseDownInDrawingMode:function(o){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(o).requestRenderAll();var c=this.getPointer(o);this.freeDrawingBrush.onMouseDown(c,{e:o,pointer:c}),this._handleEvent(o,"down")},_onMouseMoveInDrawingMode:function(o){if(this._isCurrentlyDrawing){var c=this.getPointer(o);this.freeDrawingBrush.onMouseMove(c,{e:o,pointer:c})}this.setCursor(this.freeDrawingCursor),this._handleEvent(o,"move")},_onMouseUpInDrawingMode:function(o){var c=this.getPointer(o);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:o,pointer:c}),this._handleEvent(o,"up")},__onMouseDown:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"down:before");var c=this._target;if(i(o,3))this.fireRightClick&&this._handleEvent(o,"down",3);else if(i(o,2))this.fireMiddleClick&&this._handleEvent(o,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(o);else if(this._isMainEvent(o)&&!this._currentTransform){this._previousPointer=r=this._pointer;var f=this._shouldRender(c),m=this._shouldGroup(o,c);if(this._shouldClearSelection(o,c)?this.discardActiveObject(o):m&&(this._handleGrouping(o,c),c=this._activeObject),this.selection&&(!c||!c.selectable&&!c.isEditing&&c!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),c){var v=c===this._activeObject;c.selectable&&"down"===c.activeOn&&this.setActiveObject(c,o);var y=c._findTargetCorner(this.getPointer(o,!0),_.util.isTouchEvent(o));if(c.__corner=y,c===this._activeObject&&(y||!m)){this._setupCurrentTransform(o,c,v);var x=c.controls[y],r=this.getPointer(o),w=x&&x.getMouseDownHandler(o,c,x);w&&w(o,this._currentTransform,r.x,r.y)}}this._handleEvent(o,"down"),(f||m)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(o){this._resetTransformEventData(),this._pointer=this.getPointer(o,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(o)||null},_beforeTransform:function(o){var c=this._currentTransform;this.stateful&&c.target.saveState(),this.fire("before:transform",{e:o,transform:c})},__onMouseMove:function(o){var c,r;if(this._handleEvent(o,"move:before"),this._cacheTransformEventData(o),this.isDrawingMode)this._onMouseMoveInDrawingMode(o);else if(this._isMainEvent(o)){var f=this._groupSelector;f?(f.left=(r=this._absolutePointer).x-f.ex,f.top=r.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(o):(c=this.findTarget(o)||null,this._setCursorFromEvent(o,c),this._fireOverOutEvents(c,o)),this._handleEvent(o,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(o,c){var r=this._hoveredTarget,f=this._hoveredTargets,m=this.targets,v=Math.max(f.length,m.length);this.fireSyntheticInOutEvents(o,c,{oldTarget:r,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var y=0;y<v;y++)this.fireSyntheticInOutEvents(m[y],c,{oldTarget:f[y],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(o,c){var r=this._draggedoverTarget,f=this._hoveredTargets,m=this.targets,v=Math.max(f.length,m.length);this.fireSyntheticInOutEvents(o,c,{oldTarget:r,evtOut:"dragleave",evtIn:"dragenter"});for(var y=0;y<v;y++)this.fireSyntheticInOutEvents(m[y],c,{oldTarget:f[y],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=o},fireSyntheticInOutEvents:function(o,c,r){var f,m,x,v=r.oldTarget,w=v!==o,O=r.canvasEvtIn,P=r.canvasEvtOut;w&&(f={e:c,target:o,previousTarget:v},m={e:c,target:v,nextTarget:o}),x=o&&w,v&&w&&(P&&this.fire(P,m),v.fire(r.evtOut,m)),x&&(O&&this.fire(O,f),o.fire(r.evtIn,f))},__onMouseWheel:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"wheel"),this._resetTransformEventData()},_transformObject:function(o){var c=this.getPointer(o),r=this._currentTransform;r.reset=!1,r.shiftKey=o.shiftKey,r.altKey=o[this.centeredKey],this._performTransformAction(o,r,c),r.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(o,c,r){var v=c.action,y=!1,x=c.actionHandler;x&&(y=x(o,c,r.x,r.y)),"drag"===v&&y&&(c.target.isMoving=!0,this.setCursor(c.target.moveCursor||this.moveCursor)),c.actionPerformed=c.actionPerformed||y},_fire:_.controlsUtils.fireEvent,_setCursorFromEvent:function(o,c){if(!c)return this.setCursor(this.defaultCursor),!1;var r=c.hoverCursor||this.hoverCursor,f=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,m=(!f||!f.contains(c))&&c._findTargetCorner(this.getPointer(o,!0));m?this.setCursor(this.getCornerCursor(m,c,o)):(c.subTargetCheck&&this.targets.concat().reverse().map(function(v){r=v.hoverCursor||r}),this.setCursor(r))},getCornerCursor:function(o,c,r){var f=c.controls[o];return f.cursorStyleHandler(r,f,c)}})}(),function(){var p=Math.min,a=Math.max;_.util.object.extend(_.Canvas.prototype,{_shouldGroup:function(u,h){var n=this._activeObject;return n&&this._isSelectionKeyPressed(u)&&h&&h.selectable&&this.selection&&(n!==h||"activeSelection"===n.type)&&!h.onSelect({e:u})},_handleGrouping:function(u,h){var n=this._activeObject;n.__corner||h===n&&(!(h=this.findTarget(u,!0))||!h.selectable)||(n&&"activeSelection"===n.type?this._updateActiveSelection(h,u):this._createActiveSelection(h,u))},_updateActiveSelection:function(u,h){var n=this._activeObject,s=n._objects.slice(0);n.contains(u)?(n.removeWithUpdate(u),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat(),1===n.size()&&this._setActiveObject(n.item(0),h)):(n.addWithUpdate(u),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(s,h)},_createActiveSelection:function(u,h){var n=this.getActiveObjects(),s=this._createGroup(u);this._hoveredTarget=s,this._setActiveObject(s,h),this._fireSelectionEvents(n,h)},_createGroup:function(u){var h=this._objects,s=h.indexOf(this._activeObject)<h.indexOf(u)?[this._activeObject,u]:[u,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new _.ActiveSelection(s,{canvas:this})},_groupSelectedObjects:function(u){var n,h=this._collectObjects(u);1===h.length?this.setActiveObject(h[0],u):h.length>1&&(n=new _.ActiveSelection(h.reverse(),{canvas:this}),this.setActiveObject(n,u))},_collectObjects:function(u){for(var n,h=[],s=this._groupSelector.ex,i=this._groupSelector.ey,o=s+this._groupSelector.left,c=i+this._groupSelector.top,r=new _.Point(p(s,o),p(i,c)),f=new _.Point(a(s,o),a(i,c)),m=!this.selectionFullyContained,v=s===o&&i===c,y=this._objects.length;y--&&!((n=this._objects[y])&&n.selectable&&n.visible&&(m&&n.intersectsWithRect(r,f,!0)||n.isContainedWithinRect(r,f,!0)||m&&n.containsPoint(r,null,!0)||m&&n.containsPoint(f,null,!0))&&(h.push(n),v)););return h.length>1&&(h=h.filter(function(x){return!x.onSelect({e:u})})),h},_maybeGroupObjects:function(u){this.selection&&this._groupSelector&&this._groupSelectedObjects(u),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),_.util.object.extend(_.StaticCanvas.prototype,{toDataURL:function(p){p||(p={});var a=p.format||"png",u=p.quality||1,h=(p.multiplier||1)*(p.enableRetinaScaling?this.getRetinaScaling():1),n=this.toCanvasElement(h,p);return _.util.toDataURL(n,a,u)},toCanvasElement:function(p,a){var u=((a=a||{}).width||this.width)*(p=p||1),h=(a.height||this.height)*p,n=this.getZoom(),s=this.width,i=this.height,o=n*p,c=this.viewportTransform,m=this.interactive,v=[o,0,0,o,(c[4]-(a.left||0))*p,(c[5]-(a.top||0))*p],y=this.enableRetinaScaling,x=_.util.createCanvasElement(),w=this.contextTop;return x.width=u,x.height=h,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=u,this.height=h,this.calcViewportBoundaries(),this.renderCanvas(x.getContext("2d"),this._objects),this.viewportTransform=c,this.width=s,this.height=i,this.calcViewportBoundaries(),this.interactive=m,this.enableRetinaScaling=y,this.contextTop=w,x}}),_.util.object.extend(_.StaticCanvas.prototype,{loadFromJSON:function(p,a,u){if(p){var h="string"==typeof p?JSON.parse(p):_.util.object.clone(p),n=this,s=h.clipPath,i=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete h.clipPath,this._enlivenObjects(h.objects,function(o){n.clear(),n._setBgOverlay(h,function(){s?n._enlivenObjects([s],function(c){n.clipPath=c[0],n.__setupCanvas.call(n,h,o,i,a)}):n.__setupCanvas.call(n,h,o,i,a)})},u),this}},__setupCanvas:function(p,a,u,h){var n=this;a.forEach(function(s,i){n.insertAt(s,i)}),this.renderOnAddRemove=u,delete p.objects,delete p.backgroundImage,delete p.overlayImage,delete p.background,delete p.overlay,this._setOptions(p),this.renderAll(),h&&h()},_setBgOverlay:function(p,a){var u={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(p.backgroundImage||p.overlayImage||p.background||p.overlay){var h=function(){u.backgroundImage&&u.overlayImage&&u.backgroundColor&&u.overlayColor&&a&&a()};this.__setBgOverlay("backgroundImage",p.backgroundImage,u,h),this.__setBgOverlay("overlayImage",p.overlayImage,u,h),this.__setBgOverlay("backgroundColor",p.background,u,h),this.__setBgOverlay("overlayColor",p.overlay,u,h)}else a&&a()},__setBgOverlay:function(p,a,u,h){var n=this;if(!a)return u[p]=!0,void(h&&h());"backgroundImage"===p||"overlayImage"===p?_.util.enlivenObjects([a],function(s){n[p]=s[0],u[p]=!0,h&&h()}):this["set"+_.util.string.capitalize(p,!0)](a,function(){u[p]=!0,h&&h()})},_enlivenObjects:function(p,a,u){p&&0!==p.length?_.util.enlivenObjects(p,function(h){a&&a(h)},null,u):a&&a([])},_toDataURL:function(p,a){this.clone(function(u){a(u.toDataURL(p))})},_toDataURLWithMultiplier:function(p,a,u){this.clone(function(h){u(h.toDataURLWithMultiplier(p,a))})},clone:function(p,a){var u=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(h){h.loadFromJSON(u,function(){p&&p(h)})})},cloneWithoutData:function(p){var a=_.util.createCanvasElement();a.width=this.width,a.height=this.height;var u=new _.Canvas(a);this.backgroundImage?(u.setBackgroundImage(this.backgroundImage.src,function(){u.renderAll(),p&&p(u)}),u.backgroundImageOpacity=this.backgroundImageOpacity,u.backgroundImageStretch=this.backgroundImageStretch):p&&p(u)}}),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.extend,h=a.util.object.clone,n=a.util.toFixed,s=a.util.string.capitalize,i=a.util.degreesToRadians;a.Object||(a.Object=a.util.createClass(a.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!a.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(r){r&&this.setOptions(r)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=a.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(r){var f=a.perfLimitSizeTotal,m=r.width,v=r.height,y=a.maxCacheSideLimit,x=a.minCacheSideLimit;if(m<=y&&v<=y&&m*v<=f)return m<x&&(r.width=x),v<x&&(r.height=x),r;var O=a.util.limitDimsByArea(m/v,f),P=a.util.capValue,X=P(x,O.x,y),$=P(x,O.y,y);return m>X&&(r.zoomX/=m/X,r.width=X,r.capped=!0),v>$&&(r.zoomY/=v/$,r.height=$,r.capped=!0),r},_getCacheCanvasDimensions:function(){var r=this.getTotalObjectScaling(),f=this._getTransformedDimensions(0,0),m=f.x*r.scaleX/this.scaleX,v=f.y*r.scaleY/this.scaleY;return{width:m+2,height:v+2,zoomX:r.scaleX,zoomY:r.scaleY,x:m,y:v}},_updateCacheCanvas:function(){var r=this.canvas;if(this.noScaleCache&&r&&r._currentTransform){var m=r._currentTransform.action;if(this===r._currentTransform.target&&m.slice&&"scale"===m.slice(0,5))return!1}var P,X,v=this._cacheCanvas,y=this._limitCacheSize(this._getCacheCanvasDimensions()),x=a.minCacheSideLimit,w=y.width,O=y.height,$=y.zoomX,tt=y.zoomY,at=w!==this.cacheWidth||O!==this.cacheHeight,et=at||this.zoomX!==$||this.zoomY!==tt,rt=0,ut=0,pt=!1;if(at){var ft=this._cacheCanvas.width,S=this._cacheCanvas.height,I=w>ft||O>S;pt=I||(w<.9*ft||O<.9*S)&&ft>x&&S>x,I&&!y.capped&&(w>x||O>x)&&(rt=.1*w,ut=.1*O)}return this instanceof a.Text&&this.path&&(et=!0,pt=!0,rt+=this.getHeightOfLine(0)*this.zoomX,ut+=this.getHeightOfLine(0)*this.zoomY),!!et&&(pt?(v.width=Math.ceil(w+rt),v.height=Math.ceil(O+ut)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,v.width,v.height)),P=y.x/2,X=y.y/2,this.cacheTranslationX=Math.round(v.width/2-P)+P,this.cacheTranslationY=Math.round(v.height/2-X)+X,this.cacheWidth=w,this.cacheHeight=O,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale($,tt),this.zoomX=$,this.zoomY=tt,!0)},setOptions:function(r){this._setOptions(r),this._initGradient(r.fill,"fill"),this._initGradient(r.stroke,"stroke"),this._initPattern(r.fill,"fill"),this._initPattern(r.stroke,"stroke")},transform:function(r){var m=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&r===this.canvas.contextTop));r.transform(m[0],m[1],m[2],m[3],m[4],m[5])},toObject:function(r){var f=a.Object.NUM_FRACTION_DIGITS,m={type:this.type,version:a.version,originX:this.originX,originY:this.originY,left:n(this.left,f),top:n(this.top,f),width:n(this.width,f),height:n(this.height,f),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,f),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:n(this.strokeMiterLimit,f),scaleX:n(this.scaleX,f),scaleY:n(this.scaleY,f),angle:n(this.angle,f),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:n(this.skewX,f),skewY:n(this.skewY,f)};return this.clipPath&&!this.clipPath.excludeFromExport&&(m.clipPath=this.clipPath.toObject(r),m.clipPath.inverted=this.clipPath.inverted,m.clipPath.absolutePositioned=this.clipPath.absolutePositioned),a.util.populateWithProperties(this,m,r),this.includeDefaultValues||(m=this._removeDefaultValues(m)),m},toDatalessObject:function(r){return this.toObject(r)},_removeDefaultValues:function(r){var f=a.util.getKlass(r.type).prototype;return f.stateProperties.forEach(function(v){"left"===v||"top"===v||(r[v]===f[v]&&delete r[v],Array.isArray(r[v])&&Array.isArray(f[v])&&0===r[v].length&&0===f[v].length&&delete r[v])}),r},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var r=a.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(r.scaleX),scaleY:Math.abs(r.scaleY)}},getTotalObjectScaling:function(){var r=this.getObjectScaling(),f=r.scaleX,m=r.scaleY;if(this.canvas){var v=this.canvas.getZoom(),y=this.canvas.getRetinaScaling();f*=v*y,m*=v*y}return{scaleX:f,scaleY:m}},getObjectOpacity:function(){var r=this.opacity;return this.group&&(r*=this.group.getObjectOpacity()),r},_set:function(r,f){var v=this[r]!==f,y=!1;return("scaleX"===r||"scaleY"===r)&&(f=this._constrainScale(f)),"scaleX"===r&&f<0?(this.flipX=!this.flipX,f*=-1):"scaleY"===r&&f<0?(this.flipY=!this.flipY,f*=-1):"shadow"!==r||!f||f instanceof a.Shadow?"dirty"===r&&this.group&&this.group.set("dirty",f):f=new a.Shadow(f),this[r]=f,v&&(y=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(r)>-1?(this.dirty=!0,y&&this.group.set("dirty",!0)):y&&this.stateProperties.indexOf(r)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:a.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(r){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(r.save(),this._setupCompositeOperation(r),this.drawSelectionBackground(r),this.transform(r),this._setOpacity(r),this._setShadow(r,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(r)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(r),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),r.restore())},renderCache:function(r){r=r||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,r.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!!("stroke"===this.paintFirst&&this.hasFill()&&this.hasStroke()&&"object"==typeof this.shadow||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(r,f){if(r.save(),r.globalCompositeOperation=f.inverted?"destination-out":"destination-in",f.absolutePositioned){var m=a.util.invertTransform(this.calcTransformMatrix());r.transform(m[0],m[1],m[2],m[3],m[4],m[5])}f.transform(r),r.scale(1/f.zoomX,1/f.zoomY),r.drawImage(f._cacheCanvas,-f.cacheTranslationX,-f.cacheTranslationY),r.restore()},drawObject:function(r,f){var m=this.fill,v=this.stroke;f?(this.fill="black",this.stroke="",this._setClippingProperties(r)):this._renderBackground(r),this._render(r),this._drawClipPath(r,this.clipPath),this.fill=m,this.stroke=v},_drawClipPath:function(r,f){!f||(f.canvas=this.canvas,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCache(r,f))},drawCacheOnCanvas:function(r){r.scale(1/this.zoomX,1/this.zoomY),r.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(r){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!r&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!r){var f=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-m/2,f,m)}return!0}return!1},_renderBackground:function(r){if(this.backgroundColor){var f=this._getNonTransformedDimensions();r.fillStyle=this.backgroundColor,r.fillRect(-f.x/2,-f.y/2,f.x,f.y),this._removeShadow(r)}},_setOpacity:function(r){this.group&&!this.group._transformDone?r.globalAlpha=this.getObjectOpacity():r.globalAlpha*=this.opacity},_setStrokeStyles:function(r,f){var m=f.stroke;m&&(r.lineWidth=f.strokeWidth,r.lineCap=f.strokeLineCap,r.lineDashOffset=f.strokeDashOffset,r.lineJoin=f.strokeLineJoin,r.miterLimit=f.strokeMiterLimit,m.toLive?"percentage"===m.gradientUnits||m.gradientTransform||m.patternTransform?this._applyPatternForTransformedGradient(r,m):(r.strokeStyle=m.toLive(r,this),this._applyPatternGradientTransform(r,m)):r.strokeStyle=f.stroke)},_setFillStyles:function(r,f){var m=f.fill;m&&(m.toLive?(r.fillStyle=m.toLive(r,this),this._applyPatternGradientTransform(r,f.fill)):r.fillStyle=m)},_setClippingProperties:function(r){r.globalAlpha=1,r.strokeStyle="transparent",r.fillStyle="#000000"},_setLineDash:function(r,f){!f||0===f.length||(1&f.length&&f.push.apply(f,f),r.setLineDash(f))},_renderControls:function(r,f){var y,x,w,m=this.getViewportTransform(),v=this.calcTransformMatrix();x=typeof(f=f||{}).hasBorders<"u"?f.hasBorders:this.hasBorders,w=typeof f.hasControls<"u"?f.hasControls:this.hasControls,v=a.util.multiplyTransformMatrices(m,v),y=a.util.qrDecompose(v),r.save(),r.translate(y.translateX,y.translateY),r.lineWidth=1*this.borderScaleFactor,this.group||(r.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(y.angle-=180),r.rotate(i(this.group?y.angle:this.angle)),f.forActiveSelection||this.group?x&&this.drawBordersInGroup(r,y,f):x&&this.drawBorders(r,f),w&&this.drawControls(r,f),r.restore()},_setShadow:function(r){if(this.shadow){var v,f=this.shadow,m=this.canvas,y=m&&m.viewportTransform[0]||1,x=m&&m.viewportTransform[3]||1;v=f.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),m&&m._isRetinaScaling()&&(y*=a.devicePixelRatio,x*=a.devicePixelRatio),r.shadowColor=f.color,r.shadowBlur=f.blur*a.browserShadowBlurConstant*(y+x)*(v.scaleX+v.scaleY)/4,r.shadowOffsetX=f.offsetX*y*v.scaleX,r.shadowOffsetY=f.offsetY*x*v.scaleY}},_removeShadow:function(r){!this.shadow||(r.shadowColor="",r.shadowBlur=r.shadowOffsetX=r.shadowOffsetY=0)},_applyPatternGradientTransform:function(r,f){if(!f||!f.toLive)return{offsetX:0,offsetY:0};var m=f.gradientTransform||f.patternTransform,v=-this.width/2+f.offsetX||0,y=-this.height/2+f.offsetY||0;return"percentage"===f.gradientUnits?r.transform(this.width,0,0,this.height,v,y):r.transform(1,0,0,1,v,y),m&&r.transform(m[0],m[1],m[2],m[3],m[4],m[5]),{offsetX:v,offsetY:y}},_renderPaintInOrder:function(r){"stroke"===this.paintFirst?(this._renderStroke(r),this._renderFill(r)):(this._renderFill(r),this._renderStroke(r))},_render:function(){},_renderFill:function(r){!this.fill||(r.save(),this._setFillStyles(r,this),"evenodd"===this.fillRule?r.fill("evenodd"):r.fill(),r.restore())},_renderStroke:function(r){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this.strokeUniform&&this.group){var f=this.getObjectScaling();r.scale(1/f.scaleX,1/f.scaleY)}else this.strokeUniform&&r.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(r,this.strokeDashArray),this._setStrokeStyles(r,this),r.stroke(),r.restore()}},_applyPatternForTransformedGradient:function(r,f){var y,m=this._limitCacheSize(this._getCacheCanvasDimensions()),v=a.util.createCanvasElement(),x=this.canvas.getRetinaScaling(),w=m.x/this.scaleX/x,O=m.y/this.scaleY/x;v.width=w,v.height=O,(y=v.getContext("2d")).beginPath(),y.moveTo(0,0),y.lineTo(w,0),y.lineTo(w,O),y.lineTo(0,O),y.closePath(),y.translate(w/2,O/2),y.scale(m.zoomX/this.scaleX/x,m.zoomY/this.scaleY/x),this._applyPatternGradientTransform(y,f),y.fillStyle=f.toLive(r),y.fill(),r.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),r.scale(x*this.scaleX/m.zoomX,x*this.scaleY/m.zoomY),r.strokeStyle=y.createPattern(v,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var r=a.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",r.scaleX),this.set("scaleY",r.scaleY),this.angle=r.angle,this.skewX=r.skewX,this.skewY=0}},_removeTransformMatrix:function(r){var f=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),f=a.util.transformPoint(f,this.transformMatrix)),this.transformMatrix=null,r&&(this.scaleX*=r.scaleX,this.scaleY*=r.scaleY,this.cropX=r.cropX,this.cropY=r.cropY,f.x+=r.offsetLeft,f.y+=r.offsetTop,this.width=r.width,this.height=r.height),this.setPositionByOrigin(f,"center","center")},clone:function(r,f){var m=this.toObject(f);this.constructor.fromObject?this.constructor.fromObject(m,r):a.Object._fromObject("Object",m,r)},cloneAsImage:function(r,f){var m=this.toCanvasElement(f);return r&&r(new a.Image(m)),this},toCanvasElement:function(r){r||(r={});var f=a.util,m=f.saveObjectTransform(this),v=this.group,y=this.shadow,x=Math.abs,w=(r.multiplier||1)*(r.enableRetinaScaling?a.devicePixelRatio:1);delete this.group,r.withoutTransform&&f.resetObjectTransform(this),r.withoutShadow&&(this.shadow=null);var $,at,et,O=a.util.createCanvasElement(),P=this.getBoundingRect(!0,!0),X=this.shadow,tt={x:0,y:0};X&&(at=X.blur,$=X.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),tt.x=2*Math.round(x(X.offsetX)+at)*x($.scaleX),tt.y=2*Math.round(x(X.offsetY)+at)*x($.scaleY)),et=P.height+tt.y,O.width=Math.ceil(P.width+tt.x),O.height=Math.ceil(et);var rt=new a.StaticCanvas(O,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===r.format&&(rt.backgroundColor="#fff"),this.setPositionByOrigin(new a.Point(rt.width/2,rt.height/2),"center","center");var ut=this.canvas;rt.add(this);var pt=rt.toCanvasElement(w||1,r);return this.shadow=y,this.set("canvas",ut),v&&(this.group=v),this.set(m).setCoords(),rt._objects=[],rt.dispose(),rt=null,pt},toDataURL:function(r){return r||(r={}),a.util.toDataURL(this.toCanvasElement(r),r.format||"png",r.quality||1)},isType:function(r){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===r},complexity:function(){return 1},toJSON:function(r){return this.toObject(r)},rotate:function(r){var f=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return f&&this._setOriginToCenter(),this.set("angle",r),f&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(r,f){f=f||this.canvas.getPointer(r);var m=new a.Point(f.x,f.y),v=this._getLeftTopCoords();return this.angle&&(m=a.util.rotatePoint(m,v,i(-this.angle))),{x:m.x-v.x,y:m.y-v.y}},_setupCompositeOperation:function(r){this.globalCompositeOperation&&(r.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){a.runningAnimations&&a.runningAnimations.cancelByTarget(this)}}),a.util.createAccessors&&a.util.createAccessors(a.Object),u(a.Object.prototype,a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.ENLIVEN_PROPS=["clipPath"],a.Object._fromObject=function(r,f,m,v){var y=a[r];f=h(f,!0),a.util.enlivenPatterns([f.fill,f.stroke],function(x){typeof x[0]<"u"&&(f.fill=x[0]),typeof x[1]<"u"&&(f.stroke=x[1]),a.util.enlivenObjectEnlivables(f,f,function(){var w=v?new y(f[v],f):new y(f);m&&m(w)})})},a.Object.__uid=0)}(yt),function(){var p=_.util.degreesToRadians,a={left:-.5,center:0,right:.5},u={top:-.5,center:0,bottom:.5};_.util.object.extend(_.Object.prototype,{translateToGivenOrigin:function(h,n,s,i,o){var f,m,v,c=h.x,r=h.y;return"string"==typeof n?n=a[n]:n-=.5,"string"==typeof i?i=a[i]:i-=.5,"string"==typeof s?s=u[s]:s-=.5,"string"==typeof o?o=u[o]:o-=.5,m=o-s,((f=i-n)||m)&&(v=this._getTransformedDimensions(),c=h.x+f*v.x,r=h.y+m*v.y),new _.Point(c,r)},translateToCenterPoint:function(h,n,s){var i=this.translateToGivenOrigin(h,n,s,"center","center");return this.angle?_.util.rotatePoint(i,h,p(this.angle)):i},translateToOriginPoint:function(h,n,s){var i=this.translateToGivenOrigin(h,"center","center",n,s);return this.angle?_.util.rotatePoint(i,h,p(this.angle)):i},getCenterPoint:function(){var h=new _.Point(this.left,this.top);return this.translateToCenterPoint(h,this.originX,this.originY)},getPointByOrigin:function(h,n){var s=this.getCenterPoint();return this.translateToOriginPoint(s,h,n)},toLocalPoint:function(h,n,s){var o,c,i=this.getCenterPoint();return o=typeof n<"u"&&typeof s<"u"?this.translateToGivenOrigin(i,"center","center",n,s):new _.Point(this.left,this.top),c=new _.Point(h.x,h.y),this.angle&&(c=_.util.rotatePoint(c,i,-p(this.angle))),c.subtractEquals(o)},setPositionByOrigin:function(h,n,s){var i=this.translateToCenterPoint(h,n,s),o=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",o.x),this.set("top",o.y)},adjustPosition:function(h){var c,r,n=p(this.angle),s=this.getScaledWidth(),i=_.util.cos(n)*s,o=_.util.sin(n)*s;this.left+=i*((r="string"==typeof h?a[h]:h-.5)-(c="string"==typeof this.originX?a[this.originX]:this.originX-.5)),this.top+=o*(r-c),this.setCoords(),this.originX=h},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var h=this.getCenterPoint();this.originX="center",this.originY="center",this.left=h.x,this.top=h.y},_resetOrigin:function(){var h=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=h.x,this.top=h.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){var a=_.util,u=a.degreesToRadians,h=a.multiplyTransformMatrices,n=a.transformPoint;a.object.extend(_.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(s,i){return i?s?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),s?this.aCoords:this.lineCoords)},getCoords:function(s,i){return function p(s){return[new _.Point(s.tl.x,s.tl.y),new _.Point(s.tr.x,s.tr.y),new _.Point(s.br.x,s.br.y),new _.Point(s.bl.x,s.bl.y)]}(this._getCoords(s,i))},intersectsWithRect:function(s,i,o,c){var r=this.getCoords(o,c);return"Intersection"===_.Intersection.intersectPolygonRectangle(r,s,i).status},intersectsWithObject:function(s,i,o){return"Intersection"===_.Intersection.intersectPolygonPolygon(this.getCoords(i,o),s.getCoords(i,o)).status||s.isContainedWithinObject(this,i,o)||this.isContainedWithinObject(s,i,o)},isContainedWithinObject:function(s,i,o){for(var c=this.getCoords(i,o),f=0,m=s._getImageLines(i?s.aCoords:s.lineCoords);f<4;f++)if(!s.containsPoint(c[f],m))return!1;return!0},isContainedWithinRect:function(s,i,o,c){var r=this.getBoundingRect(o,c);return r.left>=s.x&&r.left+r.width<=i.x&&r.top>=s.y&&r.top+r.height<=i.y},containsPoint:function(s,f,o,c){var r=this._getCoords(o,c),m=(f=f||this._getImageLines(r),this._findCrossPoints(s,f));return 0!==m&&m%2==1},isOnScreen:function(s){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;return!(!this.getCoords(!0,s).some(function(r){return r.x<=o.x&&r.x>=i.x&&r.y<=o.y&&r.y>=i.y})&&!this.intersectsWithRect(i,o,!0,s))||this._containsCenterOfCanvas(i,o,s)},_containsCenterOfCanvas:function(s,i,o){return!!this.containsPoint({x:(s.x+i.x)/2,y:(s.y+i.y)/2},null,!0,o)},isPartiallyOnScreen:function(s){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;return!!this.intersectsWithRect(i,o,!0,s)||this.getCoords(!0,s).every(function(r){return(r.x>=o.x||r.x<=i.x)&&(r.y>=o.y||r.y<=i.y)})&&this._containsCenterOfCanvas(i,o,s)},_getImageLines:function(s){return{topline:{o:s.tl,d:s.tr},rightline:{o:s.tr,d:s.br},bottomline:{o:s.br,d:s.bl},leftline:{o:s.bl,d:s.tl}}},_findCrossPoints:function(s,i){var c,r,f,m,y,v=0;for(var x in i)if(!((y=i[x]).o.y<s.y&&y.d.y<s.y||y.o.y>=s.y&&y.d.y>=s.y||(y.o.x===y.d.x&&y.o.x>=s.x?m=y.o.x:(c=(y.d.y-y.o.y)/(y.d.x-y.o.x),r=s.y-0*s.x,f=y.o.y-c*y.o.x,m=-(r-f)/(0-c)),m>=s.x&&(v+=1),2!==v)))break;return v},getBoundingRect:function(s,i){var o=this.getCoords(s,i);return a.makeBoundingBoxFromPoints(o)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(s){return Math.abs(s)<this.minScaleLimit?s<0?-this.minScaleLimit:this.minScaleLimit:0===s?1e-4:s},scale:function(s){return this._set("scaleX",s),this._set("scaleY",s),this.setCoords()},scaleToWidth:function(s,i){var o=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(s/this.width/o)},scaleToHeight:function(s,i){var o=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(s/this.height/o)},calcLineCoords:function(){var s=this.getViewportTransform(),i=this.padding,o=u(this.angle),f=a.cos(o)*i,m=a.sin(o)*i,v=f+m,y=f-m,x=this.calcACoords(),w={tl:n(x.tl,s),tr:n(x.tr,s),bl:n(x.bl,s),br:n(x.br,s)};return i&&(w.tl.x-=y,w.tl.y-=v,w.tr.x+=v,w.tr.y-=y,w.bl.x-=v,w.bl.y+=y,w.br.x+=y,w.br.y+=v),w},calcOCoords:function(){var s=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),o=this.getViewportTransform(),c=h(o,i),r=h(c,s),f=(r=h(r,[1/o[0],0,0,1/o[3],0,0]),this._calculateCurrentDimensions()),m={};return this.forEachControl(function(v,y,x){m[y]=v.positionHandler(f,r,x)}),m},calcACoords:function(){var s=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),o=h(i,s),c=this._getTransformedDimensions(),r=c.x/2,f=c.y/2;return{tl:n({x:-r,y:-f},o),tr:n({x:r,y:-f},o),bl:n({x:-r,y:f},o),br:n({x:r,y:f},o)}},setCoords:function(s){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),s||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return a.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var s=this.getCenterPoint();return[1,0,0,1,s.x,s.y]},transformMatrixKey:function(s){var i="_",o="";return!s&&this.group&&(o=this.group.transformMatrixKey(s)+i),o+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(s){var i=this.calcOwnMatrix();if(s||!this.group)return i;var o=this.transformMatrixKey(s),c=this.matrixCache||(this.matrixCache={});return c.key===o?c.value:(this.group&&(i=h(this.group.calcTransformMatrix(!1),i)),c.key=o,c.value=i,i)},calcOwnMatrix:function(){var s=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===s)return i.value;var o=this._calcTranslateMatrix(),c={angle:this.angle,translateX:o[4],translateY:o[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=s,i.value=a.composeMatrix(c),i.value},_getNonTransformedDimensions:function(){var s=this.strokeWidth;return{x:this.width+s,y:this.height+s}},_getTransformedDimensions:function(s,i){typeof s>"u"&&(s=this.skewX),typeof i>"u"&&(i=this.skewY);var o,c,r,f=0===s&&0===i;if(this.strokeUniform?(c=this.width,r=this.height):(c=(o=this._getNonTransformedDimensions()).x,r=o.y),f)return this._finalizeDimensions(c*this.scaleX,r*this.scaleY);var m=a.sizeAfterTransform(c,r,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:s,skewY:i});return this._finalizeDimensions(m.x,m.y)},_finalizeDimensions:function(s,i){return this.strokeUniform?{x:s+this.strokeWidth,y:i+this.strokeWidth}:{x:s,y:i}},_calculateCurrentDimensions:function(){var s=this.getViewportTransform(),i=this._getTransformedDimensions();return n(i,s,!0).scalarAdd(2*this.padding)}})}(),_.util.object.extend(_.Object.prototype,{sendToBack:function(){return this.group?_.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?_.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(p){return this.group?_.StaticCanvas.prototype.sendBackwards.call(this.group,this,p):this.canvas&&this.canvas.sendBackwards(this,p),this},bringForward:function(p){return this.group?_.StaticCanvas.prototype.bringForward.call(this.group,this,p):this.canvas&&this.canvas.bringForward(this,p),this},moveTo:function(p){return this.group&&"activeSelection"!==this.group.type?_.StaticCanvas.prototype.moveTo.call(this.group,this,p):this.canvas&&this.canvas.moveTo(this,p),this}}),function(){function p(u,h){if(h){if(h.toLive)return u+": url(#SVGID_"+h.id+"); ";var n=new _.Color(h),s=u+": "+n.toRgb()+"; ",i=n.getAlpha();return 1!==i&&(s+=u+"-opacity: "+i.toString()+"; "),s}return u+": none; "}var a=_.util.toFixed;_.util.object.extend(_.Object.prototype,{getSvgStyles:function(u){var h=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):"none",i=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",c=this.strokeLineJoin?this.strokeLineJoin:"miter",r=this.strokeMiterLimit?this.strokeMiterLimit:"4",f=typeof this.opacity<"u"?this.opacity:"1",m=this.visible?"":" visibility: hidden;",v=u?"":this.getSvgFilter(),y=p("fill",this.fill);return[p("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",c,"; ","stroke-miterlimit: ",r,"; ",y,"fill-rule: ",h,"; ","opacity: ",f,";",v,m].join("")},getSvgSpanStyles:function(u,h){var n="; ",i=u.fontFamily?"font-family: "+(-1===u.fontFamily.indexOf("'")&&-1===u.fontFamily.indexOf('"')?"'"+u.fontFamily+"'":u.fontFamily)+n:"",s=u.strokeWidth?"stroke-width: "+u.strokeWidth+n:"",o=u.fontSize?"font-size: "+u.fontSize+"px"+n:"",c=u.fontStyle?"font-style: "+u.fontStyle+n:"",r=u.fontWeight?"font-weight: "+u.fontWeight+n:"",f=u.fill?p("fill",u.fill):"",m=u.stroke?p("stroke",u.stroke):"",v=this.getSvgTextDecoration(u);return v&&(v="text-decoration: "+v+n),[m,s,i,o,c,r,v,f,u.deltaY?"baseline-shift: "+-u.deltaY+"; ":"",h?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(u){return["overline","underline","line-through"].filter(function(h){return u[h.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(u,h){var n=u?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+_.util.matrixToSVG(n)+(h||"")+'" '},_setSVGBg:function(u){if(this.backgroundColor){var h=_.Object.NUM_FRACTION_DIGITS;u.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,h),'" y="',a(-this.height/2,h),'" width="',a(this.width,h),'" height="',a(this.height,h),'"></rect>\n')}},toSVG:function(u){return this._createBaseSVGMarkup(this._toSVG(u),{reviver:u})},toClipPathSVG:function(u){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(u),{reviver:u})},_createBaseClipPathSVGMarkup:function(u,h){var n=(h=h||{}).reviver,i=[this.getSvgTransform(!0,h.additionalTransform||""),this.getSvgCommons()].join(""),o=u.indexOf("COMMON_PARTS");return u[o]=i,n?n(u.join("")):u.join("")},_createBaseSVGMarkup:function(u,h){var x,O,n=(h=h||{}).noStyle,s=h.reviver,i=n?"":'style="'+this.getSvgStyles()+'" ',o=h.withShadow?'style="'+this.getSvgFilter()+'" ':"",c=this.clipPath,r=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",f=c&&c.absolutePositioned,m=this.stroke,v=this.fill,y=this.shadow,w=[],P=u.indexOf("COMMON_PARTS"),X=h.additionalTransform;return c&&(c.clipPathId="CLIPPATH_"+_.Object.__uid++,O='<clipPath id="'+c.clipPathId+'" >\n'+c.toClipPathSVG(s)+"</clipPath>\n"),f&&w.push("<g ",o,this.getSvgCommons()," >\n"),w.push("<g ",this.getSvgTransform(!1),f?"":o+this.getSvgCommons()," >\n"),x=[i,r,n?"":this.addPaintOrder()," ",X?'transform="'+X+'" ':""].join(""),u[P]=x,v&&v.toLive&&w.push(v.toSVG(this)),m&&m.toLive&&w.push(m.toSVG(this)),y&&w.push(y.toSVG(this)),c&&w.push(O),w.push(u.join("")),w.push("</g>\n"),f&&w.push("</g>\n"),s?s(w.join("")):w.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var p=_.util.object.extend,a="stateProperties";function u(n,s,i){var o={};i.forEach(function(r){o[r]=n[r]}),p(n[s],o,!0)}function h(n,s,i){if(n===s)return!0;if(Array.isArray(n)){if(!Array.isArray(s)||n.length!==s.length)return!1;for(var o=0,c=n.length;o<c;o++)if(!h(n[o],s[o]))return!1;return!0}if(n&&"object"==typeof n){var f,r=Object.keys(n);if(!s||"object"!=typeof s||!i&&r.length!==Object.keys(s).length)return!1;for(o=0,c=r.length;o<c;o++)if("canvas"!==(f=r[o])&&"group"!==f&&!h(n[f],s[f]))return!1;return!0}}_.util.object.extend(_.Object.prototype,{hasStateChanged:function(n){var s="_"+(n=n||a);return Object.keys(this[s]).length<this[n].length||!h(this[s],this,!0)},saveState:function(n){var s=n&&n.propertySet||a,i="_"+s;return this[i]?(u(this,i,this[s]),n&&n.stateProperties&&u(this,i,n.stateProperties),this):this.setupState(n)},setupState:function(n){var s=(n=n||{}).propertySet||a;return n.propertySet=s,this["_"+s]={},this.saveState(n),this}})}(),function(){var p=_.util.degreesToRadians;_.util.object.extend(_.Object.prototype,{_findTargetCorner:function(a,u){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var s,i,r,h=a.x,n=a.y,o=Object.keys(this.oCoords),c=o.length-1;for(this.__corner=0;c>=0;c--)if(this.isControlVisible(r=o[c])&&(i=this._getImageLines(u?this.oCoords[r].touchCorner:this.oCoords[r].corner),0!==(s=this._findCrossPoints({x:h,y:n},i))&&s%2==1))return this.__corner=r,r;return!1},forEachControl:function(a){for(var u in this.controls)a(this.controls[u],u,this)},_setCornerCoords:function(){var a=this.oCoords;for(var u in a){var h=this.controls[u];a[u].corner=h.calcCornerCoords(this.angle,this.cornerSize,a[u].x,a[u].y,!1),a[u].touchCorner=h.calcCornerCoords(this.angle,this.touchCornerSize,a[u].x,a[u].y,!0)}},drawSelectionBackground:function(a){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;a.save();var u=this.getCenterPoint(),h=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return a.translate(u.x,u.y),a.scale(1/n[0],1/n[3]),a.rotate(p(this.angle)),a.fillStyle=this.selectionBackgroundColor,a.fillRect(-h.x/2,-h.y/2,h.x,h.y),a.restore(),this},drawBorders:function(a,u){u=u||{};var h=this._calculateCurrentDimensions(),n=this.borderScaleFactor,s=h.x+n,i=h.y+n,o=typeof u.hasControls<"u"?u.hasControls:this.hasControls,c=!1;return a.save(),a.strokeStyle=u.borderColor||this.borderColor,this._setLineDash(a,u.borderDashArray||this.borderDashArray),a.strokeRect(-s/2,-i/2,s,i),o&&(a.beginPath(),this.forEachControl(function(r,f,m){r.withConnection&&r.getVisibility(m,f)&&(c=!0,a.moveTo(r.x*s,r.y*i),a.lineTo(r.x*s+r.offsetX,r.y*i+r.offsetY))}),c&&a.stroke()),a.restore(),this},drawBordersInGroup:function(a,u,h){h=h||{};var n=_.util.sizeAfterTransform(this.width,this.height,u),s=this.strokeWidth,i=this.strokeUniform,o=this.borderScaleFactor,c=n.x+s*(i?this.canvas.getZoom():u.scaleX)+o,r=n.y+s*(i?this.canvas.getZoom():u.scaleY)+o;return a.save(),this._setLineDash(a,h.borderDashArray||this.borderDashArray),a.strokeStyle=h.borderColor||this.borderColor,a.strokeRect(-c/2,-r/2,c,r),a.restore(),this},drawControls:function(a,u){u=u||{},a.save();var n,s,h=this.canvas.getRetinaScaling();return a.setTransform(h,0,0,h,0,0),a.strokeStyle=a.fillStyle=u.cornerColor||this.cornerColor,this.transparentCorners||(a.strokeStyle=u.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(a,u.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(n=this.group.calcTransformMatrix()),this.forEachControl(function(i,o,c){s=c.oCoords[o],i.getVisibility(c,o)&&(n&&(s=_.util.transformPoint(s,n)),i.render(a,s.x,s.y,u,c))}),a.restore(),this},isControlVisible:function(a){return this.controls[a]&&this.controls[a].getVisibility(this,a)},setControlVisible:function(a,u){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[a]=u,this},setControlsVisibility:function(a){for(var u in a||(a={}),a)this.setControlVisible(u,a[u]);return this},onDeselect:function(){},onSelect:function(){}})}(),_.util.object.extend(_.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(p,a){var u=function(){},h=(a=a||{}).onComplete||u,n=a.onChange||u,s=this;return _.util.animate({target:this,startValue:p.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(i){p.set("left",i),s.requestRenderAll(),n()},onComplete:function(){p.setCoords(),h()}})},fxCenterObjectV:function(p,a){var u=function(){},h=(a=a||{}).onComplete||u,n=a.onChange||u,s=this;return _.util.animate({target:this,startValue:p.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(i){p.set("top",i),s.requestRenderAll(),n()},onComplete:function(){p.setCoords(),h()}})},fxRemove:function(p,a){var u=function(){},h=(a=a||{}).onComplete||u,n=a.onChange||u,s=this;return _.util.animate({target:this,startValue:p.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(i){p.set("opacity",i),s.requestRenderAll(),n()},onComplete:function(){s.remove(p),h()}})}}),_.util.object.extend(_.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var a,p=[],h=[];for(a in arguments[0])p.push(a);for(var n=0,s=p.length;n<s;n++)h.push(this._animate(a=p[n],arguments[0][a],arguments[1],n!==s-1));return h}return this._animate.apply(this,arguments)},_animate:function(p,a,u,h){var s,n=this;a=a.toString(),u=u?_.util.object.clone(u):{},~p.indexOf(".")&&(s=p.split("."));var i=n.colorProperties.indexOf(p)>-1||s&&n.colorProperties.indexOf(s[1])>-1,o=s?this.get(s[0])[s[1]]:this.get(p);"from"in u||(u.from=o),i||(a=~a.indexOf("=")?o+parseFloat(a.replace("=","")):parseFloat(a));var c={target:this,startValue:u.from,endValue:a,byValue:u.by,easing:u.easing,duration:u.duration,abort:u.abort&&function(r,f,m){return u.abort.call(n,r,f,m)},onChange:function(r,f,m){s?n[s[0]][s[1]]=r:n.set(p,r),!h&&u.onChange&&u.onChange(r,f,m)},onComplete:function(r,f,m){h||(n.setCoords(),u.onComplete&&u.onComplete(r,f,m))}};return i?_.util.animateColor(c.startValue,c.endValue,c.duration,c):_.util.animate(c)}}),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.extend,h=a.util.object.clone,n={x1:1,x2:1,y1:1,y2:1};function s(i,o){var c=i.origin,r=i.axis1,f=i.axis2,m=i.dimension,v=o.nearest,y=o.center,x=o.farthest;return function(){switch(this.get(c)){case v:return Math.min(this.get(r),this.get(f));case y:return Math.min(this.get(r),this.get(f))+.5*this.get(m);case x:return Math.max(this.get(r),this.get(f))}}}a.Line?a.warn("fabric.Line is already defined"):(a.Line=a.util.createClass(a.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:a.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,o){i||(i=[0,0,0,0]),this.callSuper("initialize",o),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(o)},_setWidthHeight:function(i){i||(i={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in i?i.left:this._getLeftToOriginX(),this.top="top"in i?i.top:this._getTopToOriginY()},_set:function(i,o){return this.callSuper("_set",i,o),typeof n[i]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(i){i.beginPath();var o=this.calcLinePoints();i.moveTo(o.x1,o.y1),i.lineTo(o.x2,o.y2),i.lineWidth=this.strokeWidth;var c=i.strokeStyle;i.strokeStyle=this.stroke||i.fillStyle,this.stroke&&this._renderStroke(i),i.strokeStyle=c},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(i){return u(this.callSuper("toObject",i),this.calcLinePoints())},_getNonTransformedDimensions:function(){var i=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(i.y-=this.strokeWidth),0===this.height&&(i.x-=this.strokeWidth)),i},calcLinePoints:function(){var i=this.x1<=this.x2?-1:1,o=this.y1<=this.y2?-1:1;return{x1:i*this.width*.5,x2:i*this.width*-.5,y1:o*this.height*.5,y2:o*this.height*-.5}},_toSVG:function(){var i=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" />\n']}}),a.Line.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),a.Line.fromElement=function(i,o,c){c=c||{};var r=a.parseAttributes(i,a.Line.ATTRIBUTE_NAMES);o(new a.Line([r.x1||0,r.y1||0,r.x2||0,r.y2||0],u(r,c)))},a.Line.fromObject=function(i,o){var r=h(i,!0);r.points=[i.x1,i.y1,i.x2,i.y2],a.Object._fromObject("Line",r,function c(f){delete f.points,o&&o(f)},"points")})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.degreesToRadians;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:a.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(n,s){return this.callSuper("_set",n,s),"radius"===n&&this.setRadius(s),this},toObject:function(n){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(n))},_toSVG:function(){var n,o=(this.endAngle-this.startAngle)%360;if(0===o)n=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var c=u(this.startAngle),r=u(this.endAngle),f=this.radius;n=['<path d="M '+a.util.cos(c)*f+" "+a.util.sin(c)*f," A "+f+" "+f," 0 ",+(o>180?"1":"0")+" 1"," "+a.util.cos(r)*f+" "+a.util.sin(r)*f,'" ',"COMMON_PARTS"," />\n"]}return n},_render:function(n){n.beginPath(),n.arc(0,0,this.radius,u(this.startAngle),u(this.endAngle),!1),this._renderPaintInOrder(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){return this.radius=n,this.set("width",2*n).set("height",2*n)}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(n,s){var i=a.parseAttributes(n,a.Circle.ATTRIBUTE_NAMES);if(!function h(n){return"radius"in n&&n.radius>=0}(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,s(new a.Circle(i))},a.Circle.fromObject=function(n,s){a.Object._fromObject("Circle",n,s)})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",width:100,height:100,_render:function(u){var h=this.width/2,n=this.height/2;u.beginPath(),u.moveTo(-h,n),u.lineTo(0,-n),u.lineTo(h,n),u.closePath(),this._renderPaintInOrder(u)},_toSVG:function(){var u=this.width/2,h=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-u+" "+h,"0 "+-h,u+" "+h].join(","),'" />']}}),a.Triangle.fromObject=function(u,h){return a.Object._fromObject("Triangle",u,h)})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=2*Math.PI;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(h){this.callSuper("initialize",h),this.set("rx",h&&h.rx||0),this.set("ry",h&&h.ry||0)},_set:function(h,n){switch(this.callSuper("_set",h,n),h){case"rx":this.rx=n,this.set("width",2*n);break;case"ry":this.ry=n,this.set("height",2*n)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(h){return this.callSuper("toObject",["rx","ry"].concat(h))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(h){h.beginPath(),h.save(),h.transform(1,0,0,this.ry/this.rx,0,0),h.arc(0,0,this.rx,0,u,!1),h.restore(),this._renderPaintInOrder(h)}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),a.Ellipse.fromElement=function(h,n){var s=a.parseAttributes(h,a.Ellipse.ATTRIBUTE_NAMES);s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,n(new a.Ellipse(s))},a.Ellipse.fromObject=function(h,n){a.Object._fromObject("Ellipse",h,n)})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.extend;a.Rect?a.warn("fabric.Rect is already defined"):(a.Rect=a.util.createClass(a.Object,{stateProperties:a.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(h){this.callSuper("initialize",h),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(h){var n=this.rx?Math.min(this.rx,this.width/2):0,s=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,o=this.height,c=-this.width/2,r=-this.height/2,f=0!==n||0!==s,m=.4477152502;h.beginPath(),h.moveTo(c+n,r),h.lineTo(c+i-n,r),f&&h.bezierCurveTo(c+i-m*n,r,c+i,r+m*s,c+i,r+s),h.lineTo(c+i,r+o-s),f&&h.bezierCurveTo(c+i,r+o-m*s,c+i-m*n,r+o,c+i-n,r+o),h.lineTo(c+n,r+o),f&&h.bezierCurveTo(c+m*n,r+o,c,r+o-m*s,c,r+o-s),h.lineTo(c,r+s),f&&h.bezierCurveTo(c,r+m*s,c+m*n,r,c+n,r),h.closePath(),this._renderPaintInOrder(h)},toObject:function(h){return this.callSuper("toObject",["rx","ry"].concat(h))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=function(h,n,s){if(!h)return n(null);s=s||{};var i=a.parseAttributes(h,a.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0,i.height=i.height||0,i.width=i.width||0;var o=new a.Rect(u(s?a.util.object.clone(s):{},i));o.visible=o.visible&&o.width>0&&o.height>0,n(o)},a.Rect.fromObject=function(h,n){return a.Object._fromObject("Rect",h,n)})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.extend,h=a.util.array.min,n=a.util.array.max,s=a.util.toFixed,i=a.util.projectStrokeOnPoints;a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:a.Object.prototype.cacheProperties.concat("points"),initialize:function(o,c){c=c||{},this.points=o||[],this.callSuper("initialize",c),this._setPositionDimensions(c)},_projectStrokeOnPoints:function(){return i(this.points,this,!0)},_setPositionDimensions:function(o){var r,c=this._calcDimensions(o),f=this.exactBoundingBox?this.strokeWidth:0;this.width=c.width-f,this.height=c.height-f,o.fromSVG||(r=this.translateToGivenOrigin({x:c.left-this.strokeWidth/2+f/2,y:c.top-this.strokeWidth/2+f/2},"left","top",this.originX,this.originY)),typeof o.left>"u"&&(this.left=o.fromSVG?c.left:r.x),typeof o.top>"u"&&(this.top=o.fromSVG?c.top:r.y),this.pathOffset={x:c.left+this.width/2+f/2,y:c.top+this.height/2+f/2}},_calcDimensions:function(){var o=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,c=h(o,"x")||0,r=h(o,"y")||0;return{left:c,top:r,width:(n(o,"x")||0)-c,height:(n(o,"y")||0)-r}},toObject:function(o){return u(this.callSuper("toObject",o),{points:this.points.concat()})},_toSVG:function(){for(var o=[],c=this.pathOffset.x,r=this.pathOffset.y,f=a.Object.NUM_FRACTION_DIGITS,m=0,v=this.points.length;m<v;m++)o.push(s(this.points[m].x-c,f),",",s(this.points[m].y-r,f)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',o.join(""),'" />\n']},commonRender:function(o){var c,r=this.points.length,f=this.pathOffset.x,m=this.pathOffset.y;if(!r||isNaN(this.points[r-1].y))return!1;o.beginPath(),o.moveTo(this.points[0].x-f,this.points[0].y-m);for(var v=0;v<r;v++)o.lineTo((c=this.points[v]).x-f,c.y-m);return!0},_render:function(o){!this.commonRender(o)||this._renderPaintInOrder(o)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElementGenerator=function(o){return function(c,r,f){if(!c)return r(null);f||(f={});var m=a.parsePointsAttribute(c.getAttribute("points")),v=a.parseAttributes(c,a[o].ATTRIBUTE_NAMES);v.fromSVG=!0,r(new a[o](m,u(v,f)))}},a.Polyline.fromElement=a.Polyline.fromElementGenerator("Polyline"),a.Polyline.fromObject=function(o,c){return a.Object._fromObject("Polyline",o,c,"points")})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.projectStrokeOnPoints;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return u(this.points,this)},_render:function(h){!this.commonRender(h)||(h.closePath(),this._renderPaintInOrder(h))}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=a.Polyline.fromElementGenerator("Polygon"),a.Polygon.fromObject=function(h,n){a.Object._fromObject("Polygon",h,n,"points")})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.array.min,h=a.util.array.max,n=a.util.object.extend,s=a.util.object.clone,i=a.util.toFixed;a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,cacheProperties:a.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:a.Object.prototype.stateProperties.concat("path"),initialize:function(o,c){delete(c=s(c||{})).path,this.callSuper("initialize",c),this._setPath(o||[],c)},_setPath:function(o,c){this.path=a.util.makePathSimpler(Array.isArray(o)?o:a.util.parsePath(o)),a.Polyline.prototype._setPositionDimensions.call(this,c||{})},_renderPathCommands:function(o){var c,r=0,f=0,m=0,v=0,w=-this.pathOffset.x,O=-this.pathOffset.y;o.beginPath();for(var P=0,X=this.path.length;P<X;++P)switch(c=this.path[P],c[0]){case"L":o.lineTo((m=c[1])+w,(v=c[2])+O);break;case"M":r=m=c[1],f=v=c[2],o.moveTo(m+w,v+O);break;case"C":o.bezierCurveTo(c[1]+w,c[2]+O,c[3]+w,c[4]+O,(m=c[5])+w,(v=c[6])+O);break;case"Q":o.quadraticCurveTo(c[1]+w,c[2]+O,c[3]+w,c[4]+O),m=c[3],v=c[4];break;case"z":case"Z":m=r,v=f,o.closePath()}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return n(this.callSuper("toObject",o),{path:this.path.map(function(c){return c.slice()})})},toDatalessObject:function(o){var c=this.toObject(["sourcePath"].concat(o));return c.sourcePath&&delete c.path,c},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',a.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var o=a.Object.NUM_FRACTION_DIGITS;return" translate("+i(-this.pathOffset.x,o)+", "+i(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var c=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:c})},toSVG:function(o){var c=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:c})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var r,x,o=[],c=[],f=0,m=0,v=0,y=0,w=0,O=this.path.length;w<O;++w){switch((r=this.path[w])[0]){case"L":v=r[1],y=r[2],x=[];break;case"M":f=v=r[1],m=y=r[2],x=[];break;case"C":x=a.util.getBoundsOfCurve(v,y,r[1],r[2],r[3],r[4],r[5],r[6]),v=r[5],y=r[6];break;case"Q":x=a.util.getBoundsOfCurve(v,y,r[1],r[2],r[1],r[2],r[3],r[4]),v=r[3],y=r[4];break;case"z":case"Z":v=f,y=m}x.forEach(function(et){o.push(et.x),c.push(et.y)}),o.push(v),c.push(y)}var P=u(o)||0,X=u(c)||0;return{left:P,top:X,width:(h(o)||0)-P,height:(h(c)||0)-X}}}),a.Path.fromObject=function(o,c){"string"==typeof o.sourcePath?a.loadSVGFromURL(o.sourcePath,function(f){var m=f[0];m.setOptions(o),o.clipPath?a.util.enlivenObjects([o.clipPath],function(v){m.clipPath=v[0],c&&c(m)}):c&&c(m)}):a.Object._fromObject("Path",o,c,"path")},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(o,c,r){var f=a.parseAttributes(o,a.Path.ATTRIBUTE_NAMES);f.fromSVG=!0,c(new a.Path(f.d,n(f,r)))})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.array.min,h=a.util.array.max;a.Group||(a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(n,s,i){s=s||{},this._objects=[],i&&this.callSuper("initialize",s),this._objects=n||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;if(i)this._updateObjectsACoords();else{var c=s&&s.centerPoint;void 0!==s.originX&&(this.originX=s.originX),void 0!==s.originY&&(this.originY=s.originY),c||this._calcBounds(),this._updateObjectsCoords(c),delete s.centerPoint,this.callSuper("initialize",s)}this.setCoords()},_updateObjectsACoords:function(){for(var s=this._objects.length;s--;)this._objects[s].setCoords(!0)},_updateObjectsCoords:function(s){s=s||this.getCenterPoint();for(var i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],s)},_updateObjectCoords:function(n,s){n.set({left:n.left-s.x,top:n.top-s.y}),n.group=this,n.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){var s=!!this.group;return this._restoreObjectsState(),a.util.resetObjectTransform(this),n&&(s&&a.util.removeTransformFromObject(n,this.group.calcTransformMatrix()),this._objects.push(n),n.group=this,n._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,s?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(n){return this._restoreObjectsState(),a.util.resetObjectTransform(this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(n){this.dirty=!0,n.group=this,n._set("canvas",this.canvas)},_onObjectRemoved:function(n){this.dirty=!0,delete n.group},_set:function(n,s){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(n,s);if("canvas"===n)for(;i--;)this._objects[i]._set(n,s);a.Object.prototype._set.call(this,n,s)},toObject:function(n){var s=this.includeDefaultValues,i=this._objects.filter(function(c){return!c.excludeFromExport}).map(function(c){var r=c.includeDefaultValues;c.includeDefaultValues=s;var f=c.toObject(n);return c.includeDefaultValues=r,f}),o=a.Object.prototype.toObject.call(this,n);return o.objects=i,o},toDatalessObject:function(n){var s,i=this.sourcePath;if(i)s=i;else{var o=this.includeDefaultValues;s=this._objects.map(function(r){var f=r.includeDefaultValues;r.includeDefaultValues=o;var m=r.toDatalessObject(n);return r.includeDefaultValues=f,m})}var c=a.Object.prototype.toDatalessObject.call(this,n);return c.objects=s,c},render:function(n){this._transformDone=!0,this.callSuper("render",n),this._transformDone=!1},shouldCache:function(){var n=a.Object.prototype.shouldCache.call(this);if(n)for(var s=0,i=this._objects.length;s<i;s++)if(this._objects[s].willDrawShadow())return this.ownCaching=!1,!1;return n},willDrawShadow:function(){if(a.Object.prototype.willDrawShadow.call(this))return!0;for(var n=0,s=this._objects.length;n<s;n++)if(this._objects[n].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(n){for(var s=0,i=this._objects.length;s<i;s++)this._objects[s].render(n);this._drawClipPath(n,this.clipPath)},isCacheDirty:function(n){if(this.callSuper("isCacheDirty",n))return!0;if(!this.statefullCache)return!1;for(var s=0,i=this._objects.length;s<i;s++)if(this._objects[s].isCacheDirty(!0)){if(this._cacheCanvas){var o=this.cacheWidth/this.zoomX,c=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-o/2,-c/2,o,c)}return!0}return!1},_restoreObjectsState:function(){var n=this.calcOwnMatrix();return this._objects.forEach(function(s){a.util.addTransformToObject(s,n),delete s.group,s.setCoords()}),this},destroy:function(){return this._objects.forEach(function(n){n.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(n){n.dispose&&n.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var n=this._objects,s=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var o=new a.ActiveSelection([]);return o.set(i),o.type="activeSelection",s.remove(this),n.forEach(function(c){c.group=o,c.dirty=!0,s.add(c)}),o.canvas=s,o._objects=n,s._activeObject=o,o.setCoords(),o}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(s){s.setCoords(!0)}),this},_calcBounds:function(n){for(var o,c,r,y,s=[],i=[],f=["tr","br","bl","tl"],m=0,v=this._objects.length,x=f.length;m<v;++m){for(r=(o=this._objects[m]).calcACoords(),y=0;y<x;y++)s.push(r[c=f[y]].x),i.push(r[c].y);o.aCoords=r}this._getBounds(s,i,n)},_getBounds:function(n,s,i){var o=new a.Point(u(n),u(s)),c=new a.Point(h(n),h(s)),r=o.y||0,f=o.x||0,v=c.y-o.y||0;this.width=c.x-o.x||0,this.height=v,i||this.setPositionByOrigin({x:f,y:r},"left","top")},_toSVG:function(n){for(var s=["<g ","COMMON_PARTS"," >\n"],i=0,o=this._objects.length;i<o;i++)s.push("\t\t",this._objects[i].toSVG(n));return s.push("</g>\n"),s},getSvgStyles:function(){var s=this.visible?"":" visibility: hidden;";return[typeof this.opacity<"u"&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),s].join("")},toClipPathSVG:function(n){for(var s=[],i=0,o=this._objects.length;i<o;i++)s.push("\t",this._objects[i].toClipPathSVG(n));return this._createBaseClipPathSVGMarkup(s,{reviver:n})}}),a.Group.fromObject=function(n,s){var i=n.objects,o=a.util.object.clone(n,!0);delete o.objects,"string"!=typeof i?a.util.enlivenObjects(i,function(c){a.util.enlivenObjectEnlivables(n,o,function(){s&&s(new a.Group(c,o,!0))})}):a.loadSVGFromURL(i,function(c){var r=a.util.groupSVGElements(c,n,i),f=o.clipPath;delete o.clipPath,r.set(o),f?a.util.enlivenObjects([f],function(m){r.clipPath=m[0],s&&s(r)}):s&&s(r)})})}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={});a.ActiveSelection||(a.ActiveSelection=a.util.createClass(a.Group,{type:"activeSelection",initialize:function(u,h){h=h||{},this._objects=u||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;h.originX&&(this.originX=h.originX),h.originY&&(this.originY=h.originY),this._calcBounds(),this._updateObjectsCoords(),a.Object.prototype.initialize.call(this,h),this.setCoords()},toGroup:function(){var u=this._objects.concat();this._objects=[];var h=a.Object.prototype.toObject.call(this),n=new a.Group([]);if(delete h.type,n.set(h),u.forEach(function(i){i.canvas.remove(i),i.group=n}),n._objects=u,!this.canvas)return n;var s=this.canvas;return s.add(n),s._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(u,h,n){u.save(),u.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",u,h),typeof(n=n||{}).hasControls>"u"&&(n.hasControls=!1),n.forActiveSelection=!0;for(var s=0,i=this._objects.length;s<i;s++)this._objects[s]._renderControls(u,n);u.restore()}}),a.ActiveSelection.fromObject=function(u,h){a.util.enlivenObjects(u.objects,function(n){delete u.objects,h&&h(new a.ActiveSelection(n,u,!0))})})}(yt),function(p){"use strict";var a=_.util.object.extend;p.fabric||(p.fabric={}),p.fabric.Image?_.warn("fabric.Image is already defined."):(_.Image=_.util.createClass(_.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:_.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:_.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(u,h){h||(h={}),this.filters=[],this.cacheKey="texture"+_.Object.__uid++,this.callSuper("initialize",h),this._initElement(u,h)},getElement:function(){return this._element||{}},setElement:function(u,h){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=u,this._originalElement=u,this._initConfig(h),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(u){var h=_.filterBackend;h&&h.evictCachesForKey&&h.evictCachesForKey(u)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(u){_.util.cleanUpJsdomNode(this[u]),this[u]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var u=this.getElement();return{width:u.naturalWidth||u.width,height:u.naturalHeight||u.height}},_stroke:function(u){if(this.stroke&&0!==this.strokeWidth){var h=this.width/2,n=this.height/2;u.beginPath(),u.moveTo(-h,-n),u.lineTo(h,-n),u.lineTo(h,n),u.lineTo(-h,n),u.lineTo(-h,-n),u.closePath()}},toObject:function(u){var h=[];this.filters.forEach(function(s){s&&h.push(s.toObject())});var n=a(this.callSuper("toObject",["cropX","cropY"].concat(u)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:h});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var n,u=[],h=[],s=this._element,i=-this.width/2,o=-this.height/2,c="",r="";if(!s)return[];if(this.hasCrop()){var f=_.Object.__uid++;u.push('<clipPath id="imageCrop_'+f+'">\n','\t<rect x="'+i+'" y="'+o+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),c=' clip-path="url(#imageCrop_'+f+')" '}if(this.imageSmoothing||(r='" image-rendering="optimizeSpeed'),h.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',o-this.cropY,'" width="',s.width||s.naturalWidth,'" height="',s.height||s.height,r,'"',c,"></image>\n"),this.stroke||this.strokeDashArray){var m=this.fill;this.fill=null,n=["\t<rect ",'x="',i,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=m}return"fill"!==this.paintFirst?u.concat(n,h):u.concat(h,n)},getSrc:function(u){var h=u?this._element:this._originalElement;return h?h.toDataURL?h.toDataURL():this.srcFromAttribute?h.getAttribute("src"):h.src:this.src||""},setSrc:function(u,h,n){return _.util.loadImage(u,function(s,i){this.setElement(s,n),this._setWidthHeight(),h&&h(this,i)},this,n&&n.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var u=this.resizeFilter,h=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),s=n.scaleX,i=n.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!u||s>h&&i>h)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,void(this._lastScaleY=i);_.filterBackend||(_.filterBackend=_.initFilterBackend());var c=_.util.createCanvasElement(),r=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,f=o.width,m=o.height;c.width=f,c.height=m,this._element=c,this._lastScaleX=u.scaleX=s,this._lastScaleY=u.scaleY=i,_.filterBackend.applyFilters([u],o,f,m,this._element,r),this._filterScalingX=c.width/this._originalElement.width,this._filterScalingY=c.height/this._originalElement.height},applyFilters:function(u){if(u=(u=u||this.filters||[]).filter(function(o){return o&&!o.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===u.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var h=this._originalElement,n=h.naturalWidth||h.width,s=h.naturalHeight||h.height;if(this._element===this._originalElement){var i=_.util.createCanvasElement();i.width=n,i.height=s,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,s),this._lastScaleX=1,this._lastScaleY=1;return _.filterBackend||(_.filterBackend=_.initFilterBackend()),_.filterBackend.applyFilters(u,this._originalElement,n,s,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(u){_.util.setImageSmoothing(u,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(u),this._renderPaintInOrder(u)},drawCacheOnCanvas:function(u){_.util.setImageSmoothing(u,this.imageSmoothing),_.Object.prototype.drawCacheOnCanvas.call(this,u)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(u){var h=this._element;if(h){var n=this._filterScalingX,s=this._filterScalingY,i=this.width,o=this.height,c=Math.min,r=Math.max,f=r(this.cropX,0),m=r(this.cropY,0),v=h.naturalWidth||h.width,y=h.naturalHeight||h.height,x=f*n,w=m*s,O=c(i*n,v-x),P=c(o*s,y-w),X=-i/2,$=-o/2,tt=c(i,v/n-f),at=c(o,y/s-m);h&&u.drawImage(h,x,w,O,P,X,$,tt,at)}},_needsResize:function(){var u=this.getTotalObjectScaling();return u.scaleX!==this._lastScaleX||u.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(u,h){this.setElement(_.util.getById(u),h),_.util.addClass(this.getElement(),_.Image.CSS_CANVAS)},_initConfig:function(u){u||(u={}),this.setOptions(u),this._setWidthHeight(u)},_initFilters:function(u,h){u&&u.length?_.util.enlivenObjects(u,function(n){h&&h(n)},"fabric.Image.filters"):h&&h()},_setWidthHeight:function(u){u||(u={});var h=this.getElement();this.width=u.width||h.naturalWidth||h.width||0,this.height=u.height||h.naturalHeight||h.height||0},parsePreserveAspectRatioAttribute:function(){var m,u=_.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),h=this._element.width,n=this._element.height,s=1,i=1,o=0,c=0,r=0,f=0,v=this.width,y=this.height,x={width:v,height:y};return!u||"none"===u.alignX&&"none"===u.alignY?(s=v/h,i=y/n):("meet"===u.meetOrSlice&&(m=(v-h*(s=i=_.util.findScaleToFit(this._element,x)))/2,"Min"===u.alignX&&(o=-m),"Max"===u.alignX&&(o=m),m=(y-n*i)/2,"Min"===u.alignY&&(c=-m),"Max"===u.alignY&&(c=m)),"slice"===u.meetOrSlice&&(m=h-v/(s=i=_.util.findScaleToCover(this._element,x)),"Mid"===u.alignX&&(r=m/2),"Max"===u.alignX&&(r=m),m=n-y/i,"Mid"===u.alignY&&(f=m/2),"Max"===u.alignY&&(f=m),h=v/s,n=y/i)),{width:h,height:n,scaleX:s,scaleY:i,offsetLeft:o,offsetTop:c,cropX:r,cropY:f}}}),_.Image.CSS_CANVAS="canvas-img",_.Image.prototype.getSvgSrc=_.Image.prototype.getSrc,_.Image.fromObject=function(u,h){var n=_.util.object.clone(u);_.util.loadImage(n.src,function(s,i){i?h&&h(null,!0):_.Image.prototype._initFilters.call(n,n.filters,function(o){n.filters=o||[],_.Image.prototype._initFilters.call(n,[n.resizeFilter],function(c){n.resizeFilter=c[0],_.util.enlivenObjectEnlivables(n,n,function(){var r=new _.Image(s,n);h(r,!1)})})})},null,n.crossOrigin)},_.Image.fromURL=function(u,h,n){_.util.loadImage(u,function(s,i){h&&h(new _.Image(s,n),i)},null,n&&n.crossOrigin)},_.Image.ATTRIBUTE_NAMES=_.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),_.Image.fromElement=function(u,h,n){var s=_.parseAttributes(u,_.Image.ATTRIBUTE_NAMES);_.Image.fromURL(s["xlink:href"],h,a(n?_.util.object.clone(n):{},s))})}(yt),_.util.object.extend(_.Object.prototype,{_getAngleValueForStraighten:function(){var p=this.angle%360;return p>0?90*Math.round((p-1)/90):90*Math.round(p/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(p){var a=function(){},u=(p=p||{}).onComplete||a,h=p.onChange||a,n=this;return _.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){n.rotate(s),h()},onComplete:function(){n.setCoords(),u()}})}}),_.util.object.extend(_.StaticCanvas.prototype,{straightenObject:function(p){return p.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(p){return p.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){"use strict";function p(u,h){var n="precision "+h+" float;\nvoid main(){}",s=u.createShader(u.FRAGMENT_SHADER);return u.shaderSource(s,n),u.compileShader(s),!!u.getShaderParameter(s,u.COMPILE_STATUS)}function a(u){u&&u.tileSize&&(this.tileSize=u.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}_.isWebglSupported=function(u){if(_.isLikelyNode)return!1;u=u||_.WebglFilterBackend.prototype.tileSize;var h=document.createElement("canvas"),n=h.getContext("webgl")||h.getContext("experimental-webgl"),s=!1;if(n){_.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),s=_.maxTextureSize>=u;for(var i=["highp","mediump","lowp"],o=0;o<3;o++)if(p(n,i[o])){_.webGlPrecision=i[o];break}}return this.isSupported=s,s},_.WebglFilterBackend=a,a.prototype={tileSize:2048,resources:{},setupGLContext:function(u,h){this.dispose(),this.createWebGLCanvas(u,h),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(u,h)},chooseFastestCopyGLTo2DMethod:function(u,h){var s,n=typeof window.performance<"u";try{new ImageData(1,1),s=!0}catch{s=!1}var i=typeof ArrayBuffer<"u",o=typeof Uint8ClampedArray<"u";if(n&&s&&i&&o){var c=_.util.createCanvasElement(),r=new ArrayBuffer(u*h*4);if(_.forceGLPutImageData)return this.imageBuffer=r,void(this.copyGLTo2D=Nt);var m,v,f={imageBuffer:r,destinationWidth:u,destinationHeight:h,targetCanvas:c};c.width=u,c.height=h,m=window.performance.now(),Me.call(f,this.gl,f),v=window.performance.now()-m,m=window.performance.now(),Nt.call(f,this.gl,f),v>window.performance.now()-m?(this.imageBuffer=r,this.copyGLTo2D=Nt):this.copyGLTo2D=Me}},createWebGLCanvas:function(u,h){var n=_.util.createCanvasElement();n.width=u,n.height=h;var s={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=n.getContext("webgl",s);i||(i=n.getContext("experimental-webgl",s)),i&&(i.clearColor(0,0,0,0),this.canvas=n,this.gl=i)},applyFilters:function(u,h,n,s,i,o){var r,c=this.gl;o&&(r=this.getCachedTexture(o,h));var f={originalWidth:h.width||h.originalWidth,originalHeight:h.height||h.originalHeight,sourceWidth:n,sourceHeight:s,destinationWidth:n,destinationHeight:s,context:c,sourceTexture:this.createTexture(c,n,s,!r&&h),targetTexture:this.createTexture(c,n,s),originalTexture:r||this.createTexture(c,n,s,!r&&h),passes:u.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},m=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,m),u.forEach(function(v){v&&v.applyTo(f)}),function At(p){var a=p.targetCanvas,n=p.destinationWidth,s=p.destinationHeight;(a.width!==n||a.height!==s)&&(a.width=n,a.height=s)}(f),this.copyGLTo2D(c,f),c.bindTexture(c.TEXTURE_2D,null),c.deleteTexture(f.sourceTexture),c.deleteTexture(f.targetTexture),c.deleteFramebuffer(m),i.getContext("2d").setTransform(1,0,0,1,0,0),f},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(u,h,n,s,i){var o=u.createTexture();return u.bindTexture(u.TEXTURE_2D,o),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),s?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,s):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,h,n,0,u.RGBA,u.UNSIGNED_BYTE,null),o},getCachedTexture:function(u,h){if(this.textureCache[u])return this.textureCache[u];var n=this.createTexture(this.gl,h.width,h.height,h);return this.textureCache[u]=n,n},evictCachesForKey:function(u){this.textureCache[u]&&(this.gl.deleteTexture(this.textureCache[u]),delete this.textureCache[u])},copyGLTo2D:Me,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var u=this.gl,h={renderer:"",vendor:""};if(!u)return h;var n=u.getExtension("WEBGL_debug_renderer_info");if(n){var s=u.getParameter(n.UNMASKED_RENDERER_WEBGL),i=u.getParameter(n.UNMASKED_VENDOR_WEBGL);s&&(h.renderer=s.toLowerCase()),i&&(h.vendor=i.toLowerCase())}return this.gpuInfo=h,h}}}(),function(){"use strict";var p=function(){};function a(){}_.Canvas2dFilterBackend=a,a.prototype={evictCachesForKey:p,dispose:p,clearWebGLCaches:p,resources:{},applyFilters:function(u,h,n,s,i){var o=i.getContext("2d");o.drawImage(h,0,0,n,s);var f={sourceWidth:n,sourceHeight:s,imageData:o.getImageData(0,0,n,s),originalEl:h,originalImageData:o.getImageData(0,0,n,s),canvasEl:i,ctx:o,filterBackend:this};return u.forEach(function(m){m.applyTo(f)}),(f.imageData.width!==n||f.imageData.height!==s)&&(i.width=f.imageData.width,i.height=f.imageData.height),o.putImageData(f.imageData,0,0),f}}}(),_.Image=_.Image||{},_.Image.filters=_.Image.filters||{},_.Image.filters.BaseFilter=_.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(p){p&&this.setOptions(p)},setOptions:function(p){for(var a in p)this[a]=p[a]},createProgram:function(p,a,u){a=a||this.fragmentSource,u=u||this.vertexSource,"highp"!==_.webGlPrecision&&(a=a.replace(/precision highp float/g,"precision "+_.webGlPrecision+" float"));var h=p.createShader(p.VERTEX_SHADER);if(p.shaderSource(h,u),p.compileShader(h),!p.getShaderParameter(h,p.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+p.getShaderInfoLog(h));var n=p.createShader(p.FRAGMENT_SHADER);if(p.shaderSource(n,a),p.compileShader(n),!p.getShaderParameter(n,p.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+p.getShaderInfoLog(n));var s=p.createProgram();if(p.attachShader(s,h),p.attachShader(s,n),p.linkProgram(s),!p.getProgramParameter(s,p.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+p.getProgramInfoLog(s));var i=this.getAttributeLocations(p,s),o=this.getUniformLocations(p,s)||{};return o.uStepW=p.getUniformLocation(s,"uStepW"),o.uStepH=p.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:i,uniformLocations:o}},getAttributeLocations:function(p,a){return{aPosition:p.getAttribLocation(a,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(p,a,u){var h=a.aPosition,n=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,n),p.enableVertexAttribArray(h),p.vertexAttribPointer(h,2,p.FLOAT,!1,0,0),p.bufferData(p.ARRAY_BUFFER,u,p.STATIC_DRAW)},_setupFrameBuffer:function(p){var u,h,a=p.context;p.passes>1?(h=p.destinationHeight,(p.sourceWidth!==(u=p.destinationWidth)||p.sourceHeight!==h)&&(a.deleteTexture(p.targetTexture),p.targetTexture=p.filterBackend.createTexture(a,u,h)),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,p.targetTexture,0)):(a.bindFramebuffer(a.FRAMEBUFFER,null),a.finish())},_swapTextures:function(p){p.passes--,p.pass++;var a=p.targetTexture;p.targetTexture=p.sourceTexture,p.sourceTexture=a},isNeutralState:function(){var p=this.mainParameter,a=_.Image.filters[this.type].prototype;if(p){if(Array.isArray(a[p])){for(var u=a[p].length;u--;)if(this[p][u]!==a[p][u])return!1;return!0}return a[p]===this[p]}return!1},applyTo:function(p){p.webgl?(this._setupFrameBuffer(p),this.applyToWebGL(p),this._swapTextures(p)):this.applyTo2d(p)},retrieveShader:function(p){return p.programCache.hasOwnProperty(this.type)||(p.programCache[this.type]=this.createProgram(p.context)),p.programCache[this.type]},applyToWebGL:function(p){var a=p.context,u=this.retrieveShader(p);a.bindTexture(a.TEXTURE_2D,0===p.pass&&p.originalTexture?p.originalTexture:p.sourceTexture),a.useProgram(u.program),this.sendAttributeData(a,u.attributeLocations,p.aPosition),a.uniform1f(u.uniformLocations.uStepW,1/p.sourceWidth),a.uniform1f(u.uniformLocations.uStepH,1/p.sourceHeight),this.sendUniformData(a,u.uniformLocations),a.viewport(0,0,p.destinationWidth,p.destinationHeight),a.drawArrays(a.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(p,a,u){p.activeTexture(u),p.bindTexture(p.TEXTURE_2D,a),p.activeTexture(p.TEXTURE0)},unbindAdditionalTexture:function(p,a){p.activeTexture(a),p.bindTexture(p.TEXTURE_2D,null),p.activeTexture(p.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(p){this[this.mainParameter]=p},sendUniformData:function(){},createHelpLayer:function(p){if(!p.helpLayer){var a=document.createElement("canvas");a.width=p.sourceWidth,a.height=p.sourceHeight,p.helpLayer=a}},toObject:function(){var p={type:this.type},a=this.mainParameter;return a&&(p[a]=this[a]),p},toJSON:function(){return this.toObject()}}),_.Image.filters.BaseFilter.fromObject=function(p,a){var u=new _.Image.filters[p.type](p);return a&&a(u),u},function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.ColorMatrix=(0,a.util.createClass)(u.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(n){this.callSuper("initialize",n),this.matrix=this.matrix.slice(0)},applyTo2d:function(n){var r,f,m,v,y,i=n.imageData.data,o=i.length,c=this.matrix,x=this.colorsOnly;for(y=0;y<o;y+=4)r=i[y],f=i[y+1],m=i[y+2],x?(i[y]=r*c[0]+f*c[1]+m*c[2]+255*c[4],i[y+1]=r*c[5]+f*c[6]+m*c[7]+255*c[9],i[y+2]=r*c[10]+f*c[11]+m*c[12]+255*c[14]):(i[y]=r*c[0]+f*c[1]+m*c[2]+(v=i[y+3])*c[3]+255*c[4],i[y+1]=r*c[5]+f*c[6]+m*c[7]+v*c[8]+255*c[9],i[y+2]=r*c[10]+f*c[11]+m*c[12]+v*c[13]+255*c[14],i[y+3]=r*c[15]+f*c[16]+m*c[17]+v*c[18]+255*c[19])},getUniformLocations:function(n,s){return{uColorMatrix:n.getUniformLocation(s,"uColorMatrix"),uConstants:n.getUniformLocation(s,"uConstants")}},sendUniformData:function(n,s){var i=this.matrix,c=[i[4],i[9],i[14],i[19]];n.uniformMatrix4fv(s.uColorMatrix,!1,[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]]),n.uniform4fv(s.uConstants,c)}}),a.Image.filters.ColorMatrix.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Brightness=(0,a.util.createClass)(u.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(n){if(0!==this.brightness){var o,i=n.imageData.data,c=i.length,r=Math.round(255*this.brightness);for(o=0;o<c;o+=4)i[o]=i[o]+r,i[o+1]=i[o+1]+r,i[o+2]=i[o+2]+r}},getUniformLocations:function(n,s){return{uBrightness:n.getUniformLocation(s,"uBrightness")}},sendUniformData:function(n,s){n.uniform1f(s.uBrightness,this.brightness)}}),a.Image.filters.Brightness.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.extend,h=a.Image.filters;h.Convolute=(0,a.util.createClass)(h.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(s){var i=Math.sqrt(this.matrix.length),o=this.type+"_"+i+"_"+(this.opaque?1:0),c=this.fragmentSource[o];return s.programCache.hasOwnProperty(o)||(s.programCache[o]=this.createProgram(s.context,c)),s.programCache[o]},applyTo2d:function(s){var O,P,X,$,tt,at,ht,et,rt,ut,pt,ft,S,i=s.imageData,o=i.data,c=this.matrix,r=Math.round(Math.sqrt(c.length)),f=Math.floor(r/2),m=i.width,v=i.height,y=s.ctx.createImageData(m,v),x=y.data,w=this.opaque?1:0;for(pt=0;pt<v;pt++)for(ut=0;ut<m;ut++){for(tt=4*(pt*m+ut),O=0,P=0,X=0,$=0,S=0;S<r;S++)for(ft=0;ft<r;ft++)at=ut+ft-f,!((ht=pt+S-f)<0||ht>=v||at<0||at>=m)&&(O+=o[et=4*(ht*m+at)]*(rt=c[S*r+ft]),P+=o[et+1]*rt,X+=o[et+2]*rt,w||($+=o[et+3]*rt));x[tt]=O,x[tt+1]=P,x[tt+2]=X,x[tt+3]=w?o[tt+3]:$}s.imageData=y},getUniformLocations:function(s,i){return{uMatrix:s.getUniformLocation(i,"uMatrix"),uOpaque:s.getUniformLocation(i,"uOpaque"),uHalfSize:s.getUniformLocation(i,"uHalfSize"),uSize:s.getUniformLocation(i,"uSize")}},sendUniformData:function(s,i){s.uniform1fv(i.uMatrix,this.matrix)},toObject:function(){return u(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),a.Image.filters.Convolute.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Grayscale=(0,a.util.createClass)(u.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(n){var o,r,i=n.imageData.data,c=i.length,f=this.mode;for(o=0;o<c;o+=4)"average"===f?r=(i[o]+i[o+1]+i[o+2])/3:"lightness"===f?r=(Math.min(i[o],i[o+1],i[o+2])+Math.max(i[o],i[o+1],i[o+2]))/2:"luminosity"===f&&(r=.21*i[o]+.72*i[o+1]+.07*i[o+2]),i[o]=r,i[o+1]=r,i[o+2]=r},retrieveShader:function(n){var s=this.type+"_"+this.mode;return n.programCache.hasOwnProperty(s)||(n.programCache[s]=this.createProgram(n.context,this.fragmentSource[this.mode])),n.programCache[s]},getUniformLocations:function(n,s){return{uMode:n.getUniformLocation(s,"uMode")}},sendUniformData:function(n,s){n.uniform1i(s.uMode,1)},isNeutralState:function(){return!1}}),a.Image.filters.Grayscale.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Invert=(0,a.util.createClass)(u.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(n){var o,i=n.imageData.data,c=i.length;for(o=0;o<c;o+=4)i[o]=255-i[o],i[o+1]=255-i[o+1],i[o+2]=255-i[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(n,s){return{uInvert:n.getUniformLocation(s,"uInvert")}},sendUniformData:function(n,s){n.uniform1i(s.uInvert,this.invert)}}),a.Image.filters.Invert.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.extend,h=a.Image.filters;h.Noise=(0,a.util.createClass)(h.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(s){if(0!==this.noise){var c,r,m,o=s.imageData.data,f=this.noise;for(c=0,r=o.length;c<r;c+=4)m=(.5-Math.random())*f,o[c]+=m,o[c+1]+=m,o[c+2]+=m}},getUniformLocations:function(s,i){return{uNoise:s.getUniformLocation(i,"uNoise"),uSeed:s.getUniformLocation(i,"uSeed")}},sendUniformData:function(s,i){s.uniform1f(i.uNoise,this.noise/255),s.uniform1f(i.uSeed,Math.random())},toObject:function(){return u(this.callSuper("toObject"),{noise:this.noise})}}),a.Image.filters.Noise.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Pixelate=(0,a.util.createClass)(u.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(n){var r,f,m,v,y,x,w,O,P,X,$,s=n.imageData,i=s.data,o=s.height,c=s.width;for(f=0;f<o;f+=this.blocksize)for(m=0;m<c;m+=this.blocksize)for(v=i[r=4*f*c+4*m],y=i[r+1],x=i[r+2],w=i[r+3],X=Math.min(f+this.blocksize,o),$=Math.min(m+this.blocksize,c),O=f;O<X;O++)for(P=m;P<$;P++)i[r=4*O*c+4*P]=v,i[r+1]=y,i[r+2]=x,i[r+3]=w},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(n,s){return{uBlocksize:n.getUniformLocation(s,"uBlocksize"),uStepW:n.getUniformLocation(s,"uStepW"),uStepH:n.getUniformLocation(s,"uStepH")}},sendUniformData:function(n,s){n.uniform1f(s.uBlocksize,this.blocksize)}}),a.Image.filters.Pixelate.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.extend,h=a.Image.filters;h.RemoveColor=(0,a.util.createClass)(h.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(s){var c,f,m,v,o=s.imageData.data,r=255*this.distance,y=new a.Color(this.color).getSource(),x=[y[0]-r,y[1]-r,y[2]-r],w=[y[0]+r,y[1]+r,y[2]+r];for(c=0;c<o.length;c+=4)m=o[c+1],v=o[c+2],(f=o[c])>x[0]&&m>x[1]&&v>x[2]&&f<w[0]&&m<w[1]&&v<w[2]&&(o[c+3]=0)},getUniformLocations:function(s,i){return{uLow:s.getUniformLocation(i,"uLow"),uHigh:s.getUniformLocation(i,"uHigh")}},sendUniformData:function(s,i){var o=new a.Color(this.color).getSource(),c=parseFloat(this.distance),f=[o[0]/255+c,o[1]/255+c,o[2]/255+c,1];s.uniform4fv(i.uLow,[0+o[0]/255-c,0+o[1]/255-c,0+o[2]/255-c,1]),s.uniform4fv(i.uHigh,f)},toObject:function(){return u(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),a.Image.filters.RemoveColor.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters,h=a.util.createClass,n={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in n)u[s]=h(u.ColorMatrix,{type:s,matrix:n[s],mainParameter:!1,colorsOnly:!0}),a.Image.filters[s].fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric,u=a.Image.filters;u.BlendColor=(0,a.util.createClass)(u.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(n){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[n]+"}\n}"},retrieveShader:function(n){var i,s=this.type+"_"+this.mode;return n.programCache.hasOwnProperty(s)||(i=this.buildSource(this.mode),n.programCache[s]=this.createProgram(n.context,i)),n.programCache[s]},applyTo2d:function(n){var c,r,f,m,v,y,x,i=n.imageData.data,o=i.length,w=1-this.alpha;c=(x=new a.Color(this.color).getSource())[0]*this.alpha,r=x[1]*this.alpha,f=x[2]*this.alpha;for(var O=0;O<o;O+=4)switch(m=i[O],v=i[O+1],y=i[O+2],this.mode){case"multiply":i[O]=m*c/255,i[O+1]=v*r/255,i[O+2]=y*f/255;break;case"screen":i[O]=255-(255-m)*(255-c)/255,i[O+1]=255-(255-v)*(255-r)/255,i[O+2]=255-(255-y)*(255-f)/255;break;case"add":i[O]=m+c,i[O+1]=v+r,i[O+2]=y+f;break;case"diff":case"difference":i[O]=Math.abs(m-c),i[O+1]=Math.abs(v-r),i[O+2]=Math.abs(y-f);break;case"subtract":i[O]=m-c,i[O+1]=v-r,i[O+2]=y-f;break;case"darken":i[O]=Math.min(m,c),i[O+1]=Math.min(v,r),i[O+2]=Math.min(y,f);break;case"lighten":i[O]=Math.max(m,c),i[O+1]=Math.max(v,r),i[O+2]=Math.max(y,f);break;case"overlay":i[O]=c<128?2*m*c/255:255-2*(255-m)*(255-c)/255,i[O+1]=r<128?2*v*r/255:255-2*(255-v)*(255-r)/255,i[O+2]=f<128?2*y*f/255:255-2*(255-y)*(255-f)/255;break;case"exclusion":i[O]=c+m-2*c*m/255,i[O+1]=r+v-2*r*v/255,i[O+2]=f+y-2*f*y/255;break;case"tint":i[O]=c+m*w,i[O+1]=r+v*w,i[O+2]=f+y*w}},getUniformLocations:function(n,s){return{uColor:n.getUniformLocation(s,"uColor")}},sendUniformData:function(n,s){var i=new a.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,n.uniform4fv(s.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendColor.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric,u=a.Image.filters;u.BlendImage=(0,a.util.createClass)(u.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(n){var s=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return n.programCache.hasOwnProperty(s)||(n.programCache[s]=this.createProgram(n.context,i)),n.programCache[s]},applyToWebGL:function(n){var s=n.context,i=this.createTexture(n.filterBackend,this.image);this.bindAdditionalTexture(s,i,s.TEXTURE1),this.callSuper("applyToWebGL",n),this.unbindAdditionalTexture(s,s.TEXTURE1)},createTexture:function(n,s){return n.getCachedTexture(s.cacheKey,s._element)},calculateMatrix:function(){var n=this.image;return[1/n.scaleX,0,0,0,1/n.scaleY,0,-n.left/n._element.width,-n.top/n._element.height,1]},applyTo2d:function(n){var m,v,y,x,w,O,P,X,$,tt,ht,s=n.imageData,i=n.filterBackend.resources,o=s.data,c=o.length,r=s.width,f=s.height,at=this.image;i.blendImage||(i.blendImage=a.util.createCanvasElement()),tt=($=i.blendImage).getContext("2d"),$.width!==r||$.height!==f?($.width=r,$.height=f):tt.clearRect(0,0,r,f),tt.setTransform(at.scaleX,0,0,at.scaleY,at.left,at.top),tt.drawImage(at._element,0,0,r,f),ht=tt.getImageData(0,0,r,f).data;for(var et=0;et<c;et+=4)switch(w=o[et],O=o[et+1],P=o[et+2],X=o[et+3],m=ht[et],v=ht[et+1],y=ht[et+2],x=ht[et+3],this.mode){case"multiply":o[et]=w*m/255,o[et+1]=O*v/255,o[et+2]=P*y/255,o[et+3]=X*x/255;break;case"mask":o[et+3]=x}},getUniformLocations:function(n,s){return{uTransformMatrix:n.getUniformLocation(s,"uTransformMatrix"),uImage:n.getUniformLocation(s,"uImage")}},sendUniformData:function(n,s){var i=this.calculateMatrix();n.uniform1i(s.uImage,1),n.uniformMatrix3fv(s.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendImage.fromObject=function(n,s){a.Image.fromObject(n.image,function(i){var o=a.util.object.clone(n);o.image=i,s(new a.Image.filters.BlendImage(o))})}}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=Math.pow,h=Math.floor,n=Math.sqrt,s=Math.abs,i=Math.round,o=Math.sin,c=Math.ceil,r=a.Image.filters;r.Resize=(0,a.util.createClass)(r.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(m,v){return{uDelta:m.getUniformLocation(v,"uDelta"),uTaps:m.getUniformLocation(v,"uTaps")}},sendUniformData:function(m,v){m.uniform2fv(v.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),m.uniform1fv(v.uTaps,this.taps)},retrieveShader:function(m){var v=this.getFilterWindow(),y=this.type+"_"+v;if(!m.programCache.hasOwnProperty(y)){var x=this.generateShader(v);m.programCache[y]=this.createProgram(m.context,x)}return m.programCache[y]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var m=this.lanczosCreate(this.lanczosLobes),v=this.tempScale,y=this.getFilterWindow(),x=new Array(y),w=1;w<=y;w++)x[w-1]=m(w*v);return x},generateShader:function(x){for(var v=new Array(x),y=this.fragmentSourceTOP,w=1;w<=x;w++)v[w-1]=w+".0 * uDelta";return y+="uniform float uTaps["+x+"];\n",y+="void main() {\n",y+="  vec4 color = texture2D(uTexture, vTexCoord);\n",y+="  float sum = 1.0;\n",v.forEach(function(O,P){y+="  color += texture2D(uTexture, vTexCoord + "+O+") * uTaps["+P+"];\n",y+="  color += texture2D(uTexture, vTexCoord - "+O+") * uTaps["+P+"];\n",y+="  sum += 2.0 * uTaps["+P+"];\n"}),y+="  gl_FragColor = color / sum;\n",y+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(m){m.webgl?(m.passes++,this.width=m.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=m.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),m.destinationWidth=this.dW,this._setupFrameBuffer(m),this.applyToWebGL(m),this._swapTextures(m),m.sourceWidth=m.destinationWidth,this.height=m.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),m.destinationHeight=this.dH,this._setupFrameBuffer(m),this.applyToWebGL(m),this._swapTextures(m),m.sourceHeight=m.destinationHeight):this.applyTo2d(m)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(m){return function(v){if(v>=m||v<=-m)return 0;if(v<1.1920929e-7&&v>-1.1920929e-7)return 1;var y=(v*=Math.PI)/m;return o(v)/v*o(y)/y}},applyTo2d:function(m){var v=m.imageData,y=this.scaleX,x=this.scaleY;this.rcpScaleX=1/y,this.rcpScaleY=1/x;var $,w=v.width,O=v.height,P=i(w*y),X=i(O*x);"sliceHack"===this.resizeType?$=this.sliceByTwo(m,w,O,P,X):"hermite"===this.resizeType?$=this.hermiteFastResize(m,w,O,P,X):"bilinear"===this.resizeType?$=this.bilinearFiltering(m,w,O,P,X):"lanczos"===this.resizeType&&($=this.lanczosResize(m,w,O,P,X)),m.imageData=$},sliceByTwo:function(m,v,y,x,w){var et,rt,O=m.imageData,P=.5,X=!1,$=!1,tt=v*P,at=y*P,ht=a.filterBackend.resources,ut=0,pt=0,ft=v,S=0;for(ht.sliceByTwo||(ht.sliceByTwo=document.createElement("canvas")),((et=ht.sliceByTwo).width<1.5*v||et.height<y)&&(et.width=1.5*v,et.height=y),(rt=et.getContext("2d")).clearRect(0,0,1.5*v,y),rt.putImageData(O,0,0),x=h(x),w=h(w);!X||!$;)v=tt,y=at,x<h(tt*P)?tt=h(tt*P):(tt=x,X=!0),w<h(at*P)?at=h(at*P):(at=w,$=!0),rt.drawImage(et,ut,pt,v,y,ft,S,tt,at),ut=ft,pt=S,S+=at;return rt.getImageData(ut,pt,x,w)},lanczosResize:function(m,v,y,x,w){var P=m.imageData.data,X=m.ctx.createImageData(x,w),$=X.data,tt=this.lanczosCreate(this.lanczosLobes),at=this.rcpScaleX,ht=this.rcpScaleY,et=2/this.rcpScaleX,rt=2/this.rcpScaleY,ut=c(at*this.lanczosLobes/2),pt=c(ht*this.lanczosLobes/2),ft={},S={},I={};return function O(D){var k,j,E,T,R,L,Y,N,q,J,st;for(S.x=(D+.5)*at,I.x=h(S.x),k=0;k<w;k++){for(S.y=(k+.5)*ht,I.y=h(S.y),R=0,L=0,Y=0,N=0,q=0,j=I.x-ut;j<=I.x+ut;j++)if(!(j<0||j>=v)){J=h(1e3*s(j-S.x)),ft[J]||(ft[J]={});for(var V=I.y-pt;V<=I.y+pt;V++)V<0||V>=y||(st=h(1e3*s(V-S.y)),ft[J][st]||(ft[J][st]=tt(n(u(J*et,2)+u(st*rt,2))/1e3)),(E=ft[J][st])>0&&(R+=E,L+=E*P[T=4*(V*v+j)],Y+=E*P[T+1],N+=E*P[T+2],q+=E*P[T+3]))}$[T=4*(k*x+D)]=L/R,$[T+1]=Y/R,$[T+2]=N/R,$[T+3]=q/R}return++D<x?O(D):X}(0)},bilinearFiltering:function(m,v,y,x,w){var tt,at,ht,et,rt,ut,pt,I,S=0,D=this.rcpScaleX,k=this.rcpScaleY,j=4*(v-1),T=m.imageData.data,R=m.ctx.createImageData(x,w),L=R.data;for(ht=0;ht<w;ht++)for(et=0;et<x;et++)for(rt=D*et-(tt=h(D*et)),ut=k*ht-(at=h(k*ht)),I=4*(at*v+tt),pt=0;pt<4;pt++)L[S++]=T[I+pt]*(1-rt)*(1-ut)+T[I+4+pt]*rt*(1-ut)+T[I+j+pt]*ut*(1-rt)+T[I+j+4+pt]*rt*ut;return R},hermiteFastResize:function(m,v,y,x,w){for(var O=this.rcpScaleX,P=this.rcpScaleY,X=c(O/2),$=c(P/2),at=m.imageData.data,ht=m.ctx.createImageData(x,w),et=ht.data,rt=0;rt<w;rt++)for(var ut=0;ut<x;ut++){for(var pt=4*(ut+rt*x),ft=0,S=0,I=0,D=0,k=0,j=0,E=0,T=(rt+.5)*P,R=h(rt*P);R<(rt+1)*P;R++)for(var L=s(T-(R+.5))/$,Y=(ut+.5)*O,N=L*L,q=h(ut*O);q<(ut+1)*O;q++){var J=s(Y-(q+.5))/X,st=n(N+J*J);st>1&&st<-1||(ft=2*st*st*st-3*st*st+1)>0&&(E+=ft*at[3+(J=4*(q+R*v))],I+=ft,at[J+3]<255&&(ft=ft*at[J+3]/250),D+=ft*at[J],k+=ft*at[J+1],j+=ft*at[J+2],S+=ft)}et[pt]=D/S,et[pt+1]=k/S,et[pt+2]=j/S,et[pt+3]=E/I}return ht},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),a.Image.filters.Resize.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Contrast=(0,a.util.createClass)(u.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(n){if(0!==this.contrast){var i,o=n.imageData.data,c=o.length,r=Math.floor(255*this.contrast),f=259*(r+255)/(255*(259-r));for(i=0;i<c;i+=4)o[i]=f*(o[i]-128)+128,o[i+1]=f*(o[i+1]-128)+128,o[i+2]=f*(o[i+2]-128)+128}},getUniformLocations:function(n,s){return{uContrast:n.getUniformLocation(s,"uContrast")}},sendUniformData:function(n,s){n.uniform1f(s.uContrast,this.contrast)}}),a.Image.filters.Contrast.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Saturation=(0,a.util.createClass)(u.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(n){if(0!==this.saturation){var r,f,i=n.imageData.data,o=i.length,c=-this.saturation;for(r=0;r<o;r+=4)f=Math.max(i[r],i[r+1],i[r+2]),i[r]+=f!==i[r]?(f-i[r])*c:0,i[r+1]+=f!==i[r+1]?(f-i[r+1])*c:0,i[r+2]+=f!==i[r+2]?(f-i[r+2])*c:0}},getUniformLocations:function(n,s){return{uSaturation:n.getUniformLocation(s,"uSaturation")}},sendUniformData:function(n,s){n.uniform1f(s.uSaturation,-this.saturation)}}),a.Image.filters.Saturation.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Vibrance=(0,a.util.createClass)(u.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(n){if(0!==this.vibrance){var r,f,v,i=n.imageData.data,o=i.length,c=-this.vibrance;for(r=0;r<o;r+=4)f=Math.max(i[r],i[r+1],i[r+2]),v=2*Math.abs(f-(i[r]+i[r+1]+i[r+2])/3)/255*c,i[r]+=f!==i[r]?(f-i[r])*v:0,i[r+1]+=f!==i[r+1]?(f-i[r+1])*v:0,i[r+2]+=f!==i[r+2]?(f-i[r+2])*v:0}},getUniformLocations:function(n,s){return{uVibrance:n.getUniformLocation(s,"uVibrance")}},sendUniformData:function(n,s){n.uniform1f(s.uVibrance,-this.vibrance)}}),a.Image.filters.Vibrance.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Blur=(0,a.util.createClass)(u.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(n){n.webgl?(this.aspectRatio=n.sourceWidth/n.sourceHeight,n.passes++,this._setupFrameBuffer(n),this.horizontal=!0,this.applyToWebGL(n),this._swapTextures(n),this._setupFrameBuffer(n),this.horizontal=!1,this.applyToWebGL(n),this._swapTextures(n)):this.applyTo2d(n)},applyTo2d:function(n){n.imageData=this.simpleBlur(n)},simpleBlur:function(n){var i,o,s=n.filterBackend.resources,c=n.imageData.width,r=n.imageData.height;s.blurLayer1||(s.blurLayer1=a.util.createCanvasElement(),s.blurLayer2=a.util.createCanvasElement()),o=s.blurLayer2,((i=s.blurLayer1).width!==c||i.height!==r)&&(o.width=i.width=c,o.height=i.height=r);var y,x,w,O,f=i.getContext("2d"),m=o.getContext("2d"),v=15,P=.06*this.blur*.5;for(f.putImageData(n.imageData,0,0),m.clearRect(0,0,c,r),O=-v;O<=v;O++)w=P*(x=O/v)*c+(y=(Math.random()-.5)/4),m.globalAlpha=1-Math.abs(x),m.drawImage(i,w,y),f.drawImage(o,0,0),m.globalAlpha=1,m.clearRect(0,0,o.width,o.height);for(O=-v;O<=v;O++)w=P*(x=O/v)*r+(y=(Math.random()-.5)/4),m.globalAlpha=1-Math.abs(x),m.drawImage(i,y,w),f.drawImage(o,0,0),m.globalAlpha=1,m.clearRect(0,0,o.width,o.height);n.ctx.drawImage(i,0,0);var X=n.ctx.getImageData(0,0,i.width,i.height);return f.globalAlpha=1,f.clearRect(0,0,i.width,i.height),X},getUniformLocations:function(n,s){return{delta:n.getUniformLocation(s,"uDelta")}},sendUniformData:function(n,s){var i=this.chooseRightDelta();n.uniform2fv(s.delta,i)},chooseRightDelta:function(){var i,n=1,s=[0,0];return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),i=n*this.blur*.12,this.horizontal?s[0]=i:s[1]=i,s}}),u.Blur.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Gamma=(0,a.util.createClass)(u.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(n){this.gamma=[1,1,1],u.BaseFilter.prototype.initialize.call(this,n)},applyTo2d:function(n){var v,i=n.imageData.data,o=this.gamma,c=i.length,r=1/o[0],f=1/o[1],m=1/o[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),v=0,c=256;v<c;v++)this.rVals[v]=255*Math.pow(v/255,r),this.gVals[v]=255*Math.pow(v/255,f),this.bVals[v]=255*Math.pow(v/255,m);for(v=0,c=i.length;v<c;v+=4)i[v]=this.rVals[i[v]],i[v+1]=this.gVals[i[v+1]],i[v+2]=this.bVals[i[v+2]]},getUniformLocations:function(n,s){return{uGamma:n.getUniformLocation(s,"uGamma")}},sendUniformData:function(n,s){n.uniform3fv(s.uGamma,this.gamma)}}),a.Image.filters.Gamma.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.Composed=(0,a.util.createClass)(u.BaseFilter,{type:"Composed",subFilters:[],initialize:function(n){this.callSuper("initialize",n),this.subFilters=this.subFilters.slice(0)},applyTo:function(n){n.passes+=this.subFilters.length-1,this.subFilters.forEach(function(s){s.applyTo(n)})},toObject:function(){return a.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(n){return n.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(n){return!n.isNeutralState()})}}),a.Image.filters.Composed.fromObject=function(n,s){var o=(n.subFilters||[]).map(function(r){return new a.Image.filters[r.type](r)}),c=new a.Image.filters.Composed({subFilters:o});return s&&s(c),c}}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.Image.filters;u.HueRotation=(0,a.util.createClass)(u.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var n=this.rotation*Math.PI,s=a.util.cos(n),i=a.util.sin(n),o=1/3,c=Math.sqrt(o)*i,r=1-s;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=s+r/3,this.matrix[1]=o*r-c,this.matrix[2]=o*r+c,this.matrix[5]=o*r+c,this.matrix[6]=s+o*r,this.matrix[7]=o*r-c,this.matrix[10]=o*r-c,this.matrix[11]=o*r+c,this.matrix[12]=s+o*r},isNeutralState:function(n){return this.calculateMatrix(),u.BaseFilter.prototype.isNeutralState.call(this,n)},applyTo:function(n){this.calculateMatrix(),u.BaseFilter.prototype.applyTo.call(this,n)}}),a.Image.filters.HueRotation.fromObject=a.Image.filters.BaseFilter.fromObject}(yt),function(p){"use strict";var a=p.fabric||(p.fabric={}),u=a.util.object.clone;if(a.Text)a.warn("fabric.Text is already defined");else{var h="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:a.Object.prototype.stateProperties.concat(h),cacheProperties:a.Object.prototype.cacheProperties.concat(h),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(n,s){this.styles=s&&s.styles||{},this.text=n,this.__skipDimension=!0,this.callSuper("initialize",s),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var n=this.path;n&&(n.segmentsInfo=a.util.getPathSegmentsInfo(n.path))},getMeasuringContext:function(){return a._measuringContext||(a._measuringContext=this.canvas&&this.canvas.contextCache||a.util.createCanvasElement().getContext("2d")),a._measuringContext},_splitText:function(){var n=this._splitTextIntoLines(this.text);return this.textLines=n.lines,this._textLines=n.graphemeLines,this._unwrappedTextLines=n._unwrappedLines,this._text=n.graphemeText,n},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var n,s,o,c,r,f,m=0,v=this._textLines.length;m<v;m++)if(("justify"===this.textAlign||m!==v-1&&!this.isEndOfWrapping(m))&&(o=0,c=this._textLines[m],(s=this.getLineWidth(m))<this.width&&(f=this.textLines[m].match(this._reSpacesAndTabs)))){n=(this.width-s)/f.length;for(var y=0,x=c.length;y<=x;y++)r=this.__charBounds[m][y],this._reSpaceAndTab.test(c[y])?(r.width+=n,r.kernedWidth+=n,r.left+=o,o+=n):r.left+=o}},isEndOfWrapping:function(n){return n===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var n=this.callSuper("_getCacheCanvasDimensions"),s=this.fontSize;return n.width+=s*n.zoomX,n.height+=s*n.zoomY,n},_render:function(n){var s=this.path;s&&!s.isNotVisible()&&s._render(n),this._setTextStyles(n),this._renderTextLinesBackground(n),this._renderTextDecoration(n,"underline"),this._renderText(n),this._renderTextDecoration(n,"overline"),this._renderTextDecoration(n,"linethrough")},_renderText:function(n){"stroke"===this.paintFirst?(this._renderTextStroke(n),this._renderTextFill(n)):(this._renderTextFill(n),this._renderTextStroke(n))},_setTextStyles:function(n,s,i){if(n.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":n.textBaseline="middle";break;case"ascender":n.textBaseline="top";break;case"descender":n.textBaseline="bottom"}n.font=this._getFontDeclaration(s,i)},calcTextWidth:function(){for(var n=this.getLineWidth(0),s=1,i=this._textLines.length;s<i;s++){var o=this.getLineWidth(s);o>n&&(n=o)}return n},_renderTextLine:function(n,s,i,o,c,r){this._renderChars(n,s,i,o,c,r)},_renderTextLinesBackground:function(n){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var s,i,c,r,x,w,P,o=n.fillStyle,f=this._getLeftOffset(),m=this._getTopOffset(),v=0,y=0,O=this.path,X=0,$=this._textLines.length;X<$;X++)if(s=this.getHeightOfLine(X),this.textBackgroundColor||this.styleHas("textBackgroundColor",X)){c=this._textLines[X],i=this._getLineLeftOffset(X),y=0,v=0,r=this.getValueOfPropertyAt(X,0,"textBackgroundColor");for(var tt=0,at=c.length;tt<at;tt++)x=this.__charBounds[X][tt],w=this.getValueOfPropertyAt(X,tt,"textBackgroundColor"),O?(n.save(),n.translate(x.renderLeft,x.renderTop),n.rotate(x.angle),n.fillStyle=w,w&&n.fillRect(-x.width/2,-s/this.lineHeight*(1-this._fontSizeFraction),x.width,s/this.lineHeight),n.restore()):w!==r?(P=f+i+v,"rtl"===this.direction&&(P=this.width-P-y),n.fillStyle=r,r&&n.fillRect(P,m,y,s/this.lineHeight),v=x.left,y=x.width,r=w):y+=x.kernedWidth;w&&!O&&(P=f+i+v,"rtl"===this.direction&&(P=this.width-P-y),n.fillStyle=w,n.fillRect(P,m,y,s/this.lineHeight)),m+=s}else m+=s;n.fillStyle=o,this._removeShadow(n)}},getFontCache:function(n){var s=n.fontFamily.toLowerCase();a.charWidthsCache[s]||(a.charWidthsCache[s]={});var i=a.charWidthsCache[s],o=n.fontStyle.toLowerCase()+"_"+(n.fontWeight+"").toLowerCase();return i[o]||(i[o]={}),i[o]},_measureChar:function(n,s,i,o){var y,x,w,P,c=this.getFontCache(s),m=i+n,v=this._getFontDeclaration(s)===this._getFontDeclaration(o),O=s.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==c[i]&&(w=c[i]),void 0!==c[n]&&(P=y=c[n]),v&&void 0!==c[m]&&(P=(x=c[m])-w),void 0===y||void 0===w||void 0===x){var X=this.getMeasuringContext();this._setTextStyles(X,s,!0)}return void 0===y&&(P=y=X.measureText(n).width,c[n]=y),void 0===w&&v&&i&&(w=X.measureText(i).width,c[i]=w),v&&void 0===x&&(x=X.measureText(m).width,c[m]=x,P=x-w),{width:y*O,kernedWidth:P*O}},getHeightOfChar:function(n,s){return this.getValueOfPropertyAt(n,s,"fontSize")},measureLine:function(n){var s=this._measureLine(n);return 0!==this.charSpacing&&(s.width-=this._getWidthOfCharSpacing()),s.width<0&&(s.width=0),s},_measureLine:function(n){var i,o,r,f,x,w,s=0,c=this._textLines[n],v=new Array(c.length),y=0,O=this.path,P="right"===this.pathSide;for(this.__charBounds[n]=v,i=0;i<c.length;i++)f=this._getGraphemeBox(o=c[i],n,i,r),v[i]=f,s+=f.kernedWidth,r=o;if(v[i]={left:f?f.left+f.width:0,width:0,kernedWidth:0,height:this.fontSize},O){switch(w=O.segmentsInfo[O.segmentsInfo.length-1].length,(x=a.util.getPointOnPath(O.path,0,O.segmentsInfo)).x+=O.pathOffset.x,x.y+=O.pathOffset.y,this.textAlign){case"left":y=P?w-s:0;break;case"center":y=(w-s)/2;break;case"right":y=P?0:w-s}for(y+=this.pathStartOffset*(P?-1:1),i=P?c.length-1:0;P?i>=0:i<c.length;P?i--:i++)y>w?y%=w:y<0&&(y+=w),this._setGraphemeOnPath(y,f=v[i],x),y+=f.kernedWidth}return{width:s,numOfSpaces:0}},_setGraphemeOnPath:function(n,s,i){var c=this.path,r=a.util.getPointOnPath(c.path,n+s.kernedWidth/2,c.segmentsInfo);s.renderLeft=r.x-i.x,s.renderTop=r.y-i.y,s.angle=r.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(n,s,i,o,c){var x,r=this.getCompleteStyleDeclaration(s,i),f=o?this.getCompleteStyleDeclaration(s,i-1):{},m=this._measureChar(n,r,o,f),v=m.kernedWidth,y=m.width;0!==this.charSpacing&&(y+=x=this._getWidthOfCharSpacing(),v+=x);var w={width:y,left:0,height:r.fontSize,kernedWidth:v,deltaY:r.deltaY};if(i>0&&!c){var O=this.__charBounds[s][i-1];w.left=O.left+O.width+m.kernedWidth-m.width}return w},getHeightOfLine:function(n){if(this.__lineHeights[n])return this.__lineHeights[n];for(var s=this._textLines[n],i=this.getHeightOfChar(n,0),o=1,c=s.length;o<c;o++)i=Math.max(this.getHeightOfChar(n,o),i);return this.__lineHeights[n]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var n,s=0,i=0,o=this._textLines.length;i<o;i++)n=this.getHeightOfLine(i),s+=i===o-1?n/this.lineHeight:n;return s},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(n,s){n.save();for(var i=0,o=this._getLeftOffset(),c=this._getTopOffset(),r=0,f=this._textLines.length;r<f;r++){var m=this.getHeightOfLine(r),v=m/this.lineHeight,y=this._getLineLeftOffset(r);this._renderTextLine(s,n,this._textLines[r],o+y,c+i+v,r),i+=m}n.restore()},_renderTextFill:function(n){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(n,"fillText")},_renderTextStroke:function(n){(!this.stroke||0===this.strokeWidth)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),n.save(),this._setLineDash(n,this.strokeDashArray),n.beginPath(),this._renderTextCommon(n,"strokeText"),n.closePath(),n.restore())},_renderChars:function(n,s,i,o,c,r){var v,y,w,P,f=this.getHeightOfLine(r),m=-1!==this.textAlign.indexOf("justify"),x="",O=0,X=this.path,$=!m&&0===this.charSpacing&&this.isEmptyStyles(r)&&!X,tt="ltr"===this.direction,at="ltr"===this.direction?1:-1,et=s.canvas.getAttribute("dir");if(s.save(),et!==this.direction&&(s.canvas.setAttribute("dir",tt?"ltr":"rtl"),s.direction=tt?"ltr":"rtl",s.textAlign=tt?"left":"right"),c-=f*this._fontSizeFraction/this.lineHeight,$)return this._renderChar(n,s,r,0,i.join(""),o,c,f),void s.restore();for(var rt=0,ut=i.length-1;rt<=ut;rt++)P=rt===ut||this.charSpacing||X,x+=i[rt],w=this.__charBounds[r][rt],0===O?(o+=at*(w.kernedWidth-w.width),O+=w.width):O+=w.kernedWidth,m&&!P&&this._reSpaceAndTab.test(i[rt])&&(P=!0),P||(v=v||this.getCompleteStyleDeclaration(r,rt),y=this.getCompleteStyleDeclaration(r,rt+1),P=a.util.hasStyleChanged(v,y,!1)),P&&(X?(s.save(),s.translate(w.renderLeft,w.renderTop),s.rotate(w.angle),this._renderChar(n,s,r,rt,x,-O/2,0,f),s.restore()):this._renderChar(n,s,r,rt,x,o,c,f),x="",v=y,o+=at*O,O=0);s.restore()},_applyPatternGradientTransformText:function(n){var i,s=a.util.createCanvasElement(),o=this.width+this.strokeWidth,c=this.height+this.strokeWidth;return s.width=o,s.height=c,(i=s.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(o,0),i.lineTo(o,c),i.lineTo(0,c),i.closePath(),i.translate(o/2,c/2),i.fillStyle=n.toLive(i),this._applyPatternGradientTransform(i,n),i.fill(),i.createPattern(s,"no-repeat")},handleFiller:function(n,s,i){var o,c;return i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?(n.translate(o=-this.width/2,c=-this.height/2),n[s]=this._applyPatternGradientTransformText(i),{offsetX:o,offsetY:c}):(n[s]=i.toLive(n,this),this._applyPatternGradientTransform(n,i)):(n[s]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(n,s){return n.lineWidth=s.strokeWidth,n.lineCap=this.strokeLineCap,n.lineDashOffset=this.strokeDashOffset,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,this.handleFiller(n,"strokeStyle",s.stroke)},_setFillStyles:function(n,s){return this.handleFiller(n,"fillStyle",s.fill)},_renderChar:function(n,s,i,o,c,r,f){var w,O,m=this._getStyleDeclaration(i,o),v=this.getCompleteStyleDeclaration(i,o),y="fillText"===n&&v.fill,x="strokeText"===n&&v.stroke&&v.strokeWidth;!x&&!y||(s.save(),y&&(w=this._setFillStyles(s,v)),x&&(O=this._setStrokeStyles(s,v)),s.font=this._getFontDeclaration(v),m&&m.textBackgroundColor&&this._removeShadow(s),m&&m.deltaY&&(f+=m.deltaY),y&&s.fillText(c,r-w.offsetX,f-w.offsetY),x&&s.strokeText(c,r-O.offsetX,f-O.offsetY),s.restore())},setSuperscript:function(n,s){return this._setScript(n,s,this.superscript)},setSubscript:function(n,s){return this._setScript(n,s,this.subscript)},_setScript:function(n,s,i){var o=this.get2DCursorLocation(n,!0),c=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"fontSize"),r=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"deltaY");return this.setSelectionStyles({fontSize:c*i.size,deltaY:r+c*i.baseline},n,s),this},_getLineLeftOffset:function(n){var s=this.getLineWidth(n),i=this.width-s,o=this.textAlign,c=this.direction,r=0,f=this.isEndOfWrapping(n);return"justify"===o||"justify-center"===o&&!f||"justify-right"===o&&!f||"justify-left"===o&&!f?0:("center"===o&&(r=i/2),"right"===o&&(r=i),"justify-center"===o&&(r=i/2),"justify-right"===o&&(r=i),"rtl"===c&&(r-=i),r)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var n=this._forceClearCache;return n||(n=this.hasStateChanged("_dimensionAffectingProps")),n&&(this.dirty=!0,this._forceClearCache=!1),n},getLineWidth:function(n){if(void 0!==this.__lineWidths[n])return this.__lineWidths[n];var i=this.measureLine(n).width;return this.__lineWidths[n]=i,i},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(n,s,i){var o=this._getStyleDeclaration(n,s);return o&&typeof o[i]<"u"?o[i]:this[i]},_renderTextDecoration:function(n,s){if(this[s]||this.styleHas(s)){for(var i,o,c,r,f,m,v,y,O,P,X,$,tt,at,ht,et,x=this._getLeftOffset(),w=this._getTopOffset(),rt=this.path,ut=this._getWidthOfCharSpacing(),pt=this.offsets[s],ft=0,S=this._textLines.length;ft<S;ft++)if(i=this.getHeightOfLine(ft),this[s]||this.styleHas(s,ft)){v=this._textLines[ft],at=i/this.lineHeight,r=this._getLineLeftOffset(ft),P=0,X=0,y=this.getValueOfPropertyAt(ft,0,s),et=this.getValueOfPropertyAt(ft,0,"fill"),O=w+at*(1-this._fontSizeFraction),o=this.getHeightOfChar(ft,0),f=this.getValueOfPropertyAt(ft,0,"deltaY");for(var I=0,D=v.length;I<D;I++)if($=this.__charBounds[ft][I],tt=this.getValueOfPropertyAt(ft,I,s),ht=this.getValueOfPropertyAt(ft,I,"fill"),c=this.getHeightOfChar(ft,I),m=this.getValueOfPropertyAt(ft,I,"deltaY"),rt&&tt&&ht)n.save(),n.fillStyle=et,n.translate($.renderLeft,$.renderTop),n.rotate($.angle),n.fillRect(-$.kernedWidth/2,pt*c+m,$.kernedWidth,this.fontSize/15),n.restore();else if((tt!==y||ht!==et||c!==o||m!==f)&&X>0){var k=x+r+P;"rtl"===this.direction&&(k=this.width-k-X),y&&et&&(n.fillStyle=et,n.fillRect(k,O+pt*o+f,X,this.fontSize/15)),P=$.left,X=$.width,y=tt,et=ht,o=c,f=m}else X+=$.kernedWidth;k=x+r+P,"rtl"===this.direction&&(k=this.width-k-X),n.fillStyle=ht,tt&&ht&&n.fillRect(k,O+pt*o+f,X-ut,this.fontSize/15),w+=i}else w+=i;this._removeShadow(n)}},_getFontDeclaration:function(n,s){var i=n||this,o=this.fontFamily,c=a.Text.genericFonts.indexOf(o.toLowerCase())>-1,r=void 0===o||o.indexOf("'")>-1||o.indexOf(",")>-1||o.indexOf('"')>-1||c?i.fontFamily:'"'+i.fontFamily+'"';return[a.isLikelyNode?i.fontWeight:i.fontStyle,a.isLikelyNode?i.fontStyle:i.fontWeight,s?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",r].join(" ")},render:function(n){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",n))},_splitTextIntoLines:function(n){for(var s=n.split(this._reNewline),i=new Array(s.length),o=["\n"],c=[],r=0;r<s.length;r++)i[r]=a.util.string.graphemeSplit(s[r]),c=c.concat(i[r],o);return c.pop(),{_unwrappedLines:i,lines:s,graphemeText:c,graphemeLines:i}},toObject:function(n){var s=h.concat(n),i=this.callSuper("toObject",s);return i.styles=a.util.stylesToArray(this.styles,this.text),i.path&&(i.path=this.path.toObject()),i},set:function(n,s){this.callSuper("set",n,s);var i=!1,o=!1;if("object"==typeof n)for(var c in n)"path"===c&&this.setPathInfo(),i=i||-1!==this._dimensionAffectingProps.indexOf(c),o=o||"path"===c;else i=-1!==this._dimensionAffectingProps.indexOf(n),o="path"===n;return o&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(n,s,i){if(!n)return s(null);var o=a.parseAttributes(n,a.Text.ATTRIBUTE_NAMES),c=o.textAnchor||"left";if((i=a.util.object.extend(i?u(i):{},o)).top=i.top||0,i.left=i.left||0,o.textDecoration){var r=o.textDecoration;-1!==r.indexOf("underline")&&(i.underline=!0),-1!==r.indexOf("overline")&&(i.overline=!0),-1!==r.indexOf("line-through")&&(i.linethrough=!0),delete i.textDecoration}"dx"in o&&(i.left+=o.dx),"dy"in o&&(i.top+=o.dy),"fontSize"in i||(i.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE);var f="";"textContent"in n?f=n.textContent:"firstChild"in n&&null!==n.firstChild&&"data"in n.firstChild&&null!==n.firstChild.data&&(f=n.firstChild.data),f=f.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var m=i.strokeWidth;i.strokeWidth=0;var v=new a.Text(f,i),y=v.getScaledHeight()/v.height,w=((v.height+v.strokeWidth)*v.lineHeight-v.height)*y,O=v.getScaledHeight()+w,P=0;"center"===c&&(P=v.getScaledWidth()/2),"right"===c&&(P=v.getScaledWidth()),v.set({left:v.left-P,top:v.top-(O-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:typeof m<"u"?m:1}),s(v)},a.Text.fromObject=function(n,s){var i=u(n),o=n.path;return delete i.path,a.Object._fromObject("Text",i,function(c){c.styles=a.util.stylesFromArray(n.styles,n.text),o?a.Object._fromObject("Path",o,function(r){c.set("path",r),s(c)},"path"):s(c)},"text")},a.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],a.util.createAccessors&&a.util.createAccessors(a.Text)}}(yt),_.util.object.extend(_.Text.prototype,{isEmptyStyles:function(p){if(!this.styles||typeof p<"u"&&!this.styles[p])return!0;var a=typeof p>"u"?this.styles:{line:this.styles[p]};for(var u in a)for(var h in a[u])for(var n in a[u][h])return!1;return!0},styleHas:function(p,a){if(!this.styles||!p||""===p||typeof a<"u"&&!this.styles[a])return!1;var u=typeof a>"u"?this.styles:{0:this.styles[a]};for(var h in u)for(var n in u[h])if(typeof u[h][n][p]<"u")return!0;return!1},cleanStyle:function(p){if(!this.styles||!p||""===p)return!1;var h,n,a=this.styles,u=0,s=!0,i=0;for(var c in a){for(var r in h=0,a[c]){var o;u++,(o=a[c][r]).hasOwnProperty(p)?(n?o[p]!==n&&(s=!1):n=o[p],o[p]===this[p]&&delete o[p]):s=!1,0!==Object.keys(o).length?h++:delete a[c][r]}0===h&&delete a[c]}for(var m=0;m<this._textLines.length;m++)i+=this._textLines[m].length;s&&u===i&&(this[p]=n,this.removeStyle(p))},removeStyle:function(p){if(this.styles&&p&&""!==p){var u,h,n,a=this.styles;for(h in a){for(n in u=a[h])delete u[n][p],0===Object.keys(u[n]).length&&delete u[n];0===Object.keys(u).length&&delete a[h]}}},_extendStyles:function(p,a){var u=this.get2DCursorLocation(p);this._getLineStyle(u.lineIndex)||this._setLineStyle(u.lineIndex),this._getStyleDeclaration(u.lineIndex,u.charIndex)||this._setStyleDeclaration(u.lineIndex,u.charIndex,{}),_.util.object.extend(this._getStyleDeclaration(u.lineIndex,u.charIndex),a)},get2DCursorLocation:function(p,a){typeof p>"u"&&(p=this.selectionStart);for(var u=a?this._unwrappedTextLines:this._textLines,h=u.length,n=0;n<h;n++){if(p<=u[n].length)return{lineIndex:n,charIndex:p};p-=u[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:u[n-1].length<p?u[n-1].length:p}},getSelectionStyles:function(p,a,u){typeof p>"u"&&(p=this.selectionStart||0),typeof a>"u"&&(a=this.selectionEnd||p);for(var h=[],n=p;n<a;n++)h.push(this.getStyleAtPosition(n,u));return h},getStyleAtPosition:function(p,a){var u=this.get2DCursorLocation(p);return(a?this.getCompleteStyleDeclaration(u.lineIndex,u.charIndex):this._getStyleDeclaration(u.lineIndex,u.charIndex))||{}},setSelectionStyles:function(p,a,u){typeof a>"u"&&(a=this.selectionStart||0),typeof u>"u"&&(u=this.selectionEnd||a);for(var h=a;h<u;h++)this._extendStyles(h,p);return this._forceClearCache=!0,this},_getStyleDeclaration:function(p,a){var u=this.styles&&this.styles[p];return u?u[a]:null},getCompleteStyleDeclaration:function(p,a){for(var n,u=this._getStyleDeclaration(p,a)||{},h={},s=0;s<this._styleProperties.length;s++)h[n=this._styleProperties[s]]=typeof u[n]>"u"?this[n]:u[n];return h},_setStyleDeclaration:function(p,a,u){this.styles[p][a]=u},_deleteStyleDeclaration:function(p,a){delete this.styles[p][a]},_getLineStyle:function(p){return!!this.styles[p]},_setLineStyle:function(p){this.styles[p]={}},_deleteLineStyle:function(p){delete this.styles[p]}}),function(){function p(a){a.textDecoration&&(a.textDecoration.indexOf("underline")>-1&&(a.underline=!0),a.textDecoration.indexOf("line-through")>-1&&(a.linethrough=!0),a.textDecoration.indexOf("overline")>-1&&(a.overline=!0),delete a.textDecoration)}_.IText=_.util.createClass(_.Text,_.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(a,u){this.callSuper("initialize",a,u),this.initBehavior()},setSelectionStart:function(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)},_updateAndFire:function(a,u){this[a]!==u&&(this._fireSelectionChanged(),this[a]=u),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(a){this.clearContextTop(),this.callSuper("render",a),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(a){this.callSuper("_render",a)},clearContextTop:function(a){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var u=this.canvas.contextTop,h=this.canvas.viewportTransform;u.save(),u.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this.transform(u),this._clearTextArea(u),a||u.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this._getCursorBoundaries(),u=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(a,u):this.renderSelection(a,u),u.restore()}},_clearTextArea:function(a){var u=this.width+4,h=this.height+4;a.clearRect(-u/2,-h/2,u,h)},_getCursorBoundaries:function(a){typeof a>"u"&&(a=this.selectionStart);var u=this._getLeftOffset(),h=this._getTopOffset(),n=this._getCursorBoundariesOffsets(a);return{left:u,top:h,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(a){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var u,h,n,o,s=0,i=0,c=this.get2DCursorLocation(a);n=c.charIndex,h=c.lineIndex;for(var r=0;r<h;r++)s+=this.getHeightOfLine(r);u=this._getLineLeftOffset(h);var f=this.__charBounds[h][n];return f&&(i=f.left),0!==this.charSpacing&&n===this._textLines[h].length&&(i-=this._getWidthOfCharSpacing()),o={top:s,left:u+(i>0?i:0)},"rtl"===this.direction&&(o.left*=-1),this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(a,u){var h=this.get2DCursorLocation(),n=h.lineIndex,s=h.charIndex>0?h.charIndex-1:0,i=this.getValueOfPropertyAt(n,s,"fontSize"),o=this.scaleX*this.canvas.getZoom(),c=this.cursorWidth/o,r=a.topOffset,f=this.getValueOfPropertyAt(n,s,"deltaY");r+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-i*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(a,u),u.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,s,"fill"),u.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,u.fillRect(a.left+a.leftOffset-c/2,r+a.top+f,c,i)},renderSelection:function(a,u){for(var h=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=-1!==this.textAlign.indexOf("justify"),i=this.get2DCursorLocation(h),o=this.get2DCursorLocation(n),c=i.lineIndex,r=o.lineIndex,f=i.charIndex<0?0:i.charIndex,m=o.charIndex<0?0:o.charIndex,v=c;v<=r;v++){var w,y=this._getLineLeftOffset(v)||0,x=this.getHeightOfLine(v),O=0,P=0;if(v===c&&(O=this.__charBounds[c][f].left),v>=c&&v<r)P=s&&!this.isEndOfWrapping(v)?this.width:this.getLineWidth(v)||5;else if(v===r)if(0===m)P=this.__charBounds[r][m].left;else{var X=this._getWidthOfCharSpacing();P=this.__charBounds[r][m-1].left+this.__charBounds[r][m-1].width-X}w=x,(this.lineHeight<1||v===r&&this.lineHeight>1)&&(x/=this.lineHeight);var $=a.left+y+O,tt=P-O,at=x,ht=0;this.inCompositionMode?(u.fillStyle=this.compositionColor||"black",at=1,ht=x):u.fillStyle=this.selectionColor,"rtl"===this.direction&&($=this.width-$-tt),u.fillRect($,a.top+a.topOffset+ht,tt,at),a.topOffset+=w}},getCurrentCharFontSize:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fontSize")},getCurrentCharColor:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fill")},_getCurrentCharIndex:function(){var a=this.get2DCursorLocation(this.selectionStart,!0);return{l:a.lineIndex,c:a.charIndex>0?a.charIndex-1:0}}}),_.IText.fromObject=function(a,u){var h=_.util.stylesFromArray(a.styles,a.text),n=Object.assign({},a,{styles:h});if(p(n),n.styles)for(var s in n.styles)for(var i in n.styles[s])p(n.styles[s][i]);_.Object._fromObject("IText",n,u,"text")}}(),function(){var p=_.util.object.clone;_.util.object.extend(_.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var a=this;this.on("added",function(){var u=a.canvas;u&&(u._hasITextHandlers||(u._hasITextHandlers=!0,a._initCanvasHandlers(u)),u._iTextInstances=u._iTextInstances||[],u._iTextInstances.push(a))})},initRemovedHandler:function(){var a=this;this.on("removed",function(){var u=a.canvas;u&&(u._iTextInstances=u._iTextInstances||[],_.util.removeFromArray(u._iTextInstances,a),0===u._iTextInstances.length&&(u._hasITextHandlers=!1,a._removeCanvasHandlers(u)))})},_initCanvasHandlers:function(a){a._mouseUpITextHandler=function(){a._iTextInstances&&a._iTextInstances.forEach(function(u){u.__isMousedown=!1})},a.on("mouse:up",a._mouseUpITextHandler)},_removeCanvasHandlers:function(a){a.off("mouse:up",a._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(a,u,h,n){var s;return s={isAborted:!1,abort:function(){this.isAborted=!0}},a.animate("_currentCursorOpacity",u,{duration:h,onComplete:function(){s.isAborted||a[n]()},onChange:function(){a.canvas&&a.selectionStart===a.selectionEnd&&a.renderCursorOrSelection()},abort:function(){return s.isAborted}}),s},_onTickComplete:function(){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var u=this,h=a?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){u._tick()},h)},abortCursorAnimation:function(){var a=this._currentTickState||this._currentTickCompleteState,u=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,a&&u&&u.clearContext(u.contextTop||u.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(a){var u=0,h=a-1;if(this._reSpace.test(this._text[h]))for(;this._reSpace.test(this._text[h]);)u++,h--;for(;/\S/.test(this._text[h])&&h>-1;)u++,h--;return a-u},findWordBoundaryRight:function(a){var u=0,h=a;if(this._reSpace.test(this._text[h]))for(;this._reSpace.test(this._text[h]);)u++,h++;for(;/\S/.test(this._text[h])&&h<this._text.length;)u++,h++;return a+u},findLineBoundaryLeft:function(a){for(var u=0,h=a-1;!/\n/.test(this._text[h])&&h>-1;)u++,h--;return a-u},findLineBoundaryRight:function(a){for(var u=0,h=a;!/\n/.test(this._text[h])&&h<this._text.length;)u++,h++;return a+u},searchWordBoundary:function(a,u){for(var h=this._text,n=this._reSpace.test(h[a])?a-1:a,s=h[n],i=_.reNonWord;!i.test(s)&&n>0&&n<h.length;)s=h[n+=u];return i.test(s)&&(n+=1===u?0:1),n},selectWord:function(a){var u=this.searchWordBoundary(a=a||this.selectionStart,-1),h=this.searchWordBoundary(a,1);this.selectionStart=u,this.selectionEnd=h,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(a){var u=this.findLineBoundaryLeft(a=a||this.selectionStart),h=this.findLineBoundaryRight(a);return this.selectionStart=u,this.selectionEnd=h,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(a){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(a),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(a){a._iTextInstances&&a._iTextInstances.forEach(function(u){u.selected=!1,u.isEditing&&u.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(a){if(this.__isMousedown&&this.isEditing){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var u=this.getSelectionStartFromPointer(a.e),h=this.selectionStart,n=this.selectionEnd;(u!==this.__selectionStartOnMouseDown||h===n)&&(h===u||n===u)||(u>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=u):(this.selectionStart=u,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==h||this.selectionEnd!==n)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(a,u,h){var n=h.slice(0,a),s=_.util.string.graphemeSplit(n).length;if(a===u)return{selectionStart:s,selectionEnd:s};var i=h.slice(a,u);return{selectionStart:s,selectionEnd:s+_.util.string.graphemeSplit(i).length}},fromGraphemeToStringSelection:function(a,u,h){var s=h.slice(0,a).join("").length;return a===u?{selectionStart:s,selectionEnd:s}:{selectionStart:s,selectionEnd:s+h.slice(a,u).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var a=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=a.selectionStart,this.hiddenTextarea.selectionEnd=a.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var a=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=a.selectionEnd,this.inCompositionMode||(this.selectionStart=a.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.left,this.hiddenTextarea.style.top=a.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var a=this.inCompositionMode?this.compositionStart:this.selectionStart,u=this._getCursorBoundaries(a),h=this.get2DCursorLocation(a),i=this.getValueOfPropertyAt(h.lineIndex,h.charIndex,"fontSize")*this.lineHeight,o=u.leftOffset,c=this.calcTransformMatrix(),r={x:u.left+o,y:u.top+u.topOffset+i},f=this.canvas.getRetinaScaling(),m=this.canvas.upperCanvasEl,v=m.width/f,y=m.height/f,x=v-i,w=y-i,O=m.clientWidth/v,P=m.clientHeight/y;return r=_.util.transformPoint(r,c),(r=_.util.transformPoint(r,this.canvas.viewportTransform)).x*=O,r.y*=P,r.x<0&&(r.x=0),r.x>x&&(r.x=x),r.y<0&&(r.y=0),r.y>w&&(r.y=w),r.x+=this.canvas._offset.left,r.y+=this.canvas._offset.top,{left:r.x+"px",top:r.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){!this._savedProps||(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var a=this._textBeforeEdit!==this.text,u=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,u&&(u.blur&&u.blur(),u.parentNode&&u.parentNode.removeChild(u)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),a&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),a&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var a in this.styles)this._textLines[a]||delete this.styles[a]},removeStyleFromTo:function(a,u){var r,f,h=this.get2DCursorLocation(a,!0),n=this.get2DCursorLocation(u,!0),s=h.lineIndex,i=h.charIndex,o=n.lineIndex,c=n.charIndex;if(s!==o){if(this.styles[s])for(r=i;r<this._unwrappedTextLines[s].length;r++)delete this.styles[s][r];if(this.styles[o])for(r=c;r<this._unwrappedTextLines[o].length;r++)(f=this.styles[o][r])&&(this.styles[s]||(this.styles[s]={}),this.styles[s][i+r-c]=f);for(r=s+1;r<=o;r++)delete this.styles[r];this.shiftLineStyles(o,s-o)}else if(this.styles[s]){f=this.styles[s];var v,y,m=c-i;for(r=i;r<c;r++)delete f[r];for(y in this.styles[s])(v=parseInt(y,10))>=c&&(f[v-m]=f[y],delete f[y])}},shiftLineStyles:function(a,u){var h=p(this.styles);for(var n in this.styles){var s=parseInt(n,10);s>a&&(this.styles[s+u]=h[s],h[s-u]||delete this.styles[s])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(a,u,h,n){var s,i={},o=!1,c=this._unwrappedTextLines[a].length===u;for(var r in h||(h=1),this.shiftLineStyles(a,h),this.styles[a]&&(s=this.styles[a][0===u?u:u-1]),this.styles[a]){var f=parseInt(r,10);f>=u&&(o=!0,i[f-u]=this.styles[a][r],c&&0===u||delete this.styles[a][r])}var m=!1;for(o&&!c&&(this.styles[a+h]=i,m=!0),m&&h--;h>0;)n&&n[h-1]?this.styles[a+h]={0:p(n[h-1])}:s?this.styles[a+h]={0:p(s)}:delete this.styles[a+h],h--;this._forceClearCache=!0},insertCharStyleObject:function(a,u,h,n){this.styles||(this.styles={});var s=this.styles[a],i=s?p(s):{};for(var o in h||(h=1),i){var c=parseInt(o,10);c>=u&&(s[c+h]=i[c],i[c-h]||delete s[c])}if(this._forceClearCache=!0,n)for(;h--;)!Object.keys(n[h]).length||(this.styles[a]||(this.styles[a]={}),this.styles[a][u+h]=p(n[h]));else if(s)for(var r=s[u?u-1:1];r&&h--;)this.styles[a][u+h]=p(r)},insertNewStyleBlock:function(a,u,h){for(var n=this.get2DCursorLocation(u,!0),s=[0],i=0,o=0;o<a.length;o++)"\n"===a[o]?s[++i]=0:s[i]++;for(s[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,s[0],h),h=h&&h.slice(s[0]+1)),i&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+s[0],i),o=1;o<i;o++)s[o]>0?this.insertCharStyleObject(n.lineIndex+o,0,s[o],h):h&&this.styles[n.lineIndex+o]&&h[0]&&(this.styles[n.lineIndex+o][0]=h[0]),h=h&&h.slice(s[o]+1);s[o]>0&&this.insertCharStyleObject(n.lineIndex+o,0,s[o],h)},setSelectionStartEndWithShift:function(a,u,h){h<=a?(u===a?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=a),this.selectionStart=h):h>a&&h<u?"right"===this._selectionDirection?this.selectionEnd=h:this.selectionStart=h:(u===a?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=u),this.selectionEnd=h)},setSelectionInBoundaries:function(){var a=this.text.length;this.selectionStart>a?this.selectionStart=a:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>a?this.selectionEnd=a:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),_.util.object.extend(_.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(p){if(this.canvas){this.__newClickTime=+new Date;var a=p.pointer;this.isTripleClick(a)&&(this.fire("tripleclick",p),this._stopEvent(p.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=a,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(p){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===p.x&&this.__lastPointer.y===p.y},_stopEvent:function(p){p.preventDefault&&p.preventDefault(),p.stopPropagation&&p.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(p){!this.isEditing||this.selectWord(this.getSelectionStartFromPointer(p.e))},tripleClickHandler:function(p){!this.isEditing||this.selectLine(this.getSelectionStartFromPointer(p.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(p){!this.canvas||!this.editable||p.e.button&&1!==p.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(p.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(p){!this.canvas||!this.editable||p.e.button&&1!==p.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(p){if(this.__isMousedown=!1,!(!this.editable||this.group||p.transform&&p.transform.actionPerformed||p.e.button&&1!==p.e.button)){if(this.canvas){var a=this.canvas._activeObject;if(a&&a!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(p.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(p){var a=this.getSelectionStartFromPointer(p);p.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,a):(this.selectionStart=a,this.selectionEnd=a),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(p){for(var c,a=this.getLocalPointer(p),u=0,h=0,n=0,s=0,i=0,r=0,f=this._textLines.length;r<f&&n<=a.y;r++)n+=this.getHeightOfLine(r)*this.scaleY,i=r,r>0&&(s+=this._textLines[r-1].length+this.missingNewlineOffset(r-1));h=this._getLineLeftOffset(i)*this.scaleX,c=this._textLines[i],"rtl"===this.direction&&(a.x=this.width*this.scaleX-a.x+h);for(var m=0,v=c.length;m<v&&(u=h,(h+=this.__charBounds[i][m].kernedWidth*this.scaleX)<=a.x);m++)s++;return this._getNewSelectionStartFromOffset(a,u,h,s,v)},_getNewSelectionStartFromOffset:function(p,a,u,h,n){var i=u-p.x,c=h+(i>p.x-a||i<0?0:1);return this.flipX&&(c=n-c),c>this._text.length&&(c=this._text.length),c}}),_.util.object.extend(_.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=_.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var p=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+p.top+"; left: "+p.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+p.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):_.document.body.appendChild(this.hiddenTextarea),_.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),_.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),_.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),_.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),_.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),_.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(_.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(p){if(this.isEditing){var a="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(p.keyCode in a)this[a[p.keyCode]](p);else{if(!(p.keyCode in this.ctrlKeysMapDown)||!p.ctrlKey&&!p.metaKey)return;this[this.ctrlKeysMapDown[p.keyCode]](p)}p.stopImmediatePropagation(),p.preventDefault(),p.keyCode>=33&&p.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(p){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:p.keyCode in this.ctrlKeysMapUp&&(p.ctrlKey||p.metaKey)&&(this[this.ctrlKeysMapUp[p.keyCode]](p),p.stopImmediatePropagation(),p.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(p){var a=this.fromPaste;if(this.fromPaste=!1,p&&p.stopPropagation(),this.isEditing){var s,i,m,v,y,u=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,h=this._text.length,n=u.length,o=n-h,c=this.selectionStart,r=this.selectionEnd,f=c!==r;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var x=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),w=c>x.selectionStart;f?(s=this._text.slice(c,r),o+=r-c):n<h&&(s=w?this._text.slice(r+o,r):this._text.slice(c,c-o)),i=u.slice(x.selectionEnd-o,x.selectionEnd),s&&s.length&&(i.length&&(m=this.getSelectionStyles(c,c+1,!1),m=i.map(function(){return m[0]})),f?(v=c,y=r):w?(v=r-s.length,y=r):(v=r,y=r+s.length),this.removeStyleFromTo(v,y)),i.length&&(a&&i.join("")===_.copiedText&&!_.disableStyleCopyPaste&&(m=_.copiedTextStyle),this.insertNewStyleBlock(i,c,m)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(p){this.compositionStart=p.target.selectionStart,this.compositionEnd=p.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(_.copiedText=this.getSelectedText(),_.copiedTextStyle=_.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(p){return p&&p.clipboardData||_.window.clipboardData},_getWidthBeforeCursor:function(p,a){var h,u=this._getLineLeftOffset(p);return a>0&&(u+=(h=this.__charBounds[p][a-1]).left+h.width),u},getDownCursorOffset:function(p,a){var u=this._getSelectionForOffset(p,a),h=this.get2DCursorLocation(u),n=h.lineIndex;if(n===this._textLines.length-1||p.metaKey||34===p.keyCode)return this._text.length-u;var s=h.charIndex,i=this._getWidthBeforeCursor(n,s),o=this._getIndexOnLine(n+1,i);return this._textLines[n].slice(s).length+o+1+this.missingNewlineOffset(n)},_getSelectionForOffset:function(p,a){return p.shiftKey&&this.selectionStart!==this.selectionEnd&&a?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(p,a){var u=this._getSelectionForOffset(p,a),h=this.get2DCursorLocation(u),n=h.lineIndex;if(0===n||p.metaKey||33===p.keyCode)return-u;var s=h.charIndex,i=this._getWidthBeforeCursor(n,s),o=this._getIndexOnLine(n-1,i),c=this._textLines[n].slice(0,s),r=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+o-c.length+(1-r)},_getIndexOnLine:function(p,a){for(var i,o,u=this._textLines[p],n=this._getLineLeftOffset(p),s=0,c=0,r=u.length;c<r;c++)if((n+=i=this.__charBounds[p][c].width)>a){o=!0;var m=n,v=Math.abs(n-i-a);s=Math.abs(m-a)<v?c:c-1;break}return o||(s=u.length-1),s},moveCursorDown:function(p){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",p)},moveCursorUp:function(p){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",p)},_moveCursorUpOrDown:function(p,a){var h=this["get"+p+"CursorOffset"](a,"right"===this._selectionDirection);a.shiftKey?this.moveCursorWithShift(h):this.moveCursorWithoutShift(h),0!==h&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(p){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+p:this.selectionEnd+p),0!==p},moveCursorWithoutShift:function(p){return p<0?(this.selectionStart+=p,this.selectionEnd=this.selectionStart):(this.selectionEnd+=p,this.selectionStart=this.selectionEnd),0!==p},moveCursorLeft:function(p){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",p)},_move:function(p,a,u){var h;if(p.altKey)h=this["findWordBoundary"+u](this[a]);else{if(!p.metaKey&&35!==p.keyCode&&36!==p.keyCode)return this[a]+="Left"===u?-1:1,!0;h=this["findLineBoundary"+u](this[a])}if(typeof h<"u"&&this[a]!==h)return this[a]=h,!0},_moveLeft:function(p,a){return this._move(p,a,"Left")},_moveRight:function(p,a){return this._move(p,a,"Right")},moveCursorLeftWithoutShift:function(p){var a=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(a=this._moveLeft(p,"selectionStart")),this.selectionEnd=this.selectionStart,a},moveCursorLeftWithShift:function(p){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(p,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(p,"selectionStart")):void 0},moveCursorRight:function(p){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",p)},_moveCursorLeftOrRight:function(p,a){var u="moveCursor"+p+"With";this._currentCursorOpacity=1,this[u+=a.shiftKey?"Shift":"outShift"](a)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(p){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(p,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(p,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(p){var a=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(a=this._moveRight(p,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,a},removeChars:function(p,a){typeof a>"u"&&(a=p+1),this.removeStyleFromTo(p,a),this._text.splice(p,a-p),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(p,a,u,h){typeof h>"u"&&(h=u),h>u&&this.removeStyleFromTo(u,h);var n=_.util.string.graphemeSplit(p);this.insertNewStyleBlock(n,u,a),this._text=[].concat(this._text.slice(0,u),n,this._text.slice(h)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var p=_.util.toFixed,a=/  +/g;_.util.object.extend(_.Text.prototype,{_toSVG:function(){var u=this._getSVGLeftTopOffsets(),h=this._getSVGTextAndBg(u.textTop,u.textLeft);return this._wrapSVGTextAndBg(h)},toSVG:function(u){return this._createBaseSVGMarkup(this._toSVG(),{reviver:u,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(u){var n=this.getSvgTextDecoration(this);return[u.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",n?'text-decoration="'+n+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",u.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(u,h){var o,n=[],s=[],i=u;this._setSVGBg(s);for(var c=0,r=this._textLines.length;c<r;c++)o=this._getLineLeftOffset(c),(this.textBackgroundColor||this.styleHas("textBackgroundColor",c))&&this._setSVGTextLineBg(s,c,h+o,i),this._setSVGTextLineText(n,c,h+o,i),i+=this.getHeightOfLine(c);return{textSpans:n,textBgRects:s}},_createTextCharSpan:function(u,h,n,s){var i=u!==u.trim()||u.match(a),o=this.getSvgSpanStyles(h,i),c=o?'style="'+o+'"':"",r=h.deltaY,f="",m=_.Object.NUM_FRACTION_DIGITS;return r&&(f=' dy="'+p(r,m)+'" '),['<tspan x="',p(n,m),'" y="',p(s,m),'" ',f,c,">",_.util.string.escapeXml(u),"</tspan>"].join("")},_setSVGTextLineText:function(u,h,n,s){var c,r,m,v,w,i=this.getHeightOfLine(h),o=-1!==this.textAlign.indexOf("justify"),f="",y=0,x=this._textLines[h];s+=i*(1-this._fontSizeFraction)/this.lineHeight;for(var O=0,P=x.length-1;O<=P;O++)w=O===P||this.charSpacing,f+=x[O],m=this.__charBounds[h][O],0===y?(n+=m.kernedWidth-m.width,y+=m.width):y+=m.kernedWidth,o&&!w&&this._reSpaceAndTab.test(x[O])&&(w=!0),w||(c=c||this.getCompleteStyleDeclaration(h,O),r=this.getCompleteStyleDeclaration(h,O+1),w=_.util.hasStyleChanged(c,r,!0)),w&&(v=this._getStyleDeclaration(h,O)||{},u.push(this._createTextCharSpan(f,v,n,s)),f="",c=r,n+=y,y=0)},_pushTextBgRect:function(u,h,n,s,i,o){var c=_.Object.NUM_FRACTION_DIGITS;u.push("\t\t<rect ",this._getFillAttributes(h),' x="',p(n,c),'" y="',p(s,c),'" width="',p(i,c),'" height="',p(o,c),'"></rect>\n')},_setSVGTextLineBg:function(u,h,n,s){for(var f,m,i=this._textLines[h],o=this.getHeightOfLine(h)/this.lineHeight,c=0,r=0,v=this.getValueOfPropertyAt(h,0,"textBackgroundColor"),y=0,x=i.length;y<x;y++)f=this.__charBounds[h][y],(m=this.getValueOfPropertyAt(h,y,"textBackgroundColor"))!==v?(v&&this._pushTextBgRect(u,v,n+r,s,c,o),r=f.left,c=f.width,v=m):c+=f.kernedWidth;m&&this._pushTextBgRect(u,m,n+r,s,c,o)},_getFillAttributes:function(u){var h=u&&"string"==typeof u?new _.Color(u):"";return h&&h.getSource()&&1!==h.getAlpha()?'opacity="'+h.getAlpha()+'" fill="'+h.setAlpha(1).toRgb()+'"':'fill="'+u+'"'},_getSVGLineTopOffset:function(u){for(var n,h=0,s=0;s<u;s++)h+=this.getHeightOfLine(s);return n=this.getHeightOfLine(s),{lineTop:h,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(u){return _.Object.prototype.getSvgStyles.call(this,u)+" white-space: pre;"}})}(),function(p){"use strict";var a=p.fabric||(p.fabric={});a.Textbox=a.util.createClass(a.IText,a.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:a.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(u){for(var h=0,n=0,s=0,i={},o=0;o<u.graphemeLines.length;o++)"\n"===u.graphemeText[s]&&o>0?(n=0,s++,h++):!this.splitByGrapheme&&this._reSpaceAndTab.test(u.graphemeText[s])&&o>0&&(n++,s++),i[o]={line:h,offset:n},s+=u.graphemeLines[o].length,n+=u.graphemeLines[o].length;return i},styleHas:function(u,h){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[h];n&&(h=n.line)}return a.Text.prototype.styleHas.call(this,u,h)},isEmptyStyles:function(u){if(!this.styles)return!0;var s,i,h=0,o=!1,c=this._styleMap[u],r=this._styleMap[u+1];for(var f in c&&(u=c.line,h=c.offset),r&&(o=r.line===u,s=r.offset),i=typeof u>"u"?this.styles:{line:this.styles[u]})for(var m in i[f])if(m>=h&&(!o||m<s))for(var v in i[f][m])return!1;return!0},_getStyleDeclaration:function(u,h){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[u];if(!n)return null;u=n.line,h=n.offset+h}return this.callSuper("_getStyleDeclaration",u,h)},_setStyleDeclaration:function(u,h,n){var s=this._styleMap[u];this.styles[u=s.line][h=s.offset+h]=n},_deleteStyleDeclaration:function(u,h){var n=this._styleMap[u];delete this.styles[u=n.line][h=n.offset+h]},_getLineStyle:function(u){return!!this.styles[this._styleMap[u].line]},_setLineStyle:function(u){this.styles[this._styleMap[u].line]={}},_wrapText:function(u,h){var s,n=[];for(this.isWrapping=!0,s=0;s<u.length;s++)n=n.concat(this._wrapLine(u[s],s,h));return this.isWrapping=!1,n},_measureWord:function(u,h,n){var i,s=0;n=n||0;for(var c=0,r=u.length;c<r;c++)s+=this._getGraphemeBox(u[c],h,c+n,i,!0).kernedWidth,i=u[c];return s},_wrapLine:function(u,h,n,$){var i=0,o=this.splitByGrapheme,c=[],r=[],f=o?a.util.string.graphemeSplit(u):u.split(this._wordJoiners),m="",v=0,y=o?"":" ",x=0,w=0,O=0,P=!0,X=this._getWidthOfCharSpacing();$=$||0,0===f.length&&f.push([]),n-=$;for(var tt=0;tt<f.length;tt++)m=o?f[tt]:a.util.string.graphemeSplit(f[tt]),x=this._measureWord(m,h,v),v+=m.length,(i+=w+x-X)>n&&!P?(c.push(r),r=[],i=x,P=!0):i+=X,!P&&!o&&r.push(y),r=r.concat(m),w=o?0:this._measureWord([y],h,v),v++,P=!1,x>O&&(O=x);return tt&&c.push(r),O+$>this.dynamicMinWidth&&(this.dynamicMinWidth=O-X+$),c},isEndOfWrapping:function(u){return!this._styleMap[u+1]||this._styleMap[u+1].line!==this._styleMap[u].line},missingNewlineOffset:function(u){return this.splitByGrapheme?this.isEndOfWrapping(u)?1:0:1},_splitTextIntoLines:function(u){for(var h=a.Text.prototype._splitTextIntoLines.call(this,u),n=this._wrapText(h.lines,this.width),s=new Array(n.length),i=0;i<n.length;i++)s[i]=n[i].join("");return h.lines=s,h.graphemeLines=n,h},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var u={};for(var h in this._styleMap)this._textLines[h]&&(u[this._styleMap[h].line]=1);for(var h in this.styles)u[h]||delete this.styles[h]},toObject:function(u){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(u))}}),a.Textbox.fromObject=function(u,h){var n=a.util.stylesFromArray(u.styles,u.text),s=Object.assign({},u,{styles:n});return a.Object._fromObject("Textbox",s,h,"text")}}(yt),function(){var p=_.controlsUtils,a=p.scaleSkewCursorStyleHandler,u=p.scaleCursorStyleHandler,h=p.scalingEqually,n=p.scalingYOrSkewingX,s=p.scalingXOrSkewingY,i=p.scaleOrSkewActionName,o=_.Object.prototype.controls;if(o.ml=new _.Control({x:-.5,y:0,cursorStyleHandler:a,actionHandler:s,getActionName:i}),o.mr=new _.Control({x:.5,y:0,cursorStyleHandler:a,actionHandler:s,getActionName:i}),o.mb=new _.Control({x:0,y:.5,cursorStyleHandler:a,actionHandler:n,getActionName:i}),o.mt=new _.Control({x:0,y:-.5,cursorStyleHandler:a,actionHandler:n,getActionName:i}),o.tl=new _.Control({x:-.5,y:-.5,cursorStyleHandler:u,actionHandler:h}),o.tr=new _.Control({x:.5,y:-.5,cursorStyleHandler:u,actionHandler:h}),o.bl=new _.Control({x:-.5,y:.5,cursorStyleHandler:u,actionHandler:h}),o.br=new _.Control({x:.5,y:.5,cursorStyleHandler:u,actionHandler:h}),o.mtr=new _.Control({x:0,y:-.5,actionHandler:p.rotationWithSnapping,cursorStyleHandler:p.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),_.Textbox){var c=_.Textbox.prototype.controls={};c.mtr=o.mtr,c.tr=o.tr,c.br=o.br,c.tl=o.tl,c.bl=o.bl,c.mt=o.mt,c.mb=o.mb,c.mr=new _.Control({x:.5,y:0,actionHandler:p.changeWidth,cursorStyleHandler:a,actionName:"resizing"}),c.ml=new _.Control({x:-.5,y:0,actionHandler:p.changeWidth,cursorStyleHandler:a,actionName:"resizing"})}}()},4960:()=>{},6759:()=>{},6272:()=>{}}]);